<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="CTF-Misc要点, JackHCC">
    <meta name="description" content="CTF杂项学习要点">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>CTF-Misc要点 | JackHCC</title>
    <link rel="icon" type="image/png" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/medias/favicon.png">

    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/css/matery.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/css/my.css">
    
    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/jquery/jquery.min.js"></script>
    
<meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="JackHCC" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism-hopscotch.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper head-container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/images/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/medias/me.jpg" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">JackHCC</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>

<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/images/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/medias/me.jpg" class="logo-img circle responsive-img">
        
        <div class="logo-name">JackHCC</div>
        <div class="logo-desc">
            
            Make the world betterrrr!!!
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/JackHCC/JackHCC.github.io" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>

        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/JackHCC/JackHCC.github.io" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/medias/featureimages/20.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">CTF-Misc要点</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="container content">

    
    <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/MISC/">
                                <span class="chip bg-color">MISC</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/CTF/" class="post-category">
                                CTF
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2021-08-08
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2021-08-09
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    11.7k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    47 分
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>

        </div>
        <hr class="clearfix">
        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="信息搜集技术"><a href="#信息搜集技术" class="headerlink" title="信息搜集技术"></a>信息搜集技术</h1><h2 id="网络信息搜集技巧"><a href="#网络信息搜集技巧" class="headerlink" title="网络信息搜集技巧"></a>网络信息搜集技巧</h2><ul>
<li>公开渠道</li>
<li>目标 Web 网页、地理位置、相关组织</li>
<li>组织结构和人员、个人资料、电话、电子邮件</li>
<li>网络配置、安全防护机制的策略和技术细节</li>
<li>通过搜索引擎查找特定安全漏洞或私密信息的方法</li>
<li><a href="https://www.exploit-db.com/google-hacking-database/" target="_blank" rel="noopener">Google Hacking Database</a></li>
<li>科学上网</li>
</ul>
<h2 id="基本搜索技巧"><a href="#基本搜索技巧" class="headerlink" title="基本搜索技巧"></a>基本搜索技巧</h2><ul>
<li>Google 基本搜索与挖掘技巧</li>
<li>保持简单明了的关键词</li>
<li>使用最可能出现在要查找的网页上的字词</li>
<li>尽量简明扼要地描述要查找的内容</li>
<li>选择独特性的描述字词</li>
<li>社会公共信息库查询</li>
<li>个人信息：人口统计局</li>
<li>企业等实体：YellowPage、企业信用信息网</li>
<li>网站、域名、IP：whois 等</li>
</ul>
<h2 id="地图和街景搜索"><a href="#地图和街景搜索" class="headerlink" title="地图和街景搜索"></a>地图和街景搜索</h2><ul>
<li>国外：Google Map、Google Earth、Google Street View</li>
<li>国内：百度地图、卫星地图、街景</li>
<li>从网络世界到物理世界：IP2Location</li>
<li>whois 数据库</li>
<li>GeoIP</li>
<li>IP2Location</li>
<li>纯真数据库（QQ IP 查询）</li>
</ul>
<h1 id="编码分析"><a href="#编码分析" class="headerlink" title="编码分析"></a>编码分析</h1><h2 id="通信领域常用编码"><a href="#通信领域常用编码" class="headerlink" title="通信领域常用编码"></a>通信领域常用编码</h2><h3 id="电话拨号编码"><a href="#电话拨号编码" class="headerlink" title="电话拨号编码"></a>电话拨号编码</h3><p>1-9 分别使用 1-9 个脉冲，0 则表示使用 10 个脉冲。</p>
<h3 id="Morse-编码"><a href="#Morse-编码" class="headerlink" title="Morse 编码"></a>Morse 编码</h3><p>参见 <a href="https://zh.wikipedia.org/wiki/摩尔斯电码" target="_blank" rel="noopener">摩尔斯编码 - 维基百科</a>，对应表如下</p>
<p><img src="/images/loading.gif" data-original="../images/CTF/morse.jpg" alt="摩尔斯电码"></p>
<h4 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h4><ul>
<li>只有 <code>.</code> 和 <code>-</code>；</li>
<li>最多 6 位；</li>
<li>也可以使用 <code>01</code> 串表示。</li>
</ul>
<h4 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h4><ul>
<li><a href="http://www.zhongguosou.com/zonghe/moErSiCodeConverter.aspx" target="_blank" rel="noopener">摩尔斯编码在线转换</a></li>
</ul>
<h3 id="敲击码"><a href="#敲击码" class="headerlink" title="敲击码"></a>敲击码</h3><p>敲击码（Tap code）是一种以非常简单的方式对文本信息进行编码的方法。因该编码对信息通过使用一系列的点击声音来编码而命名，敲击码是基于 5 ×5 方格波利比奥斯方阵来实现的，不同点是是用 K 字母被整合到 C 中。</p>
<table>
<thead>
<tr>
<th align="left">Tap Code</th>
<th align="left">1</th>
<th align="left">2</th>
<th align="left">3</th>
<th align="left">4</th>
<th align="left">5</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left">A</td>
<td align="left">B</td>
<td align="left">C/K</td>
<td align="left">D</td>
<td align="left">E</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left">F</td>
<td align="left">G</td>
<td align="left">H</td>
<td align="left">I</td>
<td align="left">J</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left">L</td>
<td align="left">M</td>
<td align="left">N</td>
<td align="left">O</td>
<td align="left">P</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left">Q</td>
<td align="left">R</td>
<td align="left">S</td>
<td align="left">T</td>
<td align="left">U</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left">V</td>
<td align="left">W</td>
<td align="left">X</td>
<td align="left">Y</td>
<td align="left">Z</td>
</tr>
</tbody></table>
<p><img src="/images/loading.gif" data-original="../images/CTF/tapcode.jpg" alt="img"></p>
<h3 id="曼彻斯特编码"><a href="#曼彻斯特编码" class="headerlink" title="曼彻斯特编码"></a>曼彻斯特编码</h3><ul>
<li><a href="https://zh.wikipedia.org/wiki/曼彻斯特编码" target="_blank" rel="noopener">曼彻斯特编码 - 维基百科</a></li>
</ul>
<h3 id="格雷编码"><a href="#格雷编码" class="headerlink" title="格雷编码"></a>格雷编码</h3><ul>
<li><a href="https://zh.wikipedia.org/wiki/格雷码" target="_blank" rel="noopener">格雷码 - 维基百科</a></li>
</ul>
<h2 id="计算机相关的编码"><a href="#计算机相关的编码" class="headerlink" title="计算机相关的编码"></a>计算机相关的编码</h2><p>本节介绍一些计算机相关的编码。</p>
<h3 id="字母表编码"><a href="#字母表编码" class="headerlink" title="字母表编码"></a>字母表编码</h3><ul>
<li>A-Z/a-z 对应 1-26 或者 0-25</li>
</ul>
<h3 id="ASCII-编码"><a href="#ASCII-编码" class="headerlink" title="ASCII 编码"></a>ASCII 编码</h3><p><img src="/images/loading.gif" data-original="../images/CTF/ascii.jpg" alt="ascii"></p>
<h4 id="特点-1"><a href="#特点-1" class="headerlink" title="特点"></a>特点</h4><p>我们一般使用的 ascii 编码的时候采用的都是可见字符，而且主要是如下字符</p>
<ul>
<li>0-9, 48-57</li>
<li>A-Z, 65-90</li>
<li>a-z, 97-122</li>
</ul>
<h4 id="变形"><a href="#变形" class="headerlink" title="变形"></a>变形</h4><h5 id="二进制编码"><a href="#二进制编码" class="headerlink" title="二进制编码"></a>二进制编码</h5><p>将 ascii 码对应的数字换成二进制表示形式。</p>
<ul>
<li>只有 0 和 1</li>
<li>不大于 8 位，一般 7 位也可以，因为可见字符到 127。</li>
<li>其实是另一种 ascii 编码。</li>
</ul>
<h5 id="十六进制编码"><a href="#十六进制编码" class="headerlink" title="十六进制编码"></a>十六进制编码</h5><p>将 ascii 码对应的数字换成十六进制表示形式。</p>
<ul>
<li>A-Z→41-5 A</li>
<li>a-z→61-7 A</li>
</ul>
<h4 id="工具-1"><a href="#工具-1" class="headerlink" title="工具"></a>工具</h4><ul>
<li>jpk, ascii to number, number to ascii</li>
<li><a href="http://www.ab126.com/goju/1711.html" target="_blank" rel="noopener">http://www.ab126.com/goju/1711.html</a></li>
</ul>
<h4 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h4><p><img src="/images/loading.gif" data-original="../images/CTF/ascii-example.png" alt="ascii"></p>
<h5 id="2018-DEFCON-Quals-ghettohackers-Throwback"><a href="#2018-DEFCON-Quals-ghettohackers-Throwback" class="headerlink" title="2018 DEFCON Quals ghettohackers: Throwback"></a>2018 DEFCON Quals ghettohackers: Throwback</h5><p>题目描述如下</p>
<pre><code>Anyo!e!howouldsacrificepo!icyforexecu!!onspeedthink!securityisacomm!ditytop!urintoasy!tem!</code></pre><p>第一直觉应该是我们去补全这些叹号对应的内容，从而得到 flag，但是补全后并不行，那么我们可以把源字符串按照 <code>!</code> 分割，然后字符串长度 1 对应字母 a，长度 2 对应字母 b，以此类推</p>
<pre><code>ori = 'Anyo!e!howouldsacrificepo!icyforexecu!!onspeedthink!securityisacomm!ditytop!urintoasy!tem!'
sp = ori.split('!')
print repr(''.join(chr(97 + len(s) - 1) for s in sp))</code></pre><p>进而可以得到，这里同时需要假设 0 个字符为空格。因为这正好使得原文可读。</p>
<pre><code>dark logic</code></pre><h3 id="Base-编码"><a href="#Base-编码" class="headerlink" title="Base 编码"></a>Base 编码</h3><p>base xx 中的 xx 表示的是采用多少个字符进行编码，比如说 base64 就是采用以下 64 个字符编码，由于 2 的 6 次方等于 64，所以每 6 个比特为一个单元，对应某个可打印字符。3 个字节就有 24 个比特，对应于 4 个 Base64 单元，即 3 个字节需要用 4 个可打印字符来表示。它可用来作为电子邮件的传输编码。在 Base64 中的可打印字符包括字母 A-Z、a-z、数字 0-9，这样共有 62 个字符，此外两个可打印符号在不同的系统中而不同。</p>
<p><img src="/images/loading.gif" data-original="../images/CTF/base64.png" alt="base64"></p>
<p>具体介绍参见 <a href="https://zh.wikipedia.org/wiki/Base64" target="_blank" rel="noopener">Base64 - 维基百科</a>。</p>
<p><strong>编码 man</strong></p>
<p><img src="/images/loading.gif" data-original="../images/CTF/base64_man.png" alt="base64 编码 MAN"></p>
<p>如果要编码的字节数不能被 3 整除，最后会多出 1 个或 2 个字节，那么可以使用下面的方法进行处理：先使用 0 值在末尾补足，使其能够被 3 整除，然后再进行 base64 的编码。在编码后的 base64 文本后加上一个或两个 <code>=</code> 号，代表补足的字节数。也就是说，当最后剩余一个八位字节（一个 byte）时，最后一个 6 位的 base64 字节块有四位是 0 值，最后附加上两个等号；如果最后剩余两个八位字节（2 个 byte）时，最后一个 6 位的 base 字节块有两位是 0 值，最后附加一个等号。参考下表：</p>
<p><img src="/images/loading.gif" data-original="../images/CTF/base64_0.png" alt="base64 补 0"></p>
<p>由于解码时补位的 0 并不参与运算，可以在该处隐藏信息。</p>
<p>与 base64 类似，base32 使用 32 个可见字符进行编码，2 的 5 次方为 32，所以每 5 bit 为 1 个分组。5 字节为 40 bit，对应于 8 个 base32 分组，即 5 个字节用 8 个 base32 中字符来表示。但如果不足 5 个字节，则会先对第一个不足 5 bit 的分组用 0 补足了 5 bit ，对后面剩余分组全部使用 “=” 填充，直到补满 5 个字节。由此可知，base32 最多只有 6 个等号出现。例如：</p>
<p><img src="/images/loading.gif" data-original="../images/CTF/base32.png" alt="base32"></p>
<h4 id="特点-2"><a href="#特点-2" class="headerlink" title="特点"></a>特点</h4><ul>
<li>base64 结尾可能会有 <code>=</code> 号，但最多有 2 个</li>
<li>base32 结尾可能会有 <code>=</code> 号，但最多有 6 个</li>
<li>根据 base 的不同，字符集会有所限制</li>
<li><strong>有可能需要自己加等号</strong></li>
<li><strong>= 也就是 3D</strong></li>
<li>更多内容请参见 <a href="https://tools.ietf.org/html/rfc4648" target="_blank" rel="noopener">base rfc</a></li>
</ul>
<h4 id="工具-2"><a href="#工具-2" class="headerlink" title="工具"></a>工具</h4><ul>
<li><a href="http://www1.tc711.com/tool/BASE64.htm" target="_blank" rel="noopener">http://www1.tc711.com/tool/BASE64.htm</a></li>
<li>python 库函数</li>
<li><a href="https://github.com/cjcslhp/wheels/tree/master/b64stego" target="_blank" rel="noopener">读取隐写信息脚本</a></li>
</ul>
<h4 id="例子-1"><a href="#例子-1" class="headerlink" title="例子"></a>例子</h4><p>题目描述参见 <code>ctf-challenge</code>中 <a href="https://github.com/ctf-wiki/ctf-challenges/tree/master/misc/encode/computer/base64-stego" target="_blank" rel="noopener">misc 分类的 base64-stego 目录</a>中的 data.txt 文件。</p>
<p>使用脚本读取隐写信息。</p>
<pre><code>import base64

def deStego(stegoFile):
    b64table = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"
    with open(stegoFile,'r') as stegoText:
        message = ""
        for line in stegoText:
            try:
                text = line[line.index("=") - 1:-1]
                message += "".join([ bin( 0 if i == '=' else b64table.find(i))[2:].zfill(6) for i in text])[2 if text.count('=') ==2 else 4:6]  
            except:
                pass
    return "".join([chr(int(message[i:i+8],2)) for i in range(0,len(message),8)])

print(deStego("text.txt"))</code></pre><p>输出:</p>
<pre><code>     flag{BASE64_i5_amaz1ng}</code></pre><h3 id="霍夫曼编码"><a href="#霍夫曼编码" class="headerlink" title="霍夫曼编码"></a>霍夫曼编码</h3><p>参见 <a href="https://zh.wikipedia.org/wiki/霍夫曼编码" target="_blank" rel="noopener">霍夫曼编码</a>。</p>
<h3 id="XXencoding"><a href="#XXencoding" class="headerlink" title="XXencoding"></a>XXencoding</h3><p>XXencode 将输入文本以每三个字节为单位进行编码。如果最后剩下的资料少于三个字节，不够的部份用零补齐。这三个字节共有 24 个 Bit，以 6bit 为单位分为 4 个组，每个组以十进制来表示所出现的数值只会落在 0 到 63 之间。以所对应值的位置字符代替。</p>
<pre><code>           1         2         3         4         5         6
 0123456789012345678901234567890123456789012345678901234567890123
 |         |         |         |         |         |         |
 +-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz</code></pre><p>具体信息参见<a href="https://en.wikipedia.org/wiki/Xxencoding" target="_blank" rel="noopener">维基百科</a></p>
<h4 id="特点-3"><a href="#特点-3" class="headerlink" title="特点"></a>特点</h4><ul>
<li>+ 号，- 号。</li>
</ul>
<h4 id="工具-3"><a href="#工具-3" class="headerlink" title="工具"></a>工具</h4><ul>
<li><a href="http://web.chacuo.net/charsetxxencode" target="_blank" rel="noopener">http://web.chacuo.net/charsetxxencode</a></li>
</ul>
<h3 id="URL-编码"><a href="#URL-编码" class="headerlink" title="URL 编码"></a>URL 编码</h3><p>参见<a href="https://zh.wikipedia.org/wiki/百分号编码" target="_blank" rel="noopener"> URL 编码 - 维基百科</a>。</p>
<h4 id="特点-4"><a href="#特点-4" class="headerlink" title="特点"></a>特点</h4><ul>
<li>大量的百分号</li>
</ul>
<h4 id="工具-4"><a href="#工具-4" class="headerlink" title="工具"></a>工具</h4><h3 id="Unicode-编码"><a href="#Unicode-编码" class="headerlink" title="Unicode 编码"></a>Unicode 编码</h3><p>参见<a href="https://zh.wikipedia.org/wiki/Unicode" target="_blank" rel="noopener"> Unicode - 维基百科</a>。</p>
<p>注意，它有四种表现形式。</p>
<h4 id="例子-2"><a href="#例子-2" class="headerlink" title="例子"></a>例子</h4><p>源文本： <code>The</code></p>
<p>&amp;#x [Hex]: <code>The</code></p>
<p>&amp;# [Decimal]: <code>The</code></p>
<p>\U [Hex]: <code>\U0054\U0068\U0065</code></p>
<p>\U+ [Hex]: <code>\U+0054\U+0068\U+0065</code></p>
<h4 id="工具-5"><a href="#工具-5" class="headerlink" title="工具"></a>工具</h4><h2 id="现实世界中常用的编码"><a href="#现实世界中常用的编码" class="headerlink" title="现实世界中常用的编码"></a>现实世界中常用的编码</h2><h3 id="条形码"><a href="#条形码" class="headerlink" title="条形码"></a>条形码</h3><ul>
<li>宽度不等的多个黑条和空白，按照一定的编码规则排列，用以表达一组信息的图形标识符</li>
<li>国际标准</li>
<li>EAN-13 商品标准，13 位数字</li>
<li>Code-39：39 字符</li>
<li>Code-128：128 字符</li>
<li><a href="https://online-barcode-reader.inliteresearch.com/" target="_blank" rel="noopener">条形码在线识别</a></li>
</ul>
<h3 id="二维码"><a href="#二维码" class="headerlink" title="二维码"></a>二维码</h3><ul>
<li><p>用某种特定几何图形按一定规律在平面分步的黑白相间的图形记录数据符号信息</p>
</li>
<li><p>堆叠式 / 行排式二维码：Code 16 k、Code 49、PDF417</p>
</li>
<li><p>矩阵式二维码：QR CODE</p>
<p><img src="/images/loading.gif" data-original="../images/CTF/qr1.jpg" alt="img"></p>
</li>
</ul>
<h1 id="取证隐写前置技术"><a href="#取证隐写前置技术" class="headerlink" title="取证隐写前置技术"></a>取证隐写前置技术</h1><p>大部分的 CTF 比赛中，取证及隐写两者密不可分，两者所需要的知识也相辅相成，所以这里也将对两者一起介绍。</p>
<p>任何要求检查一个静态数据文件从而获取隐藏信息的都可以被认为是隐写取证题（除非单纯地是密码学的知识），一些低分的隐写取证又常常与古典密码学结合在一起，而高分的题目则通常用与一些较为复杂的现代密码学知识结合在一起，很好地体现了 Misc 题的特点。</p>
<h2 id="前置技能"><a href="#前置技能" class="headerlink" title="前置技能"></a>前置技能</h2><ul>
<li><p>了解常见的编码</p>
<p>能够对文件中出现的一些编码进行解码，并且对一些特殊的编码（Base64、十六进制、二进制等）有一定的敏感度，对其进行转换并得到最终的 flag。</p>
</li>
<li><p>能够利用脚本语言（Python 等）去操作二进制数据</p>
</li>
<li><p>熟知常见文件的文件格式，尤其是各类 <a href="https://en.wikipedia.org/wiki/List_of_file_signatures" target="_blank" rel="noopener">文件头</a>、协议、结构等</p>
</li>
<li><p>灵活运用常见的工具</p>
</li>
</ul>
<h2 id="Python-操作二进制数据"><a href="#Python-操作二进制数据" class="headerlink" title="Python 操作二进制数据"></a>Python 操作二进制数据</h2><h3 id="struct-模块"><a href="#struct-模块" class="headerlink" title="struct 模块"></a>struct 模块</h3><p>有的时候需要用 Python 处理二进制数据，比如，存取文件，socket 操作时。这时候，可以使用 Python 的 struct 模块来完成。</p>
<p>struct 模块中最重要的三个函数是 <code>pack()</code>、<code>unpack()</code> 和 <code>calcsize()</code></p>
<ul>
<li><code>pack(fmt, v1, v2, ...)</code> 按照给定的格式（fmt），把数据封装成字符串（实际上是类似于 c 结构体的字节流）</li>
<li><code>unpack(fmt, string)</code> 按照给定的格式（fmt）解析字节流 string，返回解析出来的 tuple</li>
<li><code>calcsize(fmt)</code> 计算给定的格式（fmt）占用多少字节的内存</li>
</ul>
<p>这里打包格式 <code>fmt</code> 确定了将变量按照什么方式打包成字节流，其包含了一系列的格式字符串。这里就不再给出不同格式字符串的含义了，详细细节可以参照 <a href="https://docs.python.org/2/library/struct.html" target="_blank" rel="noopener">Python Doc</a></p>
<pre><code>&gt;&gt;&gt; import struct
&gt;&gt;&gt; struct.pack('&gt;I',16)
'\x00\x00\x00\x10'</code></pre><p><code>pack</code> 的第一个参数是处理指令，<code>'&gt;I'</code> 的意思是：<code>&gt;</code> 表示字节顺序是 Big-Endian，也就是网络序，<code>I</code> 表示 4 字节无符号整数。</p>
<p>后面的参数个数要和处理指令一致。</p>
<p>读入一个 BMP 文件的前 30 字节，文件头的结构按顺序如下</p>
<ul>
<li>两个字节：<code>BM</code> 表示 Windows 位图，<code>BA</code> 表示 OS/2 位图</li>
<li>一个 4 字节整数：表示位图大小</li>
<li>一个 4 字节整数：保留位，始终为 0</li>
<li>一个 4 字节整数：实际图像的偏移量</li>
<li>一个 4 字节整数：Header 的字节数</li>
<li>一个 4 字节整数：图像宽度</li>
<li>一个 4 字节整数：图像高度</li>
<li>一个 2 字节整数：始终为 1</li>
<li>一个 2 字节整数：颜色数</li>
</ul>
<pre><code>&gt;&gt;&gt; import struct
&gt;&gt;&gt; bmp = '\x42\x4d\x38\x8c\x0a\x00\x00\x00\x00\x00\x36\x00\x00\x00\x28\x00\x00\x00\x80\x02\x00\x00\x68\x01\x00\x00\x01\x00\x18\x00'
&gt;&gt;&gt; struct.unpack('&lt;ccIIIIIIHH',bmp)
('B', 'M', 691256, 0, 54, 40, 640, 360, 1, 24)</code></pre><h3 id="bytearray-字节数组"><a href="#bytearray-字节数组" class="headerlink" title="bytearray 字节数组"></a>bytearray 字节数组</h3><p>将文件以二进制数组形式读取</p>
<pre><code>data = bytearray(open('challenge.png', 'rb').read())</code></pre><p>字节数组就是可变版本的字节</p>
<pre><code>data[0] = '\x89'</code></pre><h2 id="常用工具"><a href="#常用工具" class="headerlink" title="常用工具"></a>常用工具</h2><h3 id="010-Editor"><a href="#010-Editor" class="headerlink" title="010 Editor"></a><a href="http://www.sweetscape.com/010editor/" target="_blank" rel="noopener">010 Editor</a></h3><p>SweetScape 010 Editor 是一个全新的十六进位文件编辑器，它有别于传统的十六进位编辑器在于它可用「范本」来解析二进位文件，从而让你读懂和编辑它。它还可用来比较一切可视的二进位文件。</p>
<p>利用它的模板功能可以非常轻松的观察文件内部的具体结构并且依此快速更改内容。</p>
<p><img src="/images/loading.gif" data-original="../images/CTF/010.png" alt="img"></p>
<h3 id="file-命令"><a href="#file-命令" class="headerlink" title="file 命令"></a><code>file</code> 命令</h3><p><code>file</code> 命令根据文件头（魔法字节）去识别一个文件的文件类型。</p>
<pre><code>root in ~/Desktop/tmp λ file flag
flag: PNG image data, 450 x 450, 8-bit grayscale, non-interlaced</code></pre><h3 id="strings-命令"><a href="#strings-命令" class="headerlink" title="strings 命令"></a><code>strings</code> 命令</h3><p>打印文件中可打印的字符，经常用来发现文件中的一些提示信息或是一些特殊的编码信息，常常用来发现题目的突破口。</p>
<ul>
<li><p>可以配合 <code>grep</code> 命令探测指定信息</p>
<pre><code>strings test|grep -i XXCTF</code></pre></li>
<li><p>也可以配合 <code>-o</code> 参数获取所有 ASCII 字符偏移</p>
<pre><code>root in ~/Desktop/tmp λ strings -o flag|head
    14 IHDR
    45 gAMA
    64  cHRM
    141 bKGD
    157 tIME
    202 IDATx
    223 NFdVK3
    361 |;*-
    410 Ge%&lt;W
    431 5duX@%</code></pre></li>
</ul>
<h3 id="binwalk-命令"><a href="#binwalk-命令" class="headerlink" title="binwalk 命令"></a><code>binwalk</code> 命令</h3><p>binwalk 本是一个固件的分析工具，比赛中常用来发现多个文件粘合再在一起的情况。根据文件头去识别一个文件中夹杂的其他文件，有时也会存在误报率（尤其是对 Pcap 流量包等文件时）。</p>
<pre><code>root in ~/Desktop/tmp λ binwalk flag

DECIMAL       HEXADECIMAL     DESCRIPTION
--------------------------------------------------------------------------------
0             0x0             PNG image, 450 x 450, 8-bit grayscale, non-interlaced
134           0x86            Zlib compressed data, best compression
25683         0x6453          Zip archive data, at least v2.0 to extract, compressed size: 675, uncompressed size: 1159, name: readme.txt
26398         0x671E          Zip archive data, at least v2.0 to extract, compressed size: 430849, uncompressed size: 1027984, name: trid
457387        0x6FAAB         End of Zip archive</code></pre><p>配合 <code>-e</code> 参数可以进行自动化提取。</p>
<p>也可以结合 <code>dd</code> 命令进行手动切割。</p>
<pre><code>root in ~/Desktop/tmp λ dd if=flag of=1.zip bs=1 skip=25683
431726+0 records in
431726+0 records out
431726 bytes (432 kB, 422 KiB) copied, 0.900973 s, 479 kB/s</code></pre><h1 id="图片分析"><a href="#图片分析" class="headerlink" title="图片分析"></a>图片分析</h1><h2 id="图片分析简介"><a href="#图片分析简介" class="headerlink" title="图片分析简介"></a>图片分析简介</h2><p>图像文件能够很好地包含黑客文化，因此 CTF 竞赛中经常会出现各种图像文件。</p>
<p>图像文件有多种复杂的格式，可以用于各种涉及到元数据、信息丢失和无损压缩、校验、隐写或可视化数据编码的分析解密，都是 Misc 中的一个很重要的出题方向。涉及到的知识点很多（包括基本的文件格式，常见的隐写手法及隐写用的软件），有的地方也需要去进行深入的理解。</p>
<h3 id="元数据（Metadata）"><a href="#元数据（Metadata）" class="headerlink" title="元数据（Metadata）"></a>元数据（Metadata）</h3><blockquote>
<p>元数据（Metadata），又称中介数据、中继数据，为描述数据的数据（Data about data），主要是描述数据属性（property）的信息，用来支持如指示存储位置、历史数据、资源查找、文件记录等功能。</p>
</blockquote>
<p>元数据中隐藏信息在比赛中是最基本的一种手法，通常用来隐藏一些关键的 <code>Hint</code> 信息或者是一些重要的如 <code>password</code> 等信息。</p>
<p>这类元数据你可以 <code>右键 --&gt; 属性</code> 去查看, 也可以通过 <code>strings</code> 命令去查看，一般来说，一些隐藏的信息（奇怪的字符串）常常出现在头部或者尾部。</p>
<p>接下来介绍一个 <code>identify</code> 命令，这个命令是用来获取一个或多个图像文件的格式和特性。</p>
<p><code>-format</code> 用来指定显示的信息，灵活使用它的 <code>-format</code> 参数可以给解题带来不少方便。<a href="https://www.imagemagick.org/script/escape.php" target="_blank" rel="noopener">format 各个参数具体意义</a></p>
<h4 id="例题"><a href="#例题" class="headerlink" title="例题"></a>例题</h4><p><a href="https://github.com/ctfs/write-ups-2017/tree/master/breakin-ctf-2017/misc/Mysterious-GIF" target="_blank" rel="noopener">Break In 2017 - Mysterious GIF</a></p>
<p>这题的一个难点是发现并提取 GIF 中的元数据，首先 <code>strings</code> 是可以观察到异常点的。</p>
<pre><code>GIF89a
   !!!"""###$$$%%%&amp;&amp;&amp;'''((()))***+++,,,---...///000111222333444555666777888999:::;;;&lt;&lt;&lt;===&gt;&gt;&gt;???@@@AAABBBCCCDDDEEEFFFGGGHHHIIIJJJKKKLLLMMMNNNOOOPPPQQQRRRSSSTTTUUUVVVWWWXXXYYYZZZ[[[\\\]]]^^^___```aaabbbcccdddeeefffggghhhiiijjjkkklllmmmnnnooopppqqqrrrssstttuuuvvvwwwxxxyyyzzz{{{|||}}}~~~
4d494945767749424144414e42676b71686b6947397730424151454641415343424b6b776767536c41674541416f4942415144644d4e624c3571565769435172
NETSCAPE2.0
ImageMagick
...</code></pre><p>这里的一串 16 进制其实是藏在 GIF 的元数据区</p>
<p>接下来就是提取，你可以选择 Python，但是利用 <code>identify</code> 显得更加便捷</p>
<pre><code>root in ~/Desktop/tmp λ identify -format "%s %c \n" Question.gif
0 4d494945767749424144414e42676b71686b6947397730424151454641415343424b6b776767536c41674541416f4942415144644d4e624c3571565769435172
1 5832773639712f377933536849507565707478664177525162524f72653330633655772f6f4b3877655a547834346d30414c6f75685634364b63514a6b687271
...
24 484b7735432b667741586c4649746d30396145565458772b787a4c4a623253723667415450574d35715661756278667362356d58482f77443969434c684a536f
25 724b3052485a6b745062457335797444737142486435504646773d3d</code></pre><p>其他过程这里不在叙述，可参考链接中的 Writeup</p>
<h3 id="像素值转化"><a href="#像素值转化" class="headerlink" title="像素值转化"></a>像素值转化</h3><p>看看这个文件里的数据，你能想到什么？</p>
<pre><code>255,255,255,255,255...........</code></pre><p>是一串 RGB 值，尝试着将他转化为图片</p>
<pre><code>from PIL import Image
import re

x = 307 #x坐标  通过对txt里的行数进行整数分解
y = 311 #y坐标  x*y = 行数

rgb1 = [****]
print len(rgb1)/3
m=0
for i in xrange(0,x):
    for j in xrange(0,y):

        line = rgb1[(3*m):(3*(m+1))]#获取一行
        m+=1
        rgb = line

        im.putpixel((i,j),(int(rgb[0]),int(rgb[1]),int(rgb[2])))#rgb转化为像素
im.show()
im.save("flag.png")</code></pre><p>而如果反过来的话，从一张图片提取 RGB 值，再对 RGB 值去进行一些对比，从而得到最终的 flag。</p>
<p>这类题目大部分都是一些像素块组成的图片，如下图</p>
<p><img src="/images/loading.gif" data-original="https://ctf-wiki.org/misc/picture/figure/brainfun.png" alt="img"></p>
<p>相关题目:</p>
<ul>
<li><a href="https://github.com/ctfs/write-ups-2016/tree/master/csaw-ctf-2016-quals/forensics/brainfun-50" target="_blank" rel="noopener">CSAW-2016-quals:Forensic/Barinfun</a></li>
<li><a href="https://github.com/ctfs/write-ups-2017/tree/master/breakin-ctf-2017/misc/A-dance-partner" target="_blank" rel="noopener">breakin-ctf-2017:A-dance-partner</a></li>
</ul>
<h2 id="PNG"><a href="#PNG" class="headerlink" title="PNG"></a>PNG</h2><h3 id="文件格式"><a href="#文件格式" class="headerlink" title="文件格式"></a>文件格式</h3><p>对于一个 PNG 文件来说，其文件头总是由位固定的字节来描述的，剩余的部分由 3 个以上的 PNG 的数据块（Chunk）按照特定的顺序组成。</p>
<p>文件头 <code>89 50 4E 47 0D 0A 1A 0A</code> + 数据块 + 数据块 + 数据块……</p>
<h4 id="数据块-CHUNk"><a href="#数据块-CHUNk" class="headerlink" title="数据块 CHUNk"></a>数据块 CHUNk</h4><p>PNG 定义了两种类型的数据块，一种是称为关键数据块（critical chunk），这是标准的数据块，另一种叫做辅助数据块（ancillary chunks），这是可选的数据块。关键数据块定义了 4 个标准数据块，每个 PNG 文件都必须包含它们，PNG 读写软件也都必须要支持这些数据块。</p>
<table>
<thead>
<tr>
<th align="left">数据块符号</th>
<th align="left">数据块名称</th>
<th align="left">多数据块</th>
<th align="left">可选否</th>
<th align="left">位置限制</th>
</tr>
</thead>
<tbody><tr>
<td align="left">IHDR</td>
<td align="left">文件头数据块</td>
<td align="left">否</td>
<td align="left">否</td>
<td align="left">第一块</td>
</tr>
<tr>
<td align="left">cHRM</td>
<td align="left">基色和白色点数据块</td>
<td align="left">否</td>
<td align="left">是</td>
<td align="left">在 PLTE 和 IDAT 之前</td>
</tr>
<tr>
<td align="left">gAMA</td>
<td align="left">图像γ数据块</td>
<td align="left">否</td>
<td align="left">是</td>
<td align="left">在 PLTE 和 IDAT 之前</td>
</tr>
<tr>
<td align="left">sBIT</td>
<td align="left">样本有效位数据块</td>
<td align="left">否</td>
<td align="left">是</td>
<td align="left">在 PLTE 和 IDAT 之前</td>
</tr>
<tr>
<td align="left">PLTE</td>
<td align="left">调色板数据块</td>
<td align="left">否</td>
<td align="left">是</td>
<td align="left">在 IDAT 之前</td>
</tr>
<tr>
<td align="left">bKGD</td>
<td align="left">背景颜色数据块</td>
<td align="left">否</td>
<td align="left">是</td>
<td align="left">在 PLTE 之后 IDAT 之前</td>
</tr>
<tr>
<td align="left">hIST</td>
<td align="left">图像直方图数据块</td>
<td align="left">否</td>
<td align="left">是</td>
<td align="left">在 PLTE 之后 IDAT 之前</td>
</tr>
<tr>
<td align="left">tRNS</td>
<td align="left">图像透明数据块</td>
<td align="left">否</td>
<td align="left">是</td>
<td align="left">在 PLTE 之后 IDAT 之前</td>
</tr>
<tr>
<td align="left">oFFs</td>
<td align="left">（专用公共数据块）</td>
<td align="left">否</td>
<td align="left">是</td>
<td align="left">在 IDAT 之前</td>
</tr>
<tr>
<td align="left">pHYs</td>
<td align="left">物理像素尺寸数据块</td>
<td align="left">否</td>
<td align="left">是</td>
<td align="left">在 IDAT 之前</td>
</tr>
<tr>
<td align="left">sCAL</td>
<td align="left">（专用公共数据块）</td>
<td align="left">否</td>
<td align="left">是</td>
<td align="left">在 IDAT 之前</td>
</tr>
<tr>
<td align="left">IDAT</td>
<td align="left">图像数据块</td>
<td align="left">是</td>
<td align="left">否</td>
<td align="left">与其他 IDAT 连续</td>
</tr>
<tr>
<td align="left">tIME</td>
<td align="left">图像最后修改时间数据块</td>
<td align="left">否</td>
<td align="left">是</td>
<td align="left">无限制</td>
</tr>
<tr>
<td align="left">tEXt</td>
<td align="left">文本信息数据块</td>
<td align="left">是</td>
<td align="left">是</td>
<td align="left">无限制</td>
</tr>
<tr>
<td align="left">zTXt</td>
<td align="left">压缩文本数据块</td>
<td align="left">是</td>
<td align="left">是</td>
<td align="left">无限制</td>
</tr>
<tr>
<td align="left">fRAc</td>
<td align="left">（专用公共数据块）</td>
<td align="left">是</td>
<td align="left">是</td>
<td align="left">无限制</td>
</tr>
<tr>
<td align="left">gIFg</td>
<td align="left">（专用公共数据块）</td>
<td align="left">是</td>
<td align="left">是</td>
<td align="left">无限制</td>
</tr>
<tr>
<td align="left">gIFt</td>
<td align="left">（专用公共数据块）</td>
<td align="left">是</td>
<td align="left">是</td>
<td align="left">无限制</td>
</tr>
<tr>
<td align="left">gIFx</td>
<td align="left">（专用公共数据块）</td>
<td align="left">是</td>
<td align="left">是</td>
<td align="left">无限制</td>
</tr>
<tr>
<td align="left">IEND</td>
<td align="left">图像结束数据</td>
<td align="left">否</td>
<td align="left">否</td>
<td align="left">最后一个数据块</td>
</tr>
</tbody></table>
<p>对于每个数据块都有着统一的数据结构，每个数据块由 4 个部分组成</p>
<table>
<thead>
<tr>
<th align="left">名称</th>
<th align="left">字节数</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Length（长度）</td>
<td align="left">4 字节</td>
<td align="left">指定数据块中数据域的长度，其长度不超过（231－1）字节</td>
</tr>
<tr>
<td align="left">Chunk Type Code（数据块类型码）</td>
<td align="left">4 字节</td>
<td align="left">数据块类型码由 ASCII 字母（A - Z 和 a - z）组成</td>
</tr>
<tr>
<td align="left">Chunk Data（数据块数据）</td>
<td align="left">可变长度</td>
<td align="left">存储按照 Chunk Type Code 指定的数据</td>
</tr>
<tr>
<td align="left">CRC（循环冗余检测）</td>
<td align="left">4 字节</td>
<td align="left">存储用来检测是否有错误的循环冗余码</td>
</tr>
</tbody></table>
<p>CRC（Cyclic Redundancy Check）域中的值是对 Chunk Type Code 域和 Chunk Data 域中的数据进行计算得到的。</p>
<h4 id="IHDR"><a href="#IHDR" class="headerlink" title="IHDR"></a>IHDR</h4><p>文件头数据块 IHDR（Header Chunk）：它包含有 PNG 文件中存储的图像数据的基本信息，由 13 字节组成，并要作为第一个数据块出现在 PNG 数据流中，而且一个 PNG 数据流中只能有一个文件头数据块</p>
<p>其中我们关注的是前 8 字节的内容</p>
<table>
<thead>
<tr>
<th align="left">域的名称</th>
<th align="left">字节数</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Width</td>
<td align="left">4 bytes</td>
<td align="left">图像宽度，以像素为单位</td>
</tr>
<tr>
<td align="left">Height</td>
<td align="left">4 bytes</td>
<td align="left">图像高度，以像素为单位</td>
</tr>
</tbody></table>
<p>我们经常会去更改一张图片的高度或者宽度使得一张图片显示不完整从而达到隐藏信息的目的。</p>
<p><img src="/images/loading.gif" data-original="../images/CTF/pngihdr.png" alt="img"></p>
<p>这里可以发现在 Kali 中是打不开这张图片的，提示 <code>IHDR CRC error</code>，而 Windows 10 自带的图片查看器能够打开，就提醒了我们 IHDR 块被人为的篡改过了，从而尝试修改图片的高度或者宽度发现隐藏的字符串。</p>
<h5 id="例题-WDCTF-FINALS-2017"><a href="#例题-WDCTF-FINALS-2017" class="headerlink" title="例题  WDCTF-FINALS-2017"></a>例题  WDCTF-FINALS-2017</h5><p>观察文件可以发现, 文件头及宽度异常</p>
<pre><code>00000000  80 59 4e 47 0d 0a 1a 0a  00 00 00 0d 49 48 44 52  |.YNG........IHDR|
00000010  00 00 00 00 00 00 02 f8  08 06 00 00 00 93 2f 8a  |............../.|
00000020  6b 00 00 00 04 67 41 4d  41 00 00 9c 40 20 0d e4  |k....gAMA...@ ..|
00000030  cb 00 00 00 20 63 48 52  4d 00 00 87 0f 00 00 8c  |.... cHRM.......|
00000040  0f 00 00 fd 52 00 00 81  40 00 00 7d 79 00 00 e9  |....R...@..}y...|
...</code></pre><p>这里需要注意的是，文件宽度不能任意修改，需要根据 IHDR 块的 CRC 值爆破得到宽度, 否则图片显示错误不能得到 flag。</p>
<pre><code>import os
import binascii
import struct


misc = open("misc4.png","rb").read()

for i in range(1024):
    data = misc[12:16] + struct.pack('&gt;i',i)+ misc[20:29]
    crc32 = binascii.crc32(data) &amp; 0xffffffff
    if crc32 == 0x932f8a6b:
        print i</code></pre><p>得到宽度值为 709 后，恢复图片得到 flag。</p>
<p><img src="/images/loading.gif" data-original="https://ctf-wiki.org/misc/picture/figure/misc4.png" alt="img"></p>
<h4 id="PLTE"><a href="#PLTE" class="headerlink" title="PLTE"></a>PLTE</h4><p>调色板数据块 PLTE（palette chunk）：它包含有与索引彩色图像（indexed-color image）相关的彩色变换数据，它仅与索引彩色图像有关，而且要放在图像数据块（image data chunk）之前。真彩色的 PNG 数据流也可以有调色板数据块，目的是便于非真彩色显示程序用它来量化图像数据，从而显示该图像。</p>
<h4 id="IDAT"><a href="#IDAT" class="headerlink" title="IDAT"></a>IDAT</h4><p>图像数据块 IDAT（image data chunk）：它存储实际的数据，在数据流中可包含多个连续顺序的图像数据块。</p>
<ul>
<li>储存图像像数数据</li>
<li>在数据流中可包含多个连续顺序的图像数据块</li>
<li>采用 LZ77 算法的派生算法进行压缩</li>
<li>可以用 zlib 解压缩</li>
</ul>
<p>值得注意的是，IDAT 块只有当上一个块充满时，才会继续一个新的块。</p>
<p>用 <code>pngcheck</code> 去查看此 PNG 文件</p>
<pre><code>λ .\pngcheck.exe -v sctf.png
File: sctf.png (1421461 bytes)
  chunk IHDR at offset 0x0000c, length 13
    1000 x 562 image, 32-bit RGB+alpha, non-interlaced
  chunk sRGB at offset 0x00025, length 1
    rendering intent = perceptual
  chunk gAMA at offset 0x00032, length 4: 0.45455
  chunk pHYs at offset 0x00042, length 9: 3780x3780 pixels/meter (96 dpi)
  chunk IDAT at offset 0x00057, length 65445
    zlib: deflated, 32K window, fast compression
  chunk IDAT at offset 0x10008, length 65524
...
  chunk IDAT at offset 0x150008, length 45027
  chunk IDAT at offset 0x15aff7, length 138
  chunk IEND at offset 0x15b08d, length 0
No errors detected in sctf.png (28 chunks, 36.8% compression).</code></pre><p>可以看到，正常的块的 length 是在 65524 的时候就满了，而倒数第二个 IDAT 块长度是 45027，最后一个长度是 138，很明显最后一个 IDAT 块是有问题的，因为他本来应该并入到倒数第二个未满的块里.</p>
<p>利用 <code>python zlib</code> 解压多余 IDAT 块的内容，此时注意剔除 <strong>长度、数据块类型及末尾的 CRC 校验值</strong>。</p>
<pre><code>import zlib
import binascii
IDAT = "789...667".decode('hex')
result = binascii.hexlify(zlib.decompress(IDAT))
print result</code></pre><h4 id="IEND"><a href="#IEND" class="headerlink" title="IEND"></a>IEND</h4><p>图像结束数据 IEND（image trailer chunk）：它用来标记 PNG 文件或者数据流已经结束，并且必须要放在文件的尾部。</p>
<pre><code>00 00 00 00 49 45 4E 44 AE 42 60 82</code></pre><p>IEND 数据块的长度总是 <code>00 00 00 00</code>，数据标识总是 IEND <code>49 45 4E 44</code>，因此，CRC 码也总是 <code>AE 42 60 82</code>。</p>
<h4 id="其余辅助数据块"><a href="#其余辅助数据块" class="headerlink" title="其余辅助数据块"></a>其余辅助数据块</h4><ul>
<li>背景颜色数据块 bKGD（background color）</li>
<li>基色和白色度数据块 cHRM（primary chromaticities and white point），所谓白色度是指当 <code>R＝G＝B＝最大值</code> 时在显示器上产生的白色度</li>
<li>图像 γ 数据块 gAMA（image gamma）</li>
<li>图像直方图数据块 hIST（image histogram）</li>
<li>物理像素尺寸数据块 pHYs（physical pixel dimensions）</li>
<li>样本有效位数据块 sBIT（significant bits）</li>
<li>文本信息数据块 tEXt（textual data）</li>
<li>图像最后修改时间数据块 tIME （image last-modification time）</li>
<li>图像透明数据块 tRNS （transparency）</li>
<li>压缩文本数据块 zTXt （compressed textual data）</li>
</ul>
<h3 id="LSB"><a href="#LSB" class="headerlink" title="LSB"></a>LSB</h3><p>LSB 全称 Least Significant Bit，最低有效位。PNG 文件中的图像像数一般是由 RGB 三原色（红绿蓝）组成，每一种颜色占用 8 位，取值范围为 <code>0x00</code> 至 <code>0xFF</code>，即有 256 种颜色，一共包含了 256 的 3 次方的颜色，即 16777216 种颜色。</p>
<p>而人类的眼睛可以区分约 1000 万种不同的颜色，意味着人类的眼睛无法区分余下的颜色大约有 6777216 种。</p>
<p>LSB 隐写就是修改 RGB 颜色分量的最低二进制位（LSB），每个颜色会有 8 bit，LSB 隐写就是修改了像数中的最低的 1 bit，而人类的眼睛不会注意到这前后的变化，每个像素可以携带 3 比特的信息。</p>
<p><img src="/images/loading.gif" data-original="../images/CTF/lsb.jpg" alt="img"></p>
<p>如果是要寻找这种 LSB 隐藏痕迹的话，有一个工具 <a href="http://www.caesum.com/handbook/Stegsolve.jar" target="_blank" rel="noopener">Stegsolve</a> 是个神器，可以来辅助我们进行分析。</p>
<p>通过下方的按钮可以观察每个通道的信息，例如查看 R 通道的最低位第 8 位平面的信息。</p>
<p><img src="/images/loading.gif" data-original="../images/CTF/lsb1.png" alt="img"></p>
<p>LSB 的信息借助于 Stegsolve 查看各个通道时一定要细心捕捉异常点，抓住 LSB 隐写的蛛丝马迹。</p>
<h4 id="例题-1"><a href="#例题-1" class="headerlink" title="例题"></a>例题</h4><blockquote>
<p>HCTF - 2016 - Misc</p>
</blockquote>
<p>这题的信息隐藏在 RGB 三个通道的最低位中，借助 <code>Stegsolve--&gt;Analyse--&gt;Data Extract</code> 可以指定通道进行提取。</p>
<p><img src="/images/loading.gif" data-original="../images/CTF/hctfsolve.png" alt="img"></p>
<p>可以发现 <code>zip</code> 头，用 <code>save bin</code> 保存为压缩包后，打开运行其中的 ELF 文件就可以得到最后的 flag。</p>
<blockquote>
<p>更多关于 LSB 的研究可以看 <a href="https://zhuanlan.zhihu.com/p/23890677" target="_blank" rel="noopener">这里</a>。</p>
</blockquote>
<h3 id="隐写软件"><a href="#隐写软件" class="headerlink" title="隐写软件"></a>隐写软件</h3><p><a href="http://domnit.org/stepic/doc/" target="_blank" rel="noopener">Stepic</a></p>
<h2 id="JPG"><a href="#JPG" class="headerlink" title="JPG"></a>JPG</h2><h3 id="文件结构"><a href="#文件结构" class="headerlink" title="文件结构"></a>文件结构</h3><ul>
<li>JPEG 是有损压缩格式，将像素信息用 JPEG 保存成文件再读取出来，其中某些像素值会有少许变化。在保存时有个质量参数可在 0 至 100 之间选择，参数越大图片就越保真，但图片的体积也就越大。一般情况下选择 70 或 80 就足够了</li>
<li>JPEG 没有透明度信息</li>
</ul>
<p>JPG 基本数据结构为两大类型：「段」和经过压缩编码的图像数据。</p>
<table>
<thead>
<tr>
<th align="left">名 称</th>
<th align="left">字节数</th>
<th align="left">数据</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">段 标识</td>
<td align="left">1</td>
<td align="left">FF</td>
<td align="left">每个新段的开始标识</td>
</tr>
<tr>
<td align="left">段类型</td>
<td align="left">1</td>
<td align="left"></td>
<td align="left">类型编码（称作标记码）</td>
</tr>
<tr>
<td align="left">段长 度</td>
<td align="left">2</td>
<td align="left"></td>
<td align="left">包括段内容和段长度本身, 不包括段标识和段类型</td>
</tr>
<tr>
<td align="left">段内容</td>
<td align="left">2</td>
<td align="left"></td>
<td align="left">≤65533 字节</td>
</tr>
</tbody></table>
<ul>
<li>有些段没有长度描述也没有内容，只有段标识和段类型。文件头和文件尾均属于这种段。</li>
<li>段与段之间无论有多少 <code>FF</code> 都是合法的，这些 <code>FF</code> 称为「填充字节」，必须被忽略掉。</li>
</ul>
<p>一些常见的段类型</p>
<p><img src="/images/loading.gif" data-original="../images/CTF/jpgformat.png" alt="img"></p>
<p><code>0xffd8</code> 和 <code>0xffd9</code>为 JPG 文件的开始结束的标志。</p>
<h3 id="隐写软件-1"><a href="#隐写软件-1" class="headerlink" title="隐写软件"></a>隐写软件</h3><h4 id="Stegdetect"><a href="#Stegdetect" class="headerlink" title="Stegdetect"></a><a href="https://github.com/redNixon/stegdetect" target="_blank" rel="noopener">Stegdetect</a></h4><p>通过统计分析技术评估 JPEG 文件的 DCT 频率系数的隐写工具, 可以检测到通过 JSteg、JPHide、OutGuess、Invisible Secrets、F5、appendX 和 Camouflage 等这些隐写工具隐藏的信息，并且还具有基于字典暴力破解密码方法提取通过 Jphide、outguess 和 jsteg-shell 方式嵌入的隐藏信息。</p>
<pre><code>-q 仅显示可能包含隐藏内容的图像。
-n 启用检查JPEG文件头功能，以降低误报率。如果启用，所有带有批注区域的文件将被视为没有被嵌入信息。如果JPEG文件的JFIF标识符中的版本号不是1.1，则禁用OutGuess检测。
-s 修改检测算法的敏感度，该值的默认值为1。检测结果的匹配度与检测算法的敏感度成正比，算法敏感度的值越大，检测出的可疑文件包含敏感信息的可能性越大。
-d 打印带行号的调试信息。
-t 设置要检测哪些隐写工具（默认检测jopi），可设置的选项如下：
j 检测图像中的信息是否是用jsteg嵌入的。
o 检测图像中的信息是否是用outguess嵌入的。
p 检测图像中的信息是否是用jphide嵌入的。
i 检测图像中的信息是否是用invisible secrets嵌入的。</code></pre><h4 id="JPHS"><a href="#JPHS" class="headerlink" title="JPHS"></a><a href="http://linux01.gwdg.de/~alatham/stego.html" target="_blank" rel="noopener">JPHS</a></h4><p>JPEG 图像的信息隐藏软件 JPHS，它是由 Allan Latham 开发设计实现在 Windows 和 Linux 系统平台针对有损压缩 JPEG 文件进行信息加密隐藏和探测提取的工具。软件里面主要包含了两个程序 JPHIDE 和 JPSEEK。JPHIDE 程序主要是实现将信息文件加密隐藏到 JPEG 图像功能，而 JPSEEK 程序主要实现从用 JPHIDE 程序加密隐藏得到的 JPEG 图像探测提取信息文件，Windows 版本的 JPHS 里的 JPHSWIN 程序具有图形化操作界面且具备 JPHIDE 和 JPSEEK 的功能。</p>
<h4 id="SilentEye"><a href="#SilentEye" class="headerlink" title="SilentEye"></a><a href="http://silenteye.v1kings.io/" target="_blank" rel="noopener">SilentEye</a></h4><blockquote>
<p>SilentEye is a cross-platform application design for an easy use of steganography, in this case hiding messages into pictures or sounds. It provides a pretty nice interface and an easy integration of new steganography algorithm and cryptography process by using a plug-ins system.</p>
</blockquote>
<h2 id="GIF"><a href="#GIF" class="headerlink" title="GIF"></a>GIF</h2><h3 id="文件结构-1"><a href="#文件结构-1" class="headerlink" title="文件结构"></a>文件结构</h3><p>一个 GIF 文件的结构可分为</p>
<ul>
<li>文件头（File Header）<ul>
<li>GIF 文件署名（Signature）</li>
<li>版本号（Version）</li>
</ul>
</li>
<li>GIF 数据流（GIF Data Stream）<ul>
<li>控制标识符</li>
<li>图象块（Image Block）</li>
<li>其他的一些扩展块</li>
</ul>
</li>
<li>文件终结器（Trailer）</li>
</ul>
<p>下表显示了一个 GIF 文件的组成结构：</p>
<p><img src="/images/loading.gif" data-original="../images/CTF/gif.png" alt="img"></p>
<p>中间的那个大块可以被重复任意次</p>
<h4 id="文件头"><a href="#文件头" class="headerlink" title="文件头"></a>文件头</h4><p>GIF 署名（Signature）和版本号（Version）。GIF 署名用来确认一个文件是否是 GIF 格式的文件，这一部分由三个字符组成：<code>GIF</code>；文件版本号也是由三个字节组成，可以为 <code>87a</code> 或 <code>89a</code>。</p>
<h4 id="逻辑屏幕标识符（Logical-Screen-Descriptor）"><a href="#逻辑屏幕标识符（Logical-Screen-Descriptor）" class="headerlink" title="逻辑屏幕标识符（Logical Screen Descriptor）"></a>逻辑屏幕标识符（Logical Screen Descriptor）</h4><p>Logical Screen Descriptor（逻辑屏幕描述符）紧跟在 header 后面。这个块告诉 decoder（解码器）图片需要占用的空间。它的大小固定为 7 个字节，以 canvas width（画布宽度）和 canvas height（画布高度）开始。</p>
<h4 id="全局颜色列表（Global-Color-Table）"><a href="#全局颜色列表（Global-Color-Table）" class="headerlink" title="全局颜色列表（Global Color Table）"></a>全局颜色列表（Global Color Table）</h4><p>GIF 格式可以拥有 global color table，或用于针对每个子图片集，提供 local color table。每个 color table 由一个 RGB（就像通常我们见到的（255，0，0）红色 那种）列表组成。</p>
<h4 id="图像标识符（Image-Descriptor）"><a href="#图像标识符（Image-Descriptor）" class="headerlink" title="图像标识符（Image Descriptor）"></a>图像标识符（Image Descriptor）</h4><p>一个 GIF 文件一般包含多个图片。之前的图片渲染模式一般是将多个图片绘制到一个大的（virtual canvas）虚拟画布上，而现在一般将这些图片集用于实现动画。</p>
<p>每个 image 都以一个 image descriptor block（图像描述块）作为开头，这个块固定为 10 字节。</p>
<p><img src="/images/loading.gif" data-original="https://ctf-wiki.org/misc/picture/figure/imagesdescription.png" alt="img"></p>
<h4 id="图像数据（Image-Data）"><a href="#图像数据（Image-Data）" class="headerlink" title="图像数据（Image Data）"></a>图像数据（Image Data）</h4><p>终于到了图片数据实际存储的地方。Image Data 是由一系列的输出编码（output codes）构成，它们告诉 decoder（解码器）需要绘制在画布上的每个颜色信息。这些编码以字节码的形式组织在这个块中。</p>
<h4 id="文件终结器（Trailer）"><a href="#文件终结器（Trailer）" class="headerlink" title="文件终结器（Trailer）"></a>文件终结器（Trailer）</h4><p>该块为一个单字段块，用来指示该数据流的结束。取固定值 0x3b.</p>
<p>更多参见 <a href="http://www.jianshu.com/p/df52f1511cf8" target="_blank" rel="noopener">gif 格式图片详细解析</a></p>
<h3 id="空间轴"><a href="#空间轴" class="headerlink" title="空间轴"></a>空间轴</h3><p>由于 GIF 的动态特性，由一帧帧的图片构成，所以每一帧的图片，多帧图片间的结合，都成了隐藏信息的一种载体。</p>
<p>对于需要分离的 GIF 文件, 可以使用<code>convert</code>命令将其每一帧分割开来</p>
<p>` sourceCode shell root in ~/Desktop/tmp λ convert cake.gif cake.png root in ~/Desktop/tmp λ ls cake-0.png cake-1.png cake-2.png cake-3.png cake.gif</p>
<pre><code>### 例题

&gt; WDCTF-2017:3-2

打开gif后，思路很清晰，分离每一帧图片后，将起合并得到完整的二维码即可

``` sourceCode python
from  PIL import Image


flag = Image.new("RGB",(450,450))

for i in range(2):
    for j in range(2):
        pot = "cake-{}.png".format(j+i*2)
        potImage = Image.open(pot)
        flag.paste(potImage,(j*225,i*225))
flag.save('./flag.png')</code></pre><p>扫码后得到一串 16 进制字符串</p>
<pre><code>03f30d0ab8c1aa5....74080006030908</code></pre><p>开头<code>03f3</code>为<code>pyc</code>文件的头，恢复为<code>python</code>脚本后直接运行得到 flag</p>
<h3 id="时间轴"><a href="#时间轴" class="headerlink" title="时间轴"></a>时间轴</h3><p>GIF 文件每一帧间的时间间隔也可以作为信息隐藏的载体。</p>
<p>例如在当时在 XMan 选拔赛出的一题</p>
<blockquote>
<p>XMAN-2017:100.gif</p>
</blockquote>
<p>通过<code>identify</code>命令清晰的打印出每一帧的时间间隔</p>
<pre><code>$ identify -format "%s %T \n" 100.gif
0 66
1 66
2 20
3 10
4 20
5 10
6 10
7 20
8 20
9 20
10 20
11 10
12 20
13 20
14 10
15 10</code></pre><p>推断 <code>20 &amp; 10</code> 分别代表 <code>0 &amp; 1</code>，提取每一帧间隔并进行转化。</p>
<pre><code>$ cat flag|cut -d ' ' -f 2|tr -d '66'|tr -d '\n'|tr -d '0'|tr '2' '0'
0101100001001101010000010100111001111011001110010011011000110101001101110011010101100010011001010110010101100100001101000110010001100101011000010011000100111000011001000110010101100100001101000011011100110011001101010011011000110100001100110110000101100101011000110110011001100001001100110011010101111101#</code></pre><p>最后转 ASCII 码得到 flag。</p>
<h3 id="隐写软件-2"><a href="#隐写软件-2" class="headerlink" title="隐写软件"></a>隐写软件</h3><h4 id="F5-steganography"><a href="#F5-steganography" class="headerlink" title="F5-steganography"></a><a href="https://github.com/matthewgao/F5-steganography" target="_blank" rel="noopener">F5-steganography</a></h4><h1 id="音频隐写"><a href="#音频隐写" class="headerlink" title="音频隐写"></a>音频隐写</h1><p>与音频相关的 CTF 题目主要使用了隐写的策略，主要分为 MP3 隐写，LSB 隐写，波形隐写，频谱隐写等等。</p>
<h2 id="常见手段"><a href="#常见手段" class="headerlink" title="常见手段"></a>常见手段</h2><p>通过 <code>binwalk</code> 以及 <code>strings</code> 可以发现的信息不再详述。</p>
<h2 id="MP3-隐写"><a href="#MP3-隐写" class="headerlink" title="MP3 隐写"></a>MP3 隐写</h2><h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><p>MP3 隐写主要是使用 <a href="http://www.petitcolas.net/steganography/mp3stego/" target="_blank" rel="noopener">Mp3Stego</a> 工具进行隐写，其基本介绍及使用方法如下</p>
<blockquote>
<p>MP3Stego will hide information in MP3 files during the compression process. The data is first compressed, encrypted and then hidden in the MP3 bit stream.</p>
</blockquote>
<pre><code>encode -E hidden_text.txt -P pass svega.wav svega_stego.mp3
decode -X -P pass svega_stego.mp3</code></pre><h3 id="例题-2"><a href="#例题-2" class="headerlink" title="例题"></a>例题</h3><blockquote>
<p>ISCC-2016: Music Never Sleep</p>
</blockquote>
<p>初步观察后，由 <code>strings</code> 无发现，听音频无异常猜测使用隐写软件隐藏数据。</p>
<p><img src="/images/loading.gif" data-original="https://ctf-wiki.org/misc/audio/figure/1.jpg" alt="img"></p>
<p>得到密码后使用 <code>Mp3Stego</code> 解密。</p>
<pre><code>decode.exe -X ISCC2016.mp3 -P bfsiscc2016</code></pre><p>得到文件 <code>iscc2016.mp3.txt</code>:</p>
<pre><code>Flag is SkYzWEk0M1JOWlNHWTJTRktKUkdJTVpXRzVSV0U2REdHTVpHT1pZPQ== ???</code></pre><p>Base64 &amp;&amp; Base32 后得到 flag。</p>
<h2 id="波形"><a href="#波形" class="headerlink" title="波形"></a>波形</h2><h3 id="原理-1"><a href="#原理-1" class="headerlink" title="原理"></a>原理</h3><p>通常来说，波形方向的题，在观察到异常后，使用相关软件（Audacity, Adobe Audition 等）观察波形规律，将波形进一步转化为 01 字符串等，从而提取转化出最终的 flag。</p>
<h3 id="例题-3"><a href="#例题-3" class="headerlink" title="例题"></a>例题</h3><blockquote>
<p>ISCC-2017: Misc-04</p>
</blockquote>
<p>其实这题隐藏的信息在最开始的一段音频内，不细心听可能会误认为是隐写软件。</p>
<p><img src="/images/loading.gif" data-original="https://ctf-wiki.org/misc/audio/figure/3.png" alt="img"></p>
<p>以高为 1 低为 0，转换得到 <code>01</code> 字符串。</p>
<pre><code>110011011011001100001110011111110111010111011000010101110101010110011011101011101110110111011110011111101</code></pre><p>转为 ASCII，摩斯密码解密，得到 flag。</p>
<p>Note</p>
<p>一些较复杂的可能会先对音频进行一系列的处理，如滤波等。例如 <a href="https://www.40huo.cn/blog/jarvisoj-misc-writeup.html" target="_blank" rel="noopener">JarvisOJ - 上帝之音 Writeup</a></p>
<h2 id="频谱"><a href="#频谱" class="headerlink" title="频谱"></a>频谱</h2><h3 id="原理-2"><a href="#原理-2" class="headerlink" title="原理"></a>原理</h3><p>音频中的频谱隐写是将字符串隐藏在频谱中，此类音频通常会有一个较明显的特征，听起来是一段杂音或者比较刺耳。</p>
<h3 id="例题-4"><a href="#例题-4" class="headerlink" title="例题"></a>例题</h3><blockquote>
<p>Su-ctf-quals-2014:hear_with_your_eyes</p>
</blockquote>
<p><img src="/images/loading.gif" data-original="https://ctf-wiki.org/misc/audio/figure/4.png" alt="img"></p>
<h2 id="LSB-音频隐写"><a href="#LSB-音频隐写" class="headerlink" title="LSB 音频隐写"></a>LSB 音频隐写</h2><h3 id="原理-3"><a href="#原理-3" class="headerlink" title="原理"></a>原理</h3><p>类似于图片隐写中的 LSB 隐写，音频中也有对应的 LSB 隐写。主要可以使用 <a href="http://silenteye.v1kings.io/" target="_blank" rel="noopener">Silenteye</a> 工具，其介绍如下：</p>
<blockquote>
<p>SilentEye is a cross-platform application design for an easy use of steganography, in this case hiding messages into pictures or sounds. It provides a pretty nice interface and an easy integration of new steganography algorithm and cryptography process by using a plug-ins system.</p>
</blockquote>
<h3 id="例题-5"><a href="#例题-5" class="headerlink" title="例题"></a>例题</h3><blockquote>
<p>2015 广东省强网杯 - Little Apple</p>
</blockquote>
<p>直接使用 <code>silenteye</code> 即可。</p>
<p><img src="/images/loading.gif" data-original="https://ctf-wiki.org/misc/audio/figure/2.jpg" alt="img"></p>
<h2 id="延伸"><a href="#延伸" class="headerlink" title="延伸"></a>延伸</h2><ul>
<li><a href="https://ethackal.github.io/2015/10/05/derbycon-ctf-wav-steganography/" target="_blank" rel="noopener">音频中的 LSB</a></li>
<li><a href="http://bobao.360.cn/learning/detail/243.html" target="_blank" rel="noopener">隐写术总结</a></li>
</ul>
<h1 id="流量包分析"><a href="#流量包分析" class="headerlink" title="流量包分析"></a>流量包分析</h1><h2 id="流量包分析简介"><a href="#流量包分析简介" class="headerlink" title="流量包分析简介"></a>流量包分析简介</h2><p>CTF 比赛中, 流量包的取证分析是另一项重要的考察方向。</p>
<p>通常比赛中会提供一个包含流量数据的 PCAP 文件，有时候也会需要选手们先进行修复或重构传输文件后，再进行分析。</p>
<p>PCAP 这一块作为重点考察方向，复杂的地方在于数据包里充满着大量无关的流量信息，因此如何分类和过滤数据是参赛者需要完成的工作。</p>
<p>总的来说有以下几个步骤</p>
<ul>
<li>总体把握<ul>
<li>协议分级</li>
<li>端点统计</li>
</ul>
</li>
<li>过滤赛选<ul>
<li>过滤语法</li>
<li>Host，Protocol，contains，特征值</li>
</ul>
</li>
<li>发现异常<ul>
<li>特殊字符串</li>
<li>协议某字段</li>
<li>flag 位于服务器中</li>
</ul>
</li>
<li>数据提取<ul>
<li>字符串取</li>
<li>文件提取</li>
</ul>
</li>
</ul>
<p>总的来说比赛中的流量分析可以概括为以下三个方向:</p>
<ul>
<li>流量包修复</li>
<li>协议分析</li>
<li>数据提取</li>
</ul>
<h2 id="PCAP-文件修复"><a href="#PCAP-文件修复" class="headerlink" title="PCAP 文件修复"></a>PCAP 文件修复</h2><h3 id="PCAP-文件结构"><a href="#PCAP-文件结构" class="headerlink" title="PCAP 文件结构"></a>PCAP 文件结构</h3><p>一般来说, 对于 <code>PCAP</code> 文件格式考察较少，且通常都能借助于现成的工具如 <code>pcapfix</code> 直接修复，这里大致介绍下几个常见的块，详细可以翻看 <a href="http://www.tcpdump.org/pcap/pcap.html" target="_blank" rel="noopener">Here</a>。</p>
<ul>
<li>Tools<ul>
<li><a href="https://f00l.de/hacking/pcapfix.php" target="_blank" rel="noopener">PcapFix Online</a></li>
<li><a href="https://github.com/Rup0rt/pcapfix/tree/devel" target="_blank" rel="noopener">PcapFix</a></li>
</ul>
</li>
</ul>
<p>一般文件结构</p>
<pre><code>    0                   1                   2                   3   
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                          Block Type                           |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                      Block Total Length                       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   /                          Block Body                           /
   /          /* variable length, aligned to 32 bits */            /
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                      Block Total Length                       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</code></pre><p>目前所定义的常见块类型有</p>
<ol>
<li>Section Header Block: it defines the most important characteristics of the capture file.</li>
<li>Interface Description Block: it defines the most important characteristics of the interface(s) used for capturing traffic.</li>
<li>Packet Block: it contains a single captured packet, or a portion of it.</li>
<li>Simple Packet Block: it contains a single captured packet, or a portion of it, with only a minimal set of information about it.</li>
<li>Name Resolution Block: it defines the mapping from numeric addresses present in the packet dump and the canonical name counterpart.</li>
<li>Capture Statistics Block: it defines how to store some statistical data (e.g. packet dropped, etc) which can be useful to undestand the conditions in which the capture has been made.</li>
</ol>
<h3 id="常见块"><a href="#常见块" class="headerlink" title="常见块"></a>常见块</h3><h4 id="Section-Header-BlocK-文件头"><a href="#Section-Header-BlocK-文件头" class="headerlink" title="Section Header BlocK(文件头)"></a>Section Header BlocK(文件头)</h4><p>必须存在, 意味着文件的开始</p>
<pre><code>    0                   1                   2                   3   
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                Byte-Order Magic (0x1A2B3C4D)                  |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |   Major Version(主版本号)   |    Minor Version(次版本号)        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   |                          Section Length                       |
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   /                                                               /
   /                      Options (variable)                       /
   /                                                               /
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</code></pre><h4 id="Interface-Description-Block-接口描述"><a href="#Interface-Description-Block-接口描述" class="headerlink" title="Interface Description Block(接口描述)"></a>Interface Description Block(接口描述)</h4><p>必须存在, 描述接口特性</p>
<pre><code>    0                   1                   2                   3   
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |           LinkType            |           Reserved            |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                  SnapLen(每个数据包最大字节数)                  |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   /                                                               /
   /                      Options (variable)                       /
   /                                                               /
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</code></pre><h4 id="Packet-Block-数据块"><a href="#Packet-Block-数据块" class="headerlink" title="Packet Block(数据块)"></a>Packet Block(数据块)</h4><pre><code>    0                   1                   2                   3   
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |         Interface ID          |          Drops Count          |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                     Timestamp (High)   标准的Unix格式          |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                        Timestamp (Low)                        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                         Captured Len                          |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                          Packet Len                           |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   /                          Packet Data                          /
   /          /* variable length, aligned to 32 bits */            /
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   /                      Options (variable)                       /
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</code></pre><h3 id="例题-6"><a href="#例题-6" class="headerlink" title="例题"></a>例题</h3><blockquote>
<p>题目：第一届 “百度杯” 信息安全攻防总决赛 线上选拔赛：find the flag</p>
<p>WP：<a href="https://www.cnblogs.com/ECJTUACM-873284962/p/9884447.html" target="_blank" rel="noopener">https://www.cnblogs.com/ECJTUACM-873284962/p/9884447.html</a></p>
</blockquote>
<p>首先我们拿到这样一道流量包的题目，题目名称为 <code>find the flag</code> 。这里面给了很多提示信息，要我们去找到 <code>flag</code> 。</p>
<p><strong>第一步，搜索 <code>flag</code> 字样</strong></p>
<p>我们先去搜索看看流量包里面有没有 <code>flag</code> 。我们使用 <code>strings</code> 命令去找一下流量包， <code>Windows</code> 的朋友可以用 <code>notepad++</code> 的搜索功能去寻找。</p>
<p>搜索命令如下：</p>
<pre><code>strings findtheflag.cap | grep flag</code></pre><p>搜索结果如下：</p>
<p><img src="/images/loading.gif" data-original="../images/CTF/strings-to-flag.png" alt="strings-to-flag"></p>
<p>我们发现搜出了一大堆的东西，我们通过管道去过滤出 <code>flag</code> 信息，似乎没有发现我们所需要找的答案。</p>
<p><strong>第二步，流量包修复</strong></p>
<p>我们用 <code>wireshark</code> 打开这个流量包</p>
<p><img src="/images/loading.gif" data-original="../images/CTF/wireshark-to-error.png" alt="wireshark-to-error"></p>
<p>我们发现这个流量包出现了异常现象，我们可以修复一下这个流量包。</p>
<p>这里我们用到一个在线工具：<a href="http://f00l.de/hacking/pcapfix.php" target="_blank" rel="noopener">http://f00l.de/hacking/pcapfix.php</a></p>
<p>这个工具可以帮助我们快速地将其流量包修复为 <code>pcap</code> 包。</p>
<p>我们对其进行在线修复。</p>
<p><img src="/images/loading.gif" data-original="../images/CTF/repaire-to-pcap.png" alt="repaire-to-pcap"></p>
<p>修复完毕后点击 <code>Get your repaired PCAP-file here.</code> 即可下载流量包，然后我们用 <code>wireshark</code> 打开。</p>
<p>既然还是要找 <code>flag</code> ，我们可以先看看这个流量包。</p>
<p><strong>第三步，追踪 TCP 流</strong></p>
<p>我们追踪一下 TCP 流，看看有没有什么突破？</p>
<p><img src="/images/loading.gif" data-original="../images/CTF/wireshark-to-stream.png" alt="wireshark-to-stream"></p>
<p>我们通过追踪 <code>TCP</code> 流，可以看到一些版本信息， <code>cookie</code> 等等，我们还是发现了一些很有意思的东西。</p>
<p>从 <code>tcp.stream eq 29</code> 到 <code>tcp.stream eq 41</code> 只显示了 <code>where is the flag?</code> 这个字样，难道这是出题人在告诉我们 <code>flag</code> 在这里嘛？</p>
<p><strong>第四步，查找分组字节流</strong></p>
<p>我们追踪到 <code>tcp.stream eq 29</code> 的时候，在 <code>Identification</code> 信息中看到了 <code>flag</code> 中的 <code>lf</code> 字样，我们可以继续追踪下一个流，在 <code>tcp.stream eq 30</code> 的 <code>Identification</code> 信息中看到了 <code>flag</code> 中的 <code>ga</code> 字样，我们发现将两个包中 <code>Identification</code> 信息对应的字段从右至左组合，恰好就是 <code>flag</code> ！于是我们可以大胆地猜测， <code>flag</code> 肯定是藏在这里面。</p>
<p>我们直接通过搜索 -&gt; 字符串搜索 -&gt; 分组字节流 -&gt; 搜索关键字 <code>flag</code> 即可，按照同样的方式连接后面相连数据包的 <code>Identification</code> 信息对应的字段，即可找到最终的 flag！</p>
<p>下面是搜索的截图：</p>
<p><img src="/images/loading.gif" data-original="../images/CTF/find-the-flag-01.png" alt="find-the-flag"></p>
<p><img src="/images/loading.gif" data-original="../images/CTF/find-the-flag-02.png" alt="find-the-flag"></p>
<p><img src="/images/loading.gif" data-original="../images/CTF/find-the-flag-03.png" alt="find-the-flag"></p>
<p><img src="/images/loading.gif" data-original="../images/CTF/find-the-flag-04.png" alt="find-the-flag"></p>
<p><img src="/images/loading.gif" data-original="../images/CTF/find-the-flag-05.png" alt="find-the-flag"></p>
<p><img src="/images/loading.gif" data-original="../images/CTF/find-the-flag-06.png" alt="find-the-flag"></p>
<p><img src="/images/loading.gif" data-original="../images/CTF/find-the-flag-07.png" alt="find-the-flag"></p>
<p><img src="/images/loading.gif" data-original="../images/CTF/find-the-flag-08.png" alt="find-the-flag"></p>
<p><img src="/images/loading.gif" data-original="../images/CTF/find-the-flag-09.png" alt="find-the-flag"></p>
<p><img src="/images/loading.gif" data-original="../images/CTF/find-the-flag-10.png" alt="find-the-flag"></p>
<p><img src="/images/loading.gif" data-original="../images/CTF/find-the-flag-11.png" alt="find-the-flag"></p>
<p><img src="/images/loading.gif" data-original="../images/CTF/find-the-flag-12.png" alt="find-the-flag"></p>
<p>所以最终的 <code>flag</code> 为：<strong>flag{aha!_you_found_it!}</strong></p>
<h2 id="数据提取"><a href="#数据提取" class="headerlink" title="数据提取"></a>数据提取</h2><p>这一块是流量包中另一个重点, 通过对协议分析, 找到了题目的关键点, 如何提取数据成了接下来的关键问题</p>
<h3 id="wireshark"><a href="#wireshark" class="headerlink" title="wireshark"></a>wireshark</h3><h4 id="wireshark-自动分析"><a href="#wireshark-自动分析" class="headerlink" title="wireshark 自动分析"></a>wireshark 自动分析</h4><pre><code>file -&gt; export objects -&gt; http</code></pre><h4 id="手动数据提取"><a href="#手动数据提取" class="headerlink" title="手动数据提取"></a>手动数据提取</h4><pre><code>file-&gt;export selected Packet Bytes</code></pre><h3 id="tshark"><a href="#tshark" class="headerlink" title="tshark"></a>tshark</h3><p>tshark 作为 wireshark 的命令行版, 高效快捷是它的优点, 配合其余命令行工具 (awk,grep) 等灵活使用, 可以快速定位, 提取数据从而省去了繁杂的脚本编写</p>
<p>再看<code>Google CTF 2016 Forensic-200</code>这一题, 可以通过 tshark 迅速完成解题</p>
<pre><code>what@kali:/tmp$ tshark -r capture.pcapng -T fields -e usb.capdata &gt; data2.txt
what@kali:/tmp$ # awk -F: 'function comp(v){if(v&gt;127)v-=256;return v}{x+=comp(strtonum("0x"$2));y+=comp(strtonum("0x"$3))}$1=="01"{print x,y}' data.txt &gt; data3.txt
what@kali:/tmp$ gnuplot
&gt; plot "data3.txt"</code></pre><ul>
<li>Step 1 鼠标协议中数据提取</li>
<li>Step 2 通过 awk 进行位置坐标转换</li>
<li>Step 3 形成图形</li>
</ul>
<hr>
<h4 id="常用方法"><a href="#常用方法" class="headerlink" title="常用方法"></a>常用方法</h4><blockquote>
<pre><code>tshark -r **.pcap –Y ** -T fields –e ** | **** &gt; data</code></pre></blockquote>
<pre><code>Usage:
  -Y &lt;display filter&gt;      packet displaY filter in Wireshark display filter
                           syntax
  -T pdml|ps|psml|json|jsonraw|ek|tabs|text|fields|?
                           format of text output (def: text)
  -e &lt;field&gt;               field to print if -Tfields selected (e.g. tcp.port,
                           _ws.col.Info)</code></pre><p>通过<code>-Y</code>过滤器 (与 wireshark 一致), 然后用<code>-T filds -e</code>配合指定显示的数据段 (比如 usb.capdata)</p>
<ul>
<li><pre><code>tips</code></pre><ul>
<li><code>-e</code>后的参数不确定可以由 <code>wireshark</code> 右击需要的数据选中后得到</li>
</ul>
</li>
</ul>
<h4 id="例题-7"><a href="#例题-7" class="headerlink" title="例题"></a>例题</h4><blockquote>
<p>题目：<code>google-ctf-2016 : a-cute-stegosaurus-100</code></p>
</blockquote>
<p>这题的数据隐藏的非常巧妙, 而且有一张图片混淆视听, 需要对<code>tcp</code>协议非常熟悉, 所以当时做出来的人并不多, 全球只有 <code>26</code> 支队伍</p>
<p>在<code>tcp</code>报文段中有 6Bit 的状态控制码, 分别如下</p>
<ul>
<li>URG：紧急比特（urgent）, 当 URG＝1 时，表明紧急指针字段有效, 代表该封包为紧急封包。它告诉系统此报文段中有紧急数据，应尽快传送 (相当于高优先级的数据)</li>
<li>ACK：确认比特（Acknowledge）。只有当 ACK＝1 时确认号字段才有效, 代表这个封包为确认封包。当 ACK＝0 时，确认号无效。</li>
<li>PSH：（Push function）若为 1 时，代表要求对方立即传送缓冲区内的其他对应封包，而无需等缓冲满了才送。</li>
<li>RST：复位比特 (Reset) , 当 RST＝1 时，表明 TCP 连接中出现严重差错（如由于主机崩溃或其他原因），必须释放连接，然后再重新建立运输连接。</li>
<li>SYN：同步比特 (Synchronous)，SYN 置为 1，就表示这是一个连接请求或连接接受报文, 通常带有 SYN 标志的封包表示『主动』要连接到对方的意思。。</li>
<li>FIN：终止比特 (Final)，用来释放一个连接。当 FIN＝1 时，表明此报文段的发送端的数据已发送完毕，并要求释放运输连接。</li>
</ul>
<p>而这里的<code>tcp.urg</code>却为</p>
<p><img src="/images/loading.gif" data-original="https://ctf-wiki.org/misc/traffic/figure/urg.png" alt="urg"></p>
<p>通过 tshark 提取<code>tcp.urg</code>然后去除 0 的字段, 换行符转<code>,</code>直接转换成 python 的列表, 转 ascii 即可得到 flag</p>
<pre><code>⚡ root@kali:  tshark -r Stego-200_urg.pcap -T fields -e  tcp.urgent_pointer|egrep -vi "^0$"|tr '\n' ','
Running as user "root" and group "root". This could be dangerous.
67,84,70,123,65,110,100,95,89,111,117,95,84,104,111,117,103,104,116,95,73,116,95,87,97,115,95,73,110,95,84,104,101,95,80,105,99,116,117,114,101,125,#
...
&gt;&gt;&gt; print "".join([chr(x) for x in arr]) #python转换ascii
CTF{And_You_Thought_It_Was_In_The_Picture}</code></pre><blockquote>
<p>题目：<code>stego-150_ears.xz</code></p>
</blockquote>
<p><strong>Step 1</strong></p>
<p>通过<code>file</code>命令不断解压得到 <code>pcap</code> 文件</p>
<pre><code>➜  Desktop file ears
ears: XZ compressed data
➜  Desktop unxz &lt; ears &gt; file_1
➜  Desktop file file_1
file_1: POSIX tar archive
➜  Desktop 7z x file_1

7-Zip [64] 16.02 : Copyright (c) 1999-2016 Igor Pavlov : 2016-05-21
p7zip Version 16.02 (locale=en_US.UTF-8,Utf16=on,HugeFiles=on,64 bits,1 CPU Intel(R) Core(TM) i7-4710MQ CPU @ 2.50GHz (306C3),ASM,AES-NI)

    Scanning the drive for archives:
    1 file, 4263936 bytes (4164 KiB)

    Extracting archive: file_1
    --
    Path = file_1
    Type = tar
    Physical Size = 4263936
    Headers Size = 1536
    Code Page = UTF-8

    Everything is Ok

    Size:       4262272
    Compressed: 4263936</code></pre><p><strong>Step 2</strong></p>
<p>通过 <code>wireshark</code> 发现 <code>dns</code> 中回应名字存在异常，组成 <code>16</code> 进制的 <code>png</code> 文件</p>
<p>采用 <code>tshark</code> 进行提取，提取 <code>dns</code> 中的数据, 筛选具体报文形式<code>\w{4,}.asis.io</code></p>
<pre><code>tshark -r forensic_175_d78a42edc01c9104653776f16813d9e5 -T fields -e dns.qry.name -e dns.flags|grep 8180|awk '{if ($1~/\w{4,}.asis.io/) print $1}'|awk -F '.' '{print $1}'|tr -d '\n' &gt; png</code></pre><p><strong>Step 3</strong></p>
<p><code>16</code> 进制还原图片</p>
<pre><code>xxd -p -r png flag</code></pre><h3 id="自定义协议"><a href="#自定义协议" class="headerlink" title="自定义协议"></a>自定义协议</h3><p>提取数据存在一类特殊情况，即传输的数据本身使用自定义协议，下面用 <code>HITCON 2018</code> 的两道 Misc 为例说明。</p>
<h4 id="例题分析"><a href="#例题分析" class="headerlink" title="例题分析"></a>例题分析</h4><ul>
<li><a href="https://github.com/ctf-wiki/ctf-challenges/tree/master/misc/cap/2018HITCON-ev3-basic" target="_blank" rel="noopener">HITCON-2018 : ev3 basic</a></li>
<li><a href="https://github.com/ctf-wiki/ctf-challenges/tree/master/misc/cap/2018HITCON-ev3-scanner" target="_blank" rel="noopener">HITCON-2018 : ev3 scanner</a></li>
</ul>
<p><strong>ev3 basic</strong></p>
<h5 id="确定数据"><a href="#确定数据" class="headerlink" title="确定数据"></a>确定数据</h5><p>对于这类题目，首先分析有效数据位于哪些包中。观察流量，通讯双方为 <code>localhost</code> 和 <code>LegoSystem</code> 。其中大量标为 <code>PKTLOG</code> 的数据包都是日志，此题中不需关注。简单浏览其余各个协议的流量，发现仅 <code>RFCOMM</code> 协议中存在没有被 <code>wireshark</code> 解析的 <code>data</code> 段，而 <code>RFCOMM</code> 正是蓝牙使用的<a href="https://en.wikipedia.org/wiki/List_of_Bluetooth_protocols#Radio_frequency_communication_(RFCOMM)" target="_blank" rel="noopener">传输层协议</a>之一。</p>
<p>由前述 <code>tshark</code> 相关介绍，可以通过以下命令提取数据：</p>
<pre><code>tshark -r .\ev3_basic.pklg -T fields -e data -Y "btrfcomm"</code></pre><h5 id="分析协议"><a href="#分析协议" class="headerlink" title="分析协议"></a>分析协议</h5><p>找到数据后，需要确定数据格式。如何查找资料可以参考 <code>信息搜集技术</code> 一节，此处不再赘述。总之由 <code>ev3</code> 这个关键词出发，我们最终知道这种通信方式传输的内容被称之为 <a href="http://ev3directcommands.blogspot.com/2016/01/no-title-specified-page-table-border_94.html" target="_blank" rel="noopener">Direct Command</a>，所使用的是乐高自定义的一种[简单应用层协议](<a href="https://le-www-live-s.legocdn.com/sc/media/files/ev3-developer-kit/lego" target="_blank" rel="noopener">https://le-www-live-s.legocdn.com/sc/media/files/ev3-developer-kit/lego</a> mindstorms ev3 communication developer kit-f691e7ad1e0c28a4cfb0835993d76ae3.pdf?la=en-us)，<code>Command</code> 本身格式由乐高的手册 <a href="http://www.lego.com/en-gb/mindstorms/downloads" target="_blank" rel="noopener">EV3 Firmware Developer Kit</a> 定义。<em>（查找过程并不像此处简单而直观，也是本题的关键点之一。）</em></p>
<p>在乐高的协议中，发送和回复遵从不同格式。在 <code>ev3 basic</code> 中，所有回复流量都相同，通过手册可知内容代表 <code>ok</code> ，没有实际含义，而发送的每个数据包都包含了一条指令。由协议格式解析出指令的 <code>Opcode</code> 均为 <code>0x84</code> ，代表 <code>UI_DRAW</code> 函数，且 <code>CMD</code> 是 <code>0x05</code> ，代表 <code>TEXT</code> 。之后是四个参数，<code>Color</code>, <code>X0</code>, <code>Y0</code>, <code>STRING</code> 。此处需要注意乐高的单个参数字节数并不固定，即便手册上标明了数据类型是 <code>DATA16</code> ，仍然可能使用一个字节长度的参数，需要参照手册中 <code>Parameter encoding</code> 一节及<a href="http://ev3directcommands.blogspot.com/2016/01/ev3-direct-commands-lesson-02-pre.html" target="_blank" rel="noopener">相关文章</a>。</p>
<p>尝试分析几个命令，发现每个指令都会在屏幕特定位置打印一个字符，这与提供的图片相符。</p>
<h5 id="处理结果"><a href="#处理结果" class="headerlink" title="处理结果"></a>处理结果</h5><p>理解数据内容后，通过脚本提取所有命令并解析参数，需要注意单个参数的字节数不固定。</p>
<p>得到所有命令的参数后，可以将每个字符其按照坐标绘制在屏幕上。较简单的做法是先按 <code>X</code> 后按 <code>Y</code> 排序，直接输出即可。</p>
<p><strong>ev3 scanner</strong></p>
<p>第二题的做法与第一题基本相同，难度增加的地方在于：</p>
<ul>
<li>发送的命令不再单一，包括读取传感器信息、控制 ev3 运动</li>
<li>回复也包含信息，主要是传感器读取的内容</li>
<li>函数的参数更复杂，解析难度更大</li>
<li>解析命令得到的结果需要更多处理</li>
</ul>
<p><code>ev3 scanner</code> 此处不再提供详细方法，可作为练习加深对这一类型题目的理解。</p>
<h1 id="协议分析"><a href="#协议分析" class="headerlink" title="协议分析"></a>协议分析</h1><h2 id="协议分析概述"><a href="#协议分析概述" class="headerlink" title="协议分析概述"></a>协议分析概述</h2><script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://jackhcc.github.io" rel="external nofollow noreferrer">杰克成</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://jackhcc.github.io/posts/ctf-misc.html">https://jackhcc.github.io/posts/ctf-misc.html</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="https://jackhcc.github.io" target="_blank">杰克成</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/MISC/">
                                    <span class="chip bg-color">MISC</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/share/css/share.min.css">

<div id="article-share">
    
    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/images/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/medias/reward/aliqr.png" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/images/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/medias/reward/wxqr.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>
            
        </div>
    </div>

    
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/gitalk/gitalk.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/css/my-gitalk.css">

<div class="card gitalk-card" data-aos="fade-up">
    <div class="comment_headling" style="font-size: 20px; font-weight: 700; position: relative; left: 20px; top: 15px; padding-bottom: 5px;">
        <i class="fas fa-comments fa-fw" aria-hidden="true"></i>
        <span>评论</span>
    </div>
    <div id="gitalk-container" class="card-content"></div>
</div>

<script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/gitalk/gitalk.min.js"></script>
<script>
    let gitalk = new Gitalk({
        clientID: '3821a0bbb773038a51fc',
        clientSecret: '4b30b507d67ec5497ec0e77f43f80cb3e0d7dd3a',
        repo: 'JackHCC.github.io',
        owner: 'JackHCC',
        admin: "JackHCC",
        id: '2021-08-08T22-13-50',
        distractionFreeMode: false  // Facebook-like distraction free mode
    });

    gitalk.render('gitalk-container');
</script>
    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/posts/gensim.html">
                    <div class="card-image">
                        
                        
                        <img src="/images/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/medias/featureimages/17.jpg" class="responsive-img" alt="Gensim API">
                        
                        <span class="card-title">Gensim API</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            Gensim Python包详解
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2021-08-09
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Deep-Learning/" class="post-category">
                                    Deep Learning
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/NLP/">
                        <span class="chip bg-color">NLP</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/posts/word2vec.html">
                    <div class="card-image">
                        
                        
                        <img src="/images/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/medias/featureimages/0.jpg" class="responsive-img" alt="word2vec原理理解">
                        
                        <span class="card-title">word2vec原理理解</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            word2vec词嵌入
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2021-08-06
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Deep-Learning/" class="post-category">
                                    Deep Learning
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/NLP/">
                        <span class="chip bg-color">NLP</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/codeBlock/codeShrink.js"></script>


<!-- 代码块折行 -->

<style type="text/css">
code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }
</style>


    

</main>



    <footer class="page-footer bg-color">
    <div class="container row center-align" style="margin-bottom: 15px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            <span id="year">2020</span>
            <a href="https://jackhcc.github.io" target="_blank">杰克成</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                class="white-color">821.2k</span>&nbsp;字
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;次
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;人
            </span>
            
            <br>
            
            <span id="sitetime">载入运行时间...</span>
            <script>
                function siteTime() {
                    var seconds = 1000;
                    var minutes = seconds * 60;
                    var hours = minutes * 60;
                    var days = hours * 24;
                    var years = days * 365;
                    var today = new Date();
                    var startYear = "2020";
                    var startMonth = "2";
                    var startDate = "27";
                    var startHour = "6";
                    var startMinute = "30";
                    var startSecond = "0";
                    var todayYear = today.getFullYear();
                    var todayMonth = today.getMonth() + 1;
                    var todayDate = today.getDate();
                    var todayHour = today.getHours();
                    var todayMinute = today.getMinutes();
                    var todaySecond = today.getSeconds();
                    var t1 = Date.UTC(startYear, startMonth, startDate, startHour, startMinute, startSecond);
                    var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
                    var diff = t2 - t1;
                    var diffYears = Math.floor(diff / years);
                    var diffDays = Math.floor((diff / days) - diffYears * 365);
                    var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
                    var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) /
                        minutes);
                    var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours -
                        diffMinutes * minutes) / seconds);
                    if (startYear == todayYear) {
                        document.getElementById("year").innerHTML = todayYear;
                        document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffDays + " 天 " + diffHours +
                            " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    } else {
                        document.getElementById("year").innerHTML = startYear + " - " + todayYear;
                        document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffYears + " 年 " + diffDays +
                            " 天 " + diffHours + " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    }
                }
                setInterval(siteTime, 1000);
            </script>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/JackHCC" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:jackcc0701@163.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>



    <a href="https://www.facebook.com/profile.php?id=100046343443643" class="tooltipped" target="_blank" data-tooltip="关注我的Facebook: https://www.facebook.com/profile.php?id=100046343443643" data-position="top" data-delay="50">
        <i class="fab fa-facebook-f"></i>
    </a>



    <a href="https://twitter.com/JackChe66021834" class="tooltipped" target="_blank" data-tooltip="关注我的Twitter: https://twitter.com/JackChe66021834" data-position="top" data-delay="50">
        <i class="fab fa-twitter"></i>
    </a>



    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=2508074836" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 2508074836" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>



    <a href="https://weibo.com/u/6885584679" class="tooltipped" target="_blank" data-tooltip="关注我的微博: https://weibo.com/u/6885584679" data-position="top" data-delay="50">
        <i class="fab fa-weibo"></i>
    </a>



    <a href="https://www.zhihu.com/people/8f8482f01f0d6a04e844efe32e0f0710" class="tooltipped" target="_blank" data-tooltip="关注我的知乎: https://www.zhihu.com/people/8f8482f01f0d6a04e844efe32e0f0710" data-position="top" data-delay="50">
        <i class="fab fa-zhihu1">知</i>
    </a>



</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/js/search.js"></script>
<script type="text/javascript">
$(function () {
    searchFunc("https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/" + "search.xml", 'searchInput', 'searchResult');
});
</script>
    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/materialize/materialize.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/aos/aos.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/js/matery.js"></script>

    <canvas class="fireworks" style="position: fixed;left: 0;top: 0;z-index: 1; pointer-events: none;" ></canvas>
    <script type="text/javascript" src="//cdn.bootcss.com/animejs/2.2.0/anime.min.js"></script>
    <script type="text/javascript" src="/js/fireworks.js"></script>

    <script type="text/javascript">
        //只在桌面版网页启用特效
        var windowWidth = $(window).width();
        if (windowWidth > 768) {
            document.write('<script type="text/javascript" src="/js/sakura.js"><\/script>'); }
    </script>

    <!-- weather -->
	<script type="text/javascript">
	WIDGET = {FID: 'TToslpmkVO'}
	</script>
	<script type="text/javascript" src="https://apip.weatherdt.com/float/static/js/r.js?v=1111"></script>


    <!-- Global site tag (gtag.js) - Google Analytics -->


    <!-- Baidu Analytics -->

<script>
    var _hmt = _hmt || [];
    (function () {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>

    <!-- Baidu Push -->

    
    
    <script async src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/others/busuanzi.pure.mini.js"></script>
    

    
        <script src="//code.tidio.co/kqhlkxviiccyoa0czpfpu4ijuey9hfre.js"></script>
        <script> 
            $(document).ready(function () {
                setInterval(change_Tidio, 50);  
                function change_Tidio() { 
                    var tidio=$("#tidio-chat iframe");
                    if(tidio.css("display")=="block"&& $(window).width()>977 ){
                        document.getElementById("tidio-chat-iframe").style.bottom= ($("div#backTop.top-scroll").css("display")=="none" &&$(window).width()>977)>0? "-40px" : ($("div.toc-title").length&&$(window).width()>977)>0?"85px":"20px";   
                        document.getElementById("tidio-chat-iframe").style.right="-15px";   
                        document.getElementById("tidio-chat-iframe").style.height=parseInt(tidio.css("height"))>=520?"520px":tidio.css("height");
                        document.getElementById("tidio-chat-iframe").style.zIndex="997";
                    } 
                    else if(tidio.css("display")=="block"&&$(window).width()>601 &&$(window).width()<992 ){
                        document.getElementById("tidio-chat-iframe").style.bottom= ($("div#backTop.top-scroll").css("display")=="none" && 601< $(window).width()<992)>0? "-40px":"20px" ;   
                        document.getElementById("tidio-chat-iframe").style.right="-15px"; 
                        document.getElementById("tidio-chat-iframe").style.zIndex="997";
                    }
                    else if(tidio.css("display")=="block"&&$(window).width()<601 && parseInt(tidio.css("height"))<230){
                        document.getElementById("tidio-chat-iframe").style.bottom= ($("div#backTop.top-scroll").css("display")=="none" && $(window).width()<601)>0? "-10px":"45px" ;   
                        document.getElementById("tidio-chat-iframe").style.zIndex="997";
                    }
                    if( tidio.css("display")=="block"&&$(window).width()<601 && parseInt(tidio.css("height"))>=230){
                        document.getElementById("tidio-chat-iframe").style.zIndex="998";
                    }
                } 
            }); 
        </script>
    

    

    
    <script type="text/javascript" color="0,0,255"
        pointColor="0,0,255" opacity='0.7'
        zIndex="-1" count="99"
        src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/background/canvas-nest.js"></script>
    

    

    
    <script type="text/javascript" src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/background/ribbon-dynamic.js" async="async"></script>
    
    
    
    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/instantpage/instantpage.js" type="module"></script>
    

        <script src="//cdn.jsdelivr.net/npm/js-base64/base64.min.js"></script>
        <script>
        $('a').each(function() {
          const $this = $(this);
          const href = $this.attr('href');
          if (href && href.match('^((http|https|thunder|qqdl|ed2k|Flashget|qbrowser|ftp|rtsp|mms)://)')) {
            const strs = href.split('/');
            if (strs.length >= 3) {
                const host = strs[2];
                if (host !== 'your_domain' || window.location.host) {
                    $this.attr('href', '/go.html?u='+Base64.encode(href)+'').attr('rel', 'external nofollow noopener noreferrer');
                    if (true) {
                        $this.attr('target', '_blank');
                    }
                }
            }
          }
        });
        </script><script>!function(e){var c=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));function i(){for(var r=0;r<c.length;r++)t=c[r],0<=(n=t.getBoundingClientRect()).bottom&&0<=n.left&&n.top<=(e.innerHeight||document.documentElement.clientHeight)&&function(){var t,n,e,i,o=c[r];t=o,n=function(){c=c.filter(function(t){return o!==t})},e=new Image,i=t.getAttribute("data-original"),e.onload=function(){t.src=i,n&&n()},e.src=i}();var t,n}i(),e.addEventListener("scroll",function(){var t,n;t=i,n=e,clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(n)},500)})}(this);</script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})});</script></body>

</html>

