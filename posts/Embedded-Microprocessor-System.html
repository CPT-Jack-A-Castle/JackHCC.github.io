<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="Embedded Microprocessor System笔记, JackHCC">
    <meta name="description" content="嵌入式微处理系统学习笔记【更新中】">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Embedded Microprocessor System笔记 | JackHCC</title>
    <link rel="icon" type="image/png" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/medias/favicon.png">

    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/css/matery.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/css/my.css">
    
    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/jquery/jquery.min.js"></script>
    
<meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="JackHCC" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism-hopscotch.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper head-container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/images/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/medias/me.jpg" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">JackHCC</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>

<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/images/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/medias/me.jpg" class="logo-img circle responsive-img">
        
        <div class="logo-name">JackHCC</div>
        <div class="logo-desc">
            
            Make the world betterrrr!!!
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/JackHCC/JackHCC.github.io" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>

        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/JackHCC/JackHCC.github.io" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/medias/featureimages/1.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">Embedded Microprocessor System笔记</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        margin: 35px 0 15px 0;
        padding-left: 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        height: calc(100vh - 250px);
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #toc-content .is-active-link::before {
        background-color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 30px;
        bottom: 146px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/Microprocessor/">
                                <span class="chip bg-color">Microprocessor</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/Embedded/" class="post-category">
                                Embedded
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2021-09-26
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2021-11-10
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    8.4k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    38 分
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>

        </div>
        <hr class="clearfix">
        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="微处理器程序开发基础"><a href="#微处理器程序开发基础" class="headerlink" title="微处理器程序开发基础"></a>微处理器程序开发基础</h1><h2 id="程序开发过程与工具"><a href="#程序开发过程与工具" class="headerlink" title="程序开发过程与工具"></a>程序开发过程与工具</h2><p>处理器计算 a=b+c 的过程？</p>
<p>可执行代码是什么形式？如何产生的？</p>
<h3 id="指令"><a href="#指令" class="headerlink" title="指令"></a><strong>指令</strong></h3><p><strong>形式</strong></p>
<p>机器语言：由CPU理解和执行的二进制代码</p>
<p>机器指令的格式（助记符）</p>
<p><img src="/images/loading.gif" data-original="../images/ML/image-20210926184409479.png" alt=""></p>
<h3 id="执行代码生成"><a href="#执行代码生成" class="headerlink" title="执行代码生成"></a><strong>执行代码生成</strong></h3><p><img src="/images/loading.gif" data-original="../images/development/image-20210926184506519.png" alt=""></p>
<h3 id="开发过程"><a href="#开发过程" class="headerlink" title="开发过程"></a><strong>开发过程</strong></h3><p><strong>PC程序开发</strong></p>
<p>编辑    编译    汇编    连接    调试</p>
<p><strong>嵌入式程序开发</strong></p>
<p>编辑    编译    汇编    连接    下载    调试</p>
<p><strong>如何下载程序？</strong></p>
<h3 id="开发工具"><a href="#开发工具" class="headerlink" title="开发工具"></a><strong>开发工具</strong></h3><p><strong>集成开发环境</strong></p>
<ul>
<li><p>Keil MDK（<a href="http://www.arm.com/" target="_blank" rel="noopener">www.arm.com</a>）</p>
<p><img src="/images/loading.gif" data-original="../images/development/image-20210926184939724.png" alt=""></p>
</li>
<li><p>Arm Development Studio（DS-5）（<a href="http://www.arm.com/" target="_blank" rel="noopener">www.arm.com</a>）</p>
</li>
<li><p>Segger for Arm （<a href="http://www.segger.com/" target="_blank" rel="noopener">www.segger.com</a>）</p>
<p><img src="/images/loading.gif" data-original="../images/development/image-20210926184955365.png" alt=""></p>
</li>
</ul>
<p><strong>调试环境</strong></p>
<ul>
<li>物理处理器和开发板(Emulator)</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/development/image-20210926185044913.png" alt=""></p>
<p><strong>没有开发板可以调试程序吗？</strong></p>
<ul>
<li>模拟处理器(Simulator)</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/development/image-20210926185121855.png" alt=""></p>
<p><strong>目标处理器如何加载程序？</strong></p>
<ul>
<li><p><strong>目标地址</strong></p>
<ul>
<li>Linker-分配</li>
<li>Debugger-指定</li>
</ul>
</li>
<li><p><strong>加载方式</strong></p>
<ul>
<li>Debugger-下载</li>
<li>实际系统-ROM</li>
</ul>
</li>
<li><p><strong>启动方式</strong></p>
<ul>
<li>初始化<ul>
<li>Debugger-程序/Set</li>
<li>实际系统-程序</li>
</ul>
</li>
<li>程序入口<ul>
<li>Debugger-跳转/Set PC</li>
<li>实际系统 –跳转</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>还熟悉哪些处理器程序开发环境？</p>
<h2 id="处理器与程序"><a href="#处理器与程序" class="headerlink" title="处理器与程序"></a><strong>处理器与程序</strong></h2><h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a><strong>问题</strong></h3><p><strong>处理器如何执行程序？</strong></p>
<h3 id="计算机系统"><a href="#计算机系统" class="headerlink" title="计算机系统"></a><strong>计算机系统</strong></h3><p><img src="/images/loading.gif" data-original="../images/development/image-20210926185459145.png" alt=""></p>
<h3 id="CPU内核"><a href="#CPU内核" class="headerlink" title="CPU内核"></a>CPU内核</h3><p><img src="/images/loading.gif" data-original="../images/development/image-20210926185523421.png" alt=""></p>
<h3 id="CPU性能"><a href="#CPU性能" class="headerlink" title="CPU性能"></a>CPU性能</h3><ul>
<li>CPI-执行一条指令所需的平均时钟周期</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/development/image-20210926185613261.png" alt=""></p>
<ul>
<li>MIPS-每秒百万条指令</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/development/image-20210926185650498.png" alt=""></p>
<ul>
<li>MFLOPS-每秒百万次浮点运算次数</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/development/image-20210926185719089.png" alt=""></p>
<h3 id="执行时间"><a href="#执行时间" class="headerlink" title="执行时间"></a><strong>执行时间</strong></h3><p><strong>指令执行过程</strong></p>
<p><img src="/images/loading.gif" data-original="../images/development/image-20210926185812967.png" alt=""></p>
<p>取指（IF）-&gt;译码 （ID） -&gt;执行（IE） -&gt;写回（WB）</p>
<p><strong>指令执行时间</strong></p>
<img src="/images/loading.gif" data-original="../images/development/image-20210926185912076.png" style="zoom:50%;">

<p><strong>程序执行时间</strong></p>
<img src="/images/loading.gif" data-original="../images/development/image-20210926185926141.png" style="zoom:33%;">

<p><strong>影响处理器程序运行速度的因素有哪些？</strong></p>
<h3 id="结构与性能"><a href="#结构与性能" class="headerlink" title="结构与性能"></a><strong>结构与性能</strong></h3><p><strong>总线结构</strong></p>
<p><img src="/images/loading.gif" data-original="../images/development/image-20210926190257568.png" alt=""></p>
<p><strong>哪种结构的处理器速度更快？ 为什么？</strong></p>
<p><strong>处理器字长（ALU 及通用数据寄存器）</strong></p>
<ul>
<li><p><strong>8</strong> <strong>bits</strong>：<strong>8008, 89C51</strong></p>
</li>
<li><p><strong>16 bits</strong>：<strong>8086, Ti 54X</strong></p>
</li>
<li><p><strong>32 bits</strong>：<strong>80486, Ti C3X, C6X</strong>，<strong>ARM V3-6</strong></p>
</li>
<li><p><strong>64 bits</strong>：<strong>Itanium，PowerPC</strong> <strong>970, ARM V8</strong></p>
</li>
<li><p><strong>128 bits?</strong></p>
</li>
</ul>
<p>8位处理器可以通过程序进行32位数值运算吗？</p>
<p>如何用C语言编程实现？</p>
<p><strong>流水线</strong></p>
<p><img src="/images/loading.gif" data-original="../images/development/image-20210926190543037.png" alt=""></p>
<ul>
<li>执行时间（n条指令）</li>
</ul>
<img src="/images/loading.gif" data-original="../images/development/image-20210926190608163.png" style="zoom:50%;">

<p><strong>影响流水线加速效果的因素？</strong></p>
<p><strong>能否通过程序验证处理器是否采用了流水线？</strong></p>
<p><strong>Cache</strong></p>
<p><img src="/images/loading.gif" data-original="../images/development/image-20210926190658439.png" alt=""></p>
<p>程序可以直接访问Cache中指定的数据单元？</p>
<p><img src="/images/loading.gif" data-original="../images/development/image-20210926190736193.png" alt=""></p>
<p>Cache 的容量对大小对加速性能的影响？</p>
<p>能否通过程序验证处理器中Cache是否工作？</p>
<p><strong>Write buffer</strong></p>
<p><img src="/images/loading.gif" data-original="../images/development/image-20210926190828810.png" alt=""></p>
<p>Write buffer 与 Cache的区别？</p>
<p><strong>指令执行过程中如何访问的数据？</strong></p>
<h3 id="寻址"><a href="#寻址" class="headerlink" title="寻址"></a><strong>寻址</strong></h3><p><strong>定义</strong>：<strong>执行单元获取数据（地址）的方式</strong></p>
<p><strong>编址单元宽度</strong></p>
<ul>
<li><p>字节（8bit，0x86，ARM<strong>）</strong></p>
</li>
<li><p>半字 （C54）</p>
</li>
<li><p>字 （C30）</p>
</li>
<li><p>双字</p>
</li>
</ul>
<p><strong>地址空间（独立编址）</strong></p>
<ul>
<li><p><strong>三个地址空间</strong></p>
<ul>
<li>通用寄存器</li>
<li>主存储器</li>
<li>I/O设备</li>
</ul>
</li>
<li><p><strong>两个地址空间</strong></p>
<ul>
<li>通用寄存器</li>
<li>主存储器与IO设备</li>
</ul>
</li>
<li><p><strong>一个地址空间</strong></p>
<ul>
<li>所有存储设备统一编址</li>
</ul>
</li>
</ul>
<p><strong>如果有多个地址空间，在程序中如何区分？</strong></p>
<p><strong>方式</strong></p>
<ul>
<li><strong>立即数寻址</strong></li>
</ul>
<p>ADD R4，#5 ；  reg（R4）〈- reg（R4）+5</p>
<ul>
<li><strong>寄存器寻址</strong></li>
</ul>
<p>ADD R4，R3 ； reg（R4）〈- reg（R4）+reg（R3）</p>
<ul>
<li><p><strong>直接寻址（绝对）</strong> </p>
<p>ADD R1，（1001）； reg（R1）〈- reg（R1）+ Mem（1001）</p>
</li>
</ul>
<p>注：1001是内存的地址，取出该地址对应的值</p>
<ul>
<li><strong>堆栈寻址</strong> </li>
</ul>
<p>PUSH R1</p>
<p>POP R1</p>
<p>注：堆栈操作的对象与内存有关</p>
<p><strong>隐含了什么地址？</strong></p>
<ul>
<li><p><strong>间接寻址</strong></p>
<ul>
<li><p>寄存器间接寻址  ADD R4，（R1）；reg（R4）〈- reg（R4）+ Mem（reg（R1））；</p>
<p>注：R1寄存器的数值对应为内存中的地址，取内存中该地址的数据（R1）</p>
</li>
<li><p>存储器间接寻址 ADD R1，@(R2)； reg（R1）〈- reg（R1）+ Mem[Mem[reg（R2）]]</p>
<p>注：R2寄存器数值对应为内存中的地址，改地址对应的数值所对应的地址，取内存中该地址的数据@（R2）</p>
</li>
</ul>
</li>
<li><p><strong>自动递增寻址</strong></p>
</li>
</ul>
<p>ADD R1，（R2）++ ；Reg(R1) 〈- reg（R4）+ Mem（reg(R2) ）; R2+1</p>
<ul>
<li><strong>自动递减寻址</strong></li>
</ul>
<p>ADD R1，- -（R2）；   R2-1 ; Reg(R1) 〈- reg（R1）+ Mem（reg(R2) ）</p>
<p>注：自动递增递减会改变所操作寄存器的值</p>
<ul>
<li><strong>偏移量寻址</strong></li>
</ul>
<p>ADD R4，±100（R1） ； reg（R4）〈- reg（R4）+  Mem（reg(R1) ± 100）</p>
<p>注：偏移量寻址不会改变所操作寄存器的值</p>
<p><strong>处理器如何处理异常（外部）事件？</strong></p>
<h3 id="事件响应"><a href="#事件响应" class="headerlink" title="事件响应"></a><strong>事件响应</strong></h3><p><strong>事件响应过程</strong></p>
<p><img src="/images/loading.gif" data-original="../images/development/image-20210926195652510.png" alt=""></p>
<p><strong>检测事件？进入事件处理程序？</strong></p>
<p><strong>中断（interrupt）</strong></p>
<p><strong>定义</strong>：<strong>为导致程序正常执行流程发生改变的事件（不包括程序的分支情况）</strong></p>
<p><strong>来源</strong></p>
<ul>
<li><p><strong>外中断</strong>：由于CPU 外部的原因而改变程序执行流程的过程，属于异步事件，又称为硬件中断</p>
</li>
<li><p><strong>内中断</strong>：</p>
<ul>
<li>自陷（软中断，trap）：通过处理器所拥有的软件指令、可预期地使处理器正在执行的程序的执行流程发生变化，以执行特定的程序</li>
<li>异常：异常为CPU 自动产生的自陷（除0，非法指令，内存保护错误）</li>
</ul>
</li>
</ul>
<p><strong>可屏蔽性</strong></p>
<ul>
<li><p><strong>可屏蔽中断</strong></p>
<ul>
<li>能够被屏蔽掉的中断称为可屏蔽中断。</li>
<li>一般需要先通过CPU外部的中断控制器，再与CPU相应的引脚相连。</li>
</ul>
</li>
<li><p><strong>不可屏蔽中断</strong></p>
<ul>
<li>不能够被屏蔽掉的中断称为可屏蔽中断</li>
<li>例：复位（Reset）</li>
</ul>
</li>
</ul>
<p><strong>中断向量表</strong></p>
<ul>
<li><strong>中断向量与中断服务程序入口的对照表</strong></li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/development/image-20210926200456886.png" alt=""></p>
<p><strong>支持多任务（多程序）的操作系统，如何为不同的任务分配存储空间？</strong></p>
<p><strong>虚拟地址 VS 物理地址？</strong></p>
<h3 id="内存映射"><a href="#内存映射" class="headerlink" title="内存映射"></a><strong>内存映射</strong></h3><p><img src="/images/loading.gif" data-original="../images/development/image-20210926200633258.png" alt=""></p>
<ul>
<li><strong>地址转换</strong></li>
<li><strong>空间保护</strong></li>
</ul>
<p><strong>程序中如何实现地址转换？</strong></p>
<p><strong>上电后处理器是如何启动boot 程序？</strong></p>
<h3 id="系统启动"><a href="#系统启动" class="headerlink" title="系统启动"></a><strong>系统启动</strong></h3><p><strong>处理器启动</strong></p>
<p><img src="/images/loading.gif" data-original="../images/development/image-20210926200802425.png" alt=""></p>
<p><strong>条件？</strong></p>
<ul>
<li><p>Memory（ROM） 可执行程序（指令）</p>
</li>
<li><p>PC指到程序入口</p>
</li>
</ul>
<h2 id="处理器系统"><a href="#处理器系统" class="headerlink" title="处理器系统"></a><strong>处理器系统</strong></h2><p>你知道哪些CPU？具体型号？</p>
<h3 id="CPU要满足系统需求"><a href="#CPU要满足系统需求" class="headerlink" title="CPU要满足系统需求"></a>CPU要满足系统需求</h3><p><img src="/images/loading.gif" data-original="../images/development/image-20210926201116512.png" alt=""></p>
<h3 id="系统需求"><a href="#系统需求" class="headerlink" title="系统需求"></a><strong>系统需求</strong></h3><p><strong>资源</strong></p>
<ul>
<li><p>片内 (MCU, DSP, SoC)</p>
<ul>
<li>RAM，ROM，Programmable ROM<ul>
<li>DATA</li>
<li>INSTRUCTION</li>
</ul>
</li>
</ul>
</li>
<li><p>片外可扩展 (DSP, MPU)</p>
<ul>
<li>MEMORY<ul>
<li>DATA</li>
<li>INSTRUCTION</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>接口</strong></p>
<ul>
<li>IO 控制（GPIO）</li>
<li>通信（UART， Ether NET ，USB）</li>
<li>外设 （A/D，D/A，LCD，KEYBOARD，Video）</li>
</ul>
<p><strong>封装（尺寸, 工艺）</strong></p>
<p><img src="/images/loading.gif" data-original="../images/development/image-20210926202001957.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/development/image-20210926202050871.png" alt=""></p>
<h3 id="嵌入式系统需求"><a href="#嵌入式系统需求" class="headerlink" title="嵌入式系统需求"></a><strong>嵌入式系统需求</strong></h3><ul>
<li><p>功率低</p>
<p>设想一下，普通手机电池能够维持P4（75W）工作多长时间？</p>
<p>移动领域 X86 败于 ARM </p>
</li>
<li><p>稳定性好</p>
<p>卫星上的系统出错后如何复位？</p>
</li>
<li><p>体积小</p>
<p> PC中的处理器有多大？</p>
</li>
<li><p>成本低</p>
<p>最便宜的处理器价格？</p>
</li>
</ul>
<h3 id="嵌入式处理器"><a href="#嵌入式处理器" class="headerlink" title="嵌入式处理器"></a><strong>嵌入式处理器</strong></h3><p>嵌入式处理器？-满足嵌入式系统需求</p>
<p><img src="/images/loading.gif" data-original="../images/development/image-20210926202343113.png" alt=""></p>
<p>AI芯片属于哪一类？</p>
<p><strong>嵌入式系统微处理器的发展</strong></p>
<p><img src="/images/loading.gif" data-original="../images/development/image-20210926202425634.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/development/image-20210926202532721.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/development/image-20210926202545339.png" alt=""></p>
<p><strong>What is next to ARM?</strong></p>
<h2 id="处理器发展"><a href="#处理器发展" class="headerlink" title="处理器发展"></a><strong>处理器发展</strong></h2><p><strong>微处理器结构上的第一</strong></p>
<p>First Computer ENIAC (University of Pennsylvania,46)</p>
<p>First general-purpose,single-chip microprocessor:Intel 4004,1971</p>
<p>First 8-bit architecture:Intel 8008,1972</p>
<p>First 16-bit architecture:Intel 8080,1974</p>
<p>First 32-bit architecture:Motorola 68000,1979</p>
<p>First RISC microprocessor: MIPS R2000, 1985</p>
<p>First microprocessor to provide integrated support for instruction &amp; data cache: MIPS R2000, 1985</p>
<p>First pipelined microprocessor (sustains 1 instruction/clock): MIPS R2000, 1985</p>
<p>First 64-bit architecture: MIPS R4000, 1991</p>
<p>First multiple issue（superscalar) microprocessor: Intel i860, 1991</p>
<p>First CMP processor: IBM Power 4,2001</p>
<p>First SMT processor: Intel Pentium IV Xeon,2003</p>
<p><strong>提高运行速度</strong></p>
<ul>
<li><p>提高主频</p>
</li>
<li><p>提高存储器速度</p>
</li>
<li><p>改进处理器结构-并行化/存储管理</p>
<ul>
<li>数据</li>
<li>步骤-&gt;pipe line</li>
<li>指令-&gt;Superscale</li>
<li>内核-&gt;Multicore</li>
<li>访存-&gt;Cache &amp;Write buffer</li>
</ul>
</li>
<li><p>降低能耗</p>
</li>
</ul>
<h3 id="并行化"><a href="#并行化" class="headerlink" title="并行化"></a><strong>并行化</strong></h3><p><strong>超流水线和超标量</strong></p>
<p><img src="/images/loading.gif" data-original="../images/development/image-20210926202824719.png" alt=""></p>
<p><strong>矢量计算？</strong></p>
<p><strong>多核</strong></p>
<p><img src="/images/loading.gif" data-original="../images/development/image-20210926202854014.png" alt=""></p>
<p><strong>比较两款处理器功耗</strong></p>
<p><img src="/images/loading.gif" data-original="../images/development/image-20210926202912842.png" alt=""></p>
<p>Intel处理器败走移动领域的主要因素？</p>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a><strong>小结</strong></h2><ul>
<li><p><strong>处理器程序开发过程。</strong></p>
</li>
<li><p><strong>处理器结构提对程序执行速度影响。</strong></p>
</li>
<li><p><strong>嵌入式处理器特点。</strong></p>
</li>
</ul>
<h1 id="ARM-处理器"><a href="#ARM-处理器" class="headerlink" title="ARM 处理器"></a>ARM 处理器</h1><h2 id="例程：c-a-b"><a href="#例程：c-a-b" class="headerlink" title="例程：c=a+b"></a>例程：c=a+b</h2><p><img src="/images/loading.gif" data-original="../images/development/image-20210926203252890.png" alt=""></p>
<p><strong>观察寄存器</strong></p>
<p><img src="/images/loading.gif" data-original="../images/development/image-20210926203323853.png" alt=""></p>
<p>va, vb, vc 地址？</p>
<p><strong>小端/大端？</strong></p>
<p>查看内存数值？</p>
<p><img src="/images/loading.gif" data-original="../images/development/image-20210926203452326.png" alt=""></p>
<p><strong>C=？</strong></p>
<p><img src="/images/loading.gif" data-original="../images/development/image-20210926203533295.png" alt=""></p>
<p>R15？</p>
<h3 id="Option"><a href="#Option" class="headerlink" title="Option"></a><strong>Option</strong></h3><h4 id="Device"><a href="#Device" class="headerlink" title="Device"></a><strong>Device</strong></h4><p><img src="/images/loading.gif" data-original="../images/development/image-20210926203617534.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/development/image-20210926203927530.png" alt=""></p>
<h4 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h4><p><img src="/images/loading.gif" data-original="../images/development/image-20210926204025296.png" alt=""></p>
<h4 id="Output"><a href="#Output" class="headerlink" title="Output"></a><strong>Output</strong></h4><p><img src="/images/loading.gif" data-original="../images/development/image-20210926204056926.png" alt=""></p>
<h4 id="Listing"><a href="#Listing" class="headerlink" title="Listing"></a><strong>Listing</strong></h4><p><img src="/images/loading.gif" data-original="../images/development/image-20210926204145002.png" alt=""></p>
<h4 id="User"><a href="#User" class="headerlink" title="User"></a><strong>User</strong></h4><p><img src="/images/loading.gif" data-original="../images/development/image-20210926204229124.png" alt=""></p>
<h4 id="C-C"><a href="#C-C" class="headerlink" title="C/C++"></a>C/C++</h4><p><img src="/images/loading.gif" data-original="../images/development/image-20210926204307711.png" alt=""></p>
<h4 id="Asm"><a href="#Asm" class="headerlink" title="Asm"></a><strong>Asm</strong></h4><p><img src="/images/loading.gif" data-original="../images/development/image-20210926204445454.png" alt=""></p>
<h4 id="Linker"><a href="#Linker" class="headerlink" title="Linker"></a><strong>Linker</strong></h4><p><img src="/images/loading.gif" data-original="../images/development/image-20210926204509770.png" alt=""></p>
<h4 id="Debug"><a href="#Debug" class="headerlink" title="Debug"></a><strong>Debug</strong></h4><p><img src="/images/loading.gif" data-original="../images/development/image-20210926204735885.png" alt=""></p>
<h4 id="Utilities"><a href="#Utilities" class="headerlink" title="Utilities"></a><strong>Utilities</strong></h4><p><img src="/images/loading.gif" data-original="../images/development/image-20210926204807368.png" alt=""></p>
<h3 id="aplusb-ini"><a href="#aplusb-ini" class="headerlink" title="aplusb.ini"></a><strong>aplusb.ini</strong></h3><p><strong>去掉该文件重新调试，什么现象？</strong></p>
<p><img src="/images/loading.gif" data-original="../images/development/image-20210926205434772.png" alt=""></p>
<h3 id="aplusb-lst-armasm"><a href="#aplusb-lst-armasm" class="headerlink" title="aplusb.lst (armasm)"></a>aplusb.lst (armasm)</h3><p><img src="/images/loading.gif" data-original="../images/development/image-20210926205451710.png" alt=""></p>
<h3 id="aplusb-map"><a href="#aplusb-map" class="headerlink" title="aplusb.map"></a>aplusb.map</h3><p><strong>Memory Map</strong></p>
<p><img src="/images/loading.gif" data-original="../images/development/image-20210926205553729.png" alt=""></p>
<p><strong>Size</strong></p>
<p><img src="/images/loading.gif" data-original="../images/development/image-20210926205758227.png" alt=""></p>
<h2 id="ARM9内核"><a href="#ARM9内核" class="headerlink" title="ARM9内核"></a>ARM9内核</h2><h3 id="内核结构"><a href="#内核结构" class="headerlink" title="内核结构"></a><strong>内核结构</strong></h3><p><img src="/images/loading.gif" data-original="../images/development/image-20210926205834349.png" alt=""></p>
<p><strong>桶形移位器</strong></p>
<p><img src="/images/loading.gif" data-original="../images/development/image-20210926205904206.png" alt=""></p>
<p><strong>调试程序，观察加运算前后处理器状态</strong></p>
<p><img src="/images/loading.gif" data-original="../images/development/image-20210926205937537.png" alt=""></p>
<p><strong>CPSR</strong></p>
<p><img src="/images/loading.gif" data-original="../images/development/image-20210926205949259.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/development/image-20210926210003316.png" alt=""></p>
<p><strong>ALU</strong></p>
<p><img src="/images/loading.gif" data-original="../images/development/image-20210926210038934.png" alt=""></p>
<p><strong>特点</strong></p>
<p><img src="/images/loading.gif" data-original="../images/development/image-20210926210053378.png" alt=""></p>
<h2 id="异常与模式"><a href="#异常与模式" class="headerlink" title="异常与模式"></a>异常与模式</h2><h3 id="异常与模式-1"><a href="#异常与模式-1" class="headerlink" title="异常与模式"></a>异常与模式</h3><p><strong>调试程序，在nop处单步执行，观察pc的变化</strong></p>
<p><img src="/images/loading.gif" data-original="../images/development/image-20210926210148714.png" alt=""></p>
<p><strong>异常向量</strong></p>
<p><img src="/images/loading.gif" data-original="../images/development/image-20210926210159430.png" alt=""></p>
<p><strong>异常模式</strong></p>
<p><img src="/images/loading.gif" data-original="../images/development/image-20210926210242247.png" alt=""></p>
<p><strong>寄存器</strong></p>
<p><img src="/images/loading.gif" data-original="../images/development/image-20210926210302495.png" alt=""></p>
<p><strong>处理器异常处理</strong></p>
<ul>
<li>处理过程</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/development/image-20210926210321382.png" alt=""></p>
<p><strong>处理器处理过程不需要用程序实现吗！</strong></p>
<p><strong>如何恢复到异常发生前的状态？</strong></p>
<ul>
<li>复位(reset)</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/development/image-20210926210413298.png" alt=""></p>
<ul>
<li>中断(irq) (fiq?)</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/development/image-20210926210436785.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/development/image-20210926210442517.png" alt=""></p>
<ul>
<li>数据终止(abort)</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/development/image-20210926210508796.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/development/image-20210926210516163.png" alt=""></p>
<ul>
<li>指令终止(undefined)</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/development/image-20210926210533321.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/development/image-20210926210538959.png" alt=""></p>
<h2 id="存储系统"><a href="#存储系统" class="headerlink" title="存储系统"></a>存储系统</h2><h3 id="结构"><a href="#结构" class="headerlink" title="结构"></a><strong>结构</strong></h3><p>按字节编址！</p>
<p><img src="/images/loading.gif" data-original="../images/development/image-20210926210617538.png" alt=""></p>
<p>TCM与Cache 的区别？</p>
<p><img src="/images/loading.gif" data-original="../images/ML/image-20211014221932255.png" alt=""></p>
<h3 id="Cache"><a href="#Cache" class="headerlink" title="Cache"></a>Cache</h3><p><img src="/images/loading.gif" data-original="../images/development/image-20211014222042315.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/development/image-20211014222052356.png" alt=""></p>
<h3 id="存储管理"><a href="#存储管理" class="headerlink" title="存储管理"></a>存储管理</h3><p><strong>ARM9的三类地址</strong>：</p>
<ul>
<li><p>虚拟地址（VA），是程序中的逻辑地址，0x00000000~0xFFFFFFFF。</p>
</li>
<li><p>改进的虚拟地址（MVA），由于多个进程执行，逻辑地址会重合。所以，跟据进程号将逻辑地址分布到整个内存中。MVA = (PID &lt;&lt; 25) | VA。PID占7位，所以最多只能有 128 个进程，每个进程只能分到 32MB 的逻辑地址空间。</p>
</li>
<li><p>物理地址（PA），MVA通过MMU转换后的地址。</p>
</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/development/image-20211014222149466.png" alt=""></p>
<p><strong>协处理器CP15</strong> </p>
<ul>
<li><p>内存管理单元(Memory Manage Unit，MMU)</p>
<ul>
<li>控制虚拟地址（VA）映射到物理地址（PA）</li>
<li>控制内存的访问权限</li>
<li>控制可缓存性和缓冲性</li>
</ul>
</li>
<li><p>内存保护单元(Protection Unit，PU)</p>
<ul>
<li>无MMU的简单内存保护</li>
</ul>
</li>
<li><p>使能Cache and Write Buffer</p>
</li>
<li><p>快速上下文(进程之间)切换扩展(Fast Context Switch Extension，FCSE)</p>
</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/development/image-20211014222312479.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/development/image-20211014222335760.png" alt=""></p>
<p><strong>段（section, 1MB）地址转换</strong></p>
<p><img src="/images/loading.gif" data-original="../images/development/image-20211014222420960.png" alt=""></p>
<p><strong>内核扩展协处理器</strong></p>
<ul>
<li><p>协处理器接口，允许扩展16个协处理器</p>
</li>
<li><p>协处理器扩展（FFA10）</p>
</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/development/image-20211014222456230.png" alt=""></p>
<p>处理器如何访问协处理器？</p>
<h2 id="ARM发展历程"><a href="#ARM发展历程" class="headerlink" title="ARM发展历程"></a>ARM发展历程</h2><h3 id="ARM-Advanced-RISC-Machine"><a href="#ARM-Advanced-RISC-Machine" class="headerlink" title="ARM- Advanced RISC Machine"></a>ARM- Advanced RISC Machine</h3><ul>
<li><p>ARM的版本</p>
<ul>
<li>V1, V2, V3,</li>
<li>V4 (ARM 7，8，9),</li>
<li>V5 (ARM 10),</li>
<li>V6 (ARM 11)</li>
<li>V7(ARM-Cortex A8,9,15,17)</li>
<li>V8(Cortex-A/R/M/, 64/32bit)</li>
<li>V9</li>
</ul>
</li>
<li><p>扩展字母含义</p>
<ul>
<li>T:内含16位压缩指令集 Thumb</li>
<li>D:支持片内Debug调试</li>
<li>M:采用增强型乘法器（Multiplier)</li>
<li>I: 内含嵌入式ICE宏单元</li>
<li>E: 具有DSP功能</li>
<li>S:可综合的软核Software</li>
<li>J: Jazeller,允许直接执行Java字节码</li>
</ul>
</li>
</ul>
<h3 id="产品线"><a href="#产品线" class="headerlink" title="产品线"></a>产品线</h3><p><img src="/images/loading.gif" data-original="../images/development/image-20211014222644267.png" alt=""></p>
<h3 id="架构"><a href="#架构" class="headerlink" title="架构"></a><strong>架构</strong></h3><p><img src="/images/loading.gif" data-original="../images/development/image-20211014222702025.png" alt=""></p>
<ul>
<li>指令</li>
</ul>
<table>
<thead>
<tr>
<th><strong>处理器</strong></th>
<th><strong>流水线</strong></th>
<th><strong>指令集</strong></th>
<th><strong>存储管理</strong></th>
<th><strong>协处理器</strong></th>
<th><strong>多核</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>ARM7</strong></td>
<td><strong>3</strong></td>
<td><strong>ARM/T</strong></td>
<td><strong>N</strong></td>
<td><strong>N</strong></td>
<td><strong>N</strong></td>
</tr>
<tr>
<td><strong>ARM9</strong></td>
<td><strong>5</strong></td>
<td><strong>ARM/T</strong></td>
<td><strong>Y</strong></td>
<td><strong>Y</strong></td>
<td><strong>N</strong></td>
</tr>
<tr>
<td><strong>ARM10</strong></td>
<td><strong>6</strong></td>
<td><strong>ARM/T</strong></td>
<td><strong>Y</strong></td>
<td><strong>Y</strong></td>
<td><strong>N</strong></td>
</tr>
<tr>
<td><strong>ARM11</strong></td>
<td><strong>8</strong></td>
<td><strong>Thumb-2</strong></td>
<td><strong>Y</strong></td>
<td><strong>Y</strong></td>
<td><strong>N</strong></td>
</tr>
<tr>
<td><strong>Cortex-A8</strong></td>
<td><strong>NEON</strong></td>
<td><strong>V7-A</strong></td>
<td><strong>Y</strong></td>
<td><strong>Y</strong></td>
<td><strong>N</strong></td>
</tr>
<tr>
<td><strong>Cortex-A9,1X</strong></td>
<td><strong>NEON</strong></td>
<td><strong>V7-A</strong></td>
<td><strong>Y</strong></td>
<td><strong>Y</strong></td>
<td><strong>Y</strong></td>
</tr>
<tr>
<td><strong>Cortex-A5X</strong></td>
<td><strong>NEON</strong></td>
<td><strong>V8-A</strong></td>
<td><strong>Y</strong></td>
<td><strong>Y</strong></td>
<td><strong>Y</strong></td>
</tr>
</tbody></table>
<ul>
<li>总线</li>
</ul>
<table>
<thead>
<tr>
<th><strong>版本</strong></th>
<th><strong>处理器</strong></th>
<th><strong>发布时间</strong></th>
<th><strong>总线(bit)</strong></th>
<th><strong>总线结构</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>V1</strong>，<strong>V2</strong></td>
<td><strong>ARM1</strong></td>
<td><strong>未商业授权</strong></td>
<td></td>
<td></td>
</tr>
<tr>
<td><strong>V3</strong></td>
<td><strong>……</strong></td>
<td><strong>未商业授权</strong></td>
<td><strong>32</strong></td>
<td></td>
</tr>
<tr>
<td><strong>V4</strong></td>
<td><strong>ARM7/9</strong></td>
<td><strong>1996</strong></td>
<td><strong>32</strong></td>
<td><strong>7-Von  Neumann</strong>  <strong>9-Harvard</strong></td>
</tr>
<tr>
<td><strong>V5</strong></td>
<td><strong>ARM10</strong></td>
<td><strong>2000</strong></td>
<td><strong>32</strong></td>
<td><strong>Harvard</strong></td>
</tr>
<tr>
<td><strong>V6</strong></td>
<td><strong>ARM11</strong></td>
<td><strong>2002</strong></td>
<td><strong>32</strong></td>
<td><strong>Harvard</strong></td>
</tr>
<tr>
<td><strong>V7</strong></td>
<td><strong>Ax,  1X</strong></td>
<td><strong>2004</strong></td>
<td><strong>32</strong></td>
<td><strong>Harvard</strong></td>
</tr>
<tr>
<td><strong>V8</strong></td>
<td><strong>A53/57</strong></td>
<td><strong>2013</strong></td>
<td><strong>64</strong></td>
<td><strong>Harvard</strong></td>
</tr>
</tbody></table>
<h3 id="Cortex-A75-Core（Snapdragon-845）"><a href="#Cortex-A75-Core（Snapdragon-845）" class="headerlink" title="Cortex-A75-Core（Snapdragon 845）"></a>Cortex-A75-Core（Snapdragon 845）</h3><p><img src="/images/loading.gif" data-original="../images/development/image-20211014222824903.png" alt=""></p>
<h2 id="S3C2410A"><a href="#S3C2410A" class="headerlink" title="S3C2410A"></a>S3C2410A</h2><p>硬件工程师在设计包含处理器的电路板时需要掌握处理器的哪些信息？</p>
<p>数据手册（datasheet）</p>
<h3 id="datasheet"><a href="#datasheet" class="headerlink" title="datasheet"></a><strong>datasheet</strong></h3><p><img src="/images/loading.gif" data-original="../images/development/image-20211014222911825.png" alt=""></p>
<p>软件工程师在为处理器开发程序时需要掌握处理器的哪些信息？</p>
<p>使用手册（manual）</p>
<p><img src="/images/loading.gif" data-original="../images/development/image-20211014222945183.png" alt=""></p>
<h3 id="S3C2410"><a href="#S3C2410" class="headerlink" title="S3C2410"></a><strong>S3C2410</strong></h3><p><img src="/images/loading.gif" data-original="../images/development/image-20211014223007273.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/development/image-20211014223016282.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/development/image-20211014223032659.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/development/image-20211014223045895.png" alt=""></p>
<p>Peripheral Registers</p>
<p><img src="/images/loading.gif" data-original="../images/development/image-20211014223102590.png" alt=""></p>
<h1 id="ARM汇编程序"><a href="#ARM汇编程序" class="headerlink" title="ARM汇编程序"></a>ARM汇编程序</h1><ol>
<li>Keil作为半主机模式如何导入导出数据？</li>
</ol>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211019205214860.png" alt=""></p>
<ol start="2">
<li><p>如何测试处理器性能？</p>
</li>
<li><p>Keil工程中startup.s/S3c2410.s的作用？</p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211019205422881.png" alt=""></p>
</li>
</ol>
<ul>
<li><p>Heap_size：动态分配空间</p>
</li>
<li><p>Heap_mem：需指定位置与大小</p>
</li>
<li><p>全局空间是link时自动分配的空间</p>
</li>
</ul>
<h2 id="汇编程序格式"><a href="#汇编程序格式" class="headerlink" title="汇编程序格式"></a>汇编程序格式</h2><h3 id="ARM汇编"><a href="#ARM汇编" class="headerlink" title="ARM汇编"></a><strong>ARM汇编</strong></h3><p><strong>Keiln(ARM ASM)</strong></p>
<pre><code>AREA    ARMex, CODE, READONLY                                    
        ENTRY
start
        MOV      r0, #10 
        MOV      r1, #3
        ADD      r0, r0, r1      

        END 
</code></pre><p><strong>Segger (gnu asm )</strong></p>
<pre><code>.weak _start
            .global __start
            .section .init, “ax”
            .type _start, function
            .code 32
            .balign 4
_start:
__start:
        //
        // Setup Stacks
        //for asm testing
        mov r0, #0x1000     
        mov r1, #0x300
        mov r2, #0x400
        add r1,r1,r2
        strb r1,[r0]
       //testing end
    ……
</code></pre><ul>
<li><p>ax （allocation execute）</p>
</li>
<li><p>.weak _start  有外部调用则调用外部，没有调用内部</p>
</li>
<li><p>.code 32 表示32位</p>
</li>
<li><p>.balign 4  对齐</p>
<ul>
<li>有b，表示四个字节对齐；</li>
<li>没有b，表示2的多少次方对齐。</li>
</ul>
</li>
<li><p>_start:缺省入口</p>
</li>
<li><p>__start:系统启动定义的</p>
</li>
</ul>
<h3 id="指令级程序"><a href="#指令级程序" class="headerlink" title="指令级程序"></a><strong>指令级程序</strong></h3><h4 id="格式"><a href="#格式" class="headerlink" title="格式"></a><strong>格式</strong></h4><p><strong>ASM Directive</strong></p>
<ul>
<li><p>AREA</p>
<ul>
<li>Mark the start of a section</li>
<li>Names the section and sets its attributes. </li>
<li>The attributes are placed after the name, separated by commas</li>
</ul>
</li>
<li><p>ENTRY</p>
</li>
<li><p>Marks the first instruction to be executed</p>
</li>
<li><p>Initialization code and exception handlers also contain entry points.</p>
</li>
<li><p>END</p>
<ul>
<li>Instructs the assembler to stop processing this source file </li>
<li>On a line by itself.</li>
</ul>
</li>
</ul>
<p><strong>指令格式</strong></p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211019210000605.png" alt=""></p>
<p><strong>助记符</strong></p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211019210028217.png" alt=""></p>
<ul>
<li><p>GE：Cond，条件判断</p>
</li>
<li><p>S：状态位</p>
</li>
</ul>
<p><strong>语句格式</strong></p>
<ul>
<li>Lines in an ARM assembly language module is:</li>
</ul>
<p>{symbol} {instruction|directive|pseudo-instruction} {;commen}</p>
<ul>
<li><p>Examples</p>
<p>lable1 ADD r1，r2，r3 ;”+</p>
</li>
</ul>
<pre><code>AREA     ARMex, CODE, READONLY

        ENTRY     ; Mark first instruction to execute

start
        MOV      r0, #10        ; Set up parameters
        MOV      r1, #3
        ADD      r0, r0, r1      ; r0 = r0 + r1

        END                      ; Mark end of file
</code></pre><ul>
<li>标签最左边对齐</li>
<li>语句最左边需要空格</li>
</ul>
<h4 id="用汇编语言实现把下列C程序功能？"><a href="#用汇编语言实现把下列C程序功能？" class="headerlink" title="用汇编语言实现把下列C程序功能？"></a>用汇编语言实现把下列C程序功能？</h4><pre><code>int main(void)
{      int i, j;
    unsigned char Inimage[480][640];
    unsigned char Tmpimg[120][160];
    for(i=0;i&lt;120;i++)
         for(j=0;j&lt;160;j++)                
               Tmpimg[i][j]=Inimage[i*4+2][j*4+2];  
    memcpy(Inimage,Tmpimg,160*120);
    return 1;
}</code></pre><h2 id="汇编指令"><a href="#汇编指令" class="headerlink" title="汇编指令"></a>汇编指令</h2><p><img src="/images/loading.gif" data-original="../images/basic/image-20211019210553192.png" alt=""></p>
<ul>
<li>R0-R15和r0-r15</li>
<li>a1-a4(参数,结果或者临时寄存器,与r0-r3同意)</li>
<li>v1-v8(变量寄存器,与r4-r11同意)</li>
<li>sb和SB(静态基址寄存器,与r9同意)</li>
<li>sl和SL(堆栈限制寄存器,与r10同意)</li>
<li>fp和FP(帧指针,与r11同意)</li>
<li>ip和IP(过程调用中间临时寄存器,与r12同意)</li>
<li>sp和SP(堆栈指针,与r13同意)</li>
<li>lr和LR(连接寄存器,与r14同意)</li>
<li>pc和PC(程序计数器,与r15同意)</li>
<li>cpsr和CPSR(程序状态寄存器)</li>
<li>spsr和SPSR(程序状态寄存器)</li>
<li>f0-f7和F0-F7(FPA寄存器)</li>
<li>s0-s31和S0-S31(VFP单精度寄存器)</li>
<li>d0-d15和D0-D15(VFP双精度寄存器)</li>
<li>p0-p15(协处理器0-15)</li>
<li>c0-c15(协处理器寄存器0-15)</li>
</ul>
<h3 id="变量与数据"><a href="#变量与数据" class="headerlink" title="变量与数据"></a><strong>变量与数据</strong></h3><p>数据类型？ Byte，Halfword，Word，Doubleword，QuadWord ( Signed or unsigned？) – Only unsigned (except for MUL)</p>
<p>变量位置？ Memory (Stack，static), Register</p>
<p>变量赋值？ Address (immediate，memory，Register)</p>
<p>常量定义？ EQU</p>
<p>指令和寄存器大小写有区别？</p>
<p>MOV 立即数寻址可以装载任意数据？</p>
<ul>
<li><p>MOV 是ALU单元的操作，改变状态</p>
</li>
<li><p>MVN 按位取反再装载</p>
</li>
</ul>
<h4 id="Loading-immediate"><a href="#Loading-immediate" class="headerlink" title="Loading immediate"></a><strong>Loading immediate</strong></h4><ul>
<li>MOV<ul>
<li>8-bit ,0x0 to 0xFF (0-255).</li>
<li>Rotate by any even number.</li>
<li>MVN load “NOT” Value</li>
<li>Thumb： only 0x00-0xff </li>
</ul>
</li>
</ul>
<blockquote>
<p>理解8位或者偶数移位（<strong>Rotate by any</strong> <strong>even</strong> <strong>number</strong>）</p>
<p>例如260的二进制是100000100 可以由1000001循环右移30位或左移2位，位数位偶数，可以作为立即数</p>
<p>在比如258二进制是100000010 可以由10000001循环右移31位或左移1位，位数是奇数，不可以作为立即数</p>
</blockquote>
<p><strong>实际理解为为了将12位的数字映射到32位上，用8位作为基：0~255；4位作为rotate，循环右移2*rotate</strong></p>
<p>下列指令是否正确？</p>
<pre><code>MOV  rn ,#1025 错
MOV  rn ,#4096 对
MVN  rn ,#0x111 错
MVN  rn ,#0xffffffff 对</code></pre><h4 id="装载任意大小数值"><a href="#装载任意大小数值" class="headerlink" title="装载任意大小数值"></a><strong>装载任意大小数值</strong></h4><ul>
<li>LDR Rd, =const</li>
</ul>
<p>伪指令？</p>
<p>这里两条指令的执行过程与立即数寻址过程的查差别？</p>
<ul>
<li><p>LDR</p>
<ul>
<li><p>LDR -&gt; Appropriate instruction (by assember)</p>
</li>
<li><p>Constant is in the range of MOV or MVN</p>
<p>   LDR -&gt; MOV (MVN) </p>
<p><strong>MOV or MVN” depend on what?</strong></p>
</li>
<li><p>Constant is over the range of MOV or MVN</p>
<ul>
<li>Places the value in a literal pool</li>
<li>LDR instruction with a program-relative address that reads the constant from the literal pool.</li>
</ul>
</li>
</ul>
</li>
</ul>
<pre><code>LDR r0, =0x23
LDR r0, =0xffffff        ;MVN r0，#ff000000
LDR r0, =0x5555        ;？
;LDR   rn, [pc, #offset to literal pool]</code></pre><p>LDR对于不符合的立即数如何转换？</p>
<p>利用pc和literal pool读取</p>
<ul>
<li><p>How to put the “literal pool” in memory?</p>
<ul>
<li>Marking with “LTORG”<ul>
<li>After unconditional branch instructions</li>
<li>after the return instruction</li>
</ul>
</li>
</ul>
</li>
<li><p>By assembler</p>
<ul>
<li>After the end of “AREA”</li>
</ul>
</li>
<li><p>The offset from the pc to the constant</p>
<ul>
<li>ARM state<ul>
<li>Less than 4KB</li>
<li>Either direction</li>
</ul>
</li>
<li>Thumb state<ul>
<li>Less than 1KB</li>
<li>Forward </li>
</ul>
</li>
</ul>
</li>
</ul>
<p>为什么 “LTORG” 要放在跳转后或返回后？不会当作指令取进去.</p>
<p><strong>下列程序中 LDR 指令能否正确转换？</strong></p>
<pre><code>AREA   Loadcon, CODE, READONLY
        ENTRY

        LDR      r0, =42          ; =&gt; MOV R0, #42
       LDR      r1, =0x55555555 ; =&gt; LDR R1, [PC, #offset to Literal Pool 1]
       LDR      r2, =0xFFFFFFFF           ; =&gt; MVN R2, #0
        LTORG                           ; Literal Pool 1 contains
                                              ; literal Ox55555555
       LDR      r3, =0x55555555  ; =&gt; LDR R3, [PC, #offset                
                                             ；Literal Pool 1
       LDR      r4, =0x666 
       END                      
                   ; Literal Pool 2 contains 0x666
</code></pre><h4 id="寄存器常数装载方式"><a href="#寄存器常数装载方式" class="headerlink" title="寄存器常数装载方式"></a>寄存器常数装载方式</h4><table>
<thead>
<tr>
<th>指令</th>
<th>功能</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>MOV(MVN)</td>
<td>装载立即数</td>
<td>8bit</td>
</tr>
<tr>
<td>LDR</td>
<td>装载常数(伪)</td>
<td>32bit位常量</td>
</tr>
<tr>
<td>ADR（L）</td>
<td>装载地址(伪)</td>
<td>32bit  相对地址</td>
</tr>
</tbody></table>
<pre><code>MOV{&lt;cond&gt;}{S}   Rd, #const
LDR Rd, =const
ADR Rd, label</code></pre><ul>
<li><p>Load address</p>
<ul>
<li>ADR and ADRL<ul>
<li>Generate an address, within a certain range<ul>
<li>program-relative expression<ul>
<li>Label with an optional offset</li>
<li>Be relative to the current pc.</li>
</ul>
</li>
<li>Register-relative expression<ul>
<li>Label with an optional offset</li>
<li>Be relative to an address held in a specified general-purpose register.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>ADR</strong></p>
<ul>
<li>Converts ADR rn,label into a Single ADD or SUB instruction that loads the address, if it is in range</li>
<li>The offset range of ADR<ul>
<li>±255 bytes for an offset to a non word-aligned address.</li>
<li>±1 020 bytes (255 words) for an offset to a word-aligned address.</li>
</ul>
</li>
<li>An error message if the address cannot be reached in a single instruction</li>
</ul>
</li>
</ul>
<p><strong>分析下列两条ADR指令的转换结果</strong></p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211019214813141.png" alt=""></p>
<ul>
<li><strong>ADRL</strong><ul>
<li>Converts an ADRL rn,label into two data-processing instructions that load the address, if it is in range </li>
<li>The range of an ADRL<ul>
<li>± 64KB for a non word-aligned address </li>
<li>± 256KB for a word-aligned address.</li>
</ul>
</li>
<li>An error message if the address cannot be constructed in two instructions.</li>
<li>There is no ADRL pseudo-instruction for Thumb.</li>
</ul>
</li>
</ul>
<p><strong>分析下列两条ADRL指令的转换结果</strong></p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211019214953889.png" alt=""></p>
<h3 id="运算"><a href="#运算" class="headerlink" title="运算"></a><strong>运算</strong></h3><p><img src="/images/loading.gif" data-original="../images/basic/image-20211019215044449.png" alt=""></p>
<p><strong>运算符的操作数一定是寄存器或者立即数</strong></p>
<ul>
<li><p>ASR 算数右移</p>
</li>
<li><p>LSL 逻辑左移</p>
</li>
<li><p>LSR 逻辑右移</p>
</li>
<li><p>ROR 循环右移</p>
</li>
<li><p>RRX 带扩展的循环右移</p>
<ul>
<li><shifter_imm> <strong>L: 0-31; R: 1-32</strong>。</shifter_imm></li>
<li>RRX 只能移动一位</li>
</ul>
</li>
</ul>
<p><strong>分析下指令</strong></p>
<pre><code>ADD      r0, r1, #10
ADD   r11,r12,r3, ASR #5 
ADD   r11,r12,r3,LSL R4 
ADD     r5,r4, r3, RRX </code></pre><h4 id="算术指令"><a href="#算术指令" class="headerlink" title="算术指令"></a><strong>算术指令</strong></h4><ul>
<li><p>语法</p>
<p>Op{cond}{s} Rd, Rn, Operand2</p>
</li>
<li><p>标志位</p>
<p> N, Z, C,V</p>
</li>
<li><p>指令</p>
</li>
</ul>
<table>
<thead>
<tr>
<th><strong>指令</strong></th>
<th><strong>操作</strong></th>
</tr>
</thead>
<tbody><tr>
<td>ADC</td>
<td>Rd=Rn  + Operand2+C</td>
</tr>
<tr>
<td>ADD</td>
<td>Rd=Rn  + Operand2</td>
</tr>
<tr>
<td>RSB</td>
<td>Rd=Operand2-Rn</td>
</tr>
<tr>
<td>RSC</td>
<td>Rd=Operand2-Rn-!C</td>
</tr>
<tr>
<td>SBC</td>
<td>Rd=Rn-Operand2-!C</td>
</tr>
<tr>
<td>SUB</td>
<td>Rd=Rn-Operand2</td>
</tr>
</tbody></table>
<p>当看溢出时，要把数据看成是有符号数，就是最高位的数字代表是符号，0正1负。如果次高位计算改变符号位则溢出。</p>
<p>当看进位时是将数据看成无符号数，全部是数据没有符号位，如果运算超出数的范围向前进位了，则进位标志置位。</p>
<p><strong>下列指令哪些时错误的？</strong></p>
<pre><code>ADC         r1, r1, #5    对
SUB         r11,r12,r3,ASR #5    对 
RSB         r5,r3,r4, LSR #32        对    
ADD            r3,r7,#1023       错             
SUB         r11,r12,r3,LSL #32    错 最多31
SBC         r5,r4, r4, RRX #3        错 最多1</code></pre><p><strong>给出指令的执行结果</strong></p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211019215615913.png" alt=""></p>
<ul>
<li>cpsr=nzcvqiFt_USER；指定当前个标志位状态，并且工作在用户模式</li>
</ul>
<h4 id="乘法指令"><a href="#乘法指令" class="headerlink" title="乘法指令"></a>乘法指令</h4><ul>
<li><p>MUL和MLA (32bit *32bit -&gt; least 32bit)</p>
<ul>
<li><p>语法</p>
<p>MUL<em>{<strong>cond</strong>}{S} Rd, Rm, Rs</em></p>
<p>MLA<em>{<strong>cond</strong>}{S} Rd, Rm, Rs, Rn</em></p>
</li>
<li><p>执行</p>
<p> MUL: Rs*Rm -&gt;Rd (least)</p>
<p> MLA: Rs*Rm+Rn -&gt; Rd (least)</p>
</li>
<li><p>标志位</p>
<p> N, Z</p>
</li>
</ul>
</li>
</ul>
<p>d!=m</p>
<blockquote>
<p>32位乘32位低32位！</p>
</blockquote>
<p><strong>分析下列指令</strong></p>
<pre><code>MUL     r10,r2,r5
MLA     r10,r2,r1,r5
MULS    r0,r2,r2

MUL     r15,r0,r3        ;错
MLA     r1,r1,r3, r6    ;错</code></pre><ul>
<li><p>U（S）MULL, U（S）MLAL(32bit *32bit -&gt; 64bit)</p>
<ul>
<li><p>语法</p>
<p>Op{<em>cond**}{S}</em> <em>RdLo**,</em> <em>RdHi**, Rm,</em> <em>Rs</em></p>
</li>
<li><p>执行</p>
<p> U（S）MULL: Rs*Rm -&gt;RdLo, RdHi</p>
<p> U（S）MLAL: Rs*Rm+(RdLo,RdHi) -&gt; RdLo , RdHi</p>
</li>
<li><p>标志位 </p>
<p> N, Z</p>
</li>
<li><p>例:</p>
<pre><code>UMULL       r0,r4,r5,r6
UMLALS     r4,r5,r3,r8
UMULL       r1,r15,r10,r2</code></pre><blockquote>
<p>目的寄存器需要用两个32位来存储一个64位</p>
</blockquote>
<p><strong>UMLAL</strong> <strong>与</strong> <strong>MLA</strong> <strong>操作的差别？</strong></p>
</li>
</ul>
</li>
</ul>
<p><strong>给出下列指令的执行结果</strong></p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211028135420129.png" alt=""></p>
<h4 id="逻辑指令"><a href="#逻辑指令" class="headerlink" title="逻辑指令"></a><strong>逻辑指令</strong></h4><ul>
<li><p><strong>语法</strong></p>
<p>Op{cond}{s} Rd, Rn, Operand2</p>
</li>
<li><p>指令</p>
</li>
</ul>
<table>
<thead>
<tr>
<th><strong>指令</strong></th>
<th><strong>操作</strong></th>
</tr>
</thead>
<tbody><tr>
<td>AND</td>
<td>Rd=Rn  &amp; Operand2;  shift_operand</td>
</tr>
<tr>
<td>ORR</td>
<td>Rd=Rn  | Operand2</td>
</tr>
<tr>
<td>EOR</td>
<td>Rd=Rn  ^ Operand2</td>
</tr>
<tr>
<td>BIC</td>
<td>Rd=Rn  &amp; (~Operand2)</td>
</tr>
</tbody></table>
<ul>
<li><p>例</p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211028135715652.png" alt=""></p>
</li>
</ul>
<h4 id="MOV"><a href="#MOV" class="headerlink" title="MOV"></a><strong>MOV</strong></h4><p><strong>寄存器间数据复制</strong></p>
<pre><code>PRE
    R0=0x80
    R1=0x50
    MOV  R0, R1

POST
    R0=? 0x50
    R1=? 0x50</code></pre><p><strong>使用桶形移位寄存器</strong></p>
<pre><code>PRE
    R0=0x80
    R1=0x50

    MOV  R0, R1, LSL #4

POST
    R0=? 0x500
    R1=? 0x50</code></pre><p><img src="/images/loading.gif" data-original="../images/basic/image-20211028135854829.png" alt=""></p>
<table>
<thead>
<tr>
<th><strong>移位操作</strong></th>
<th><strong>结果</strong></th>
<th><strong>Y**</strong>值范围**</th>
</tr>
</thead>
<tbody><tr>
<td>x  LSL y</td>
<td>x  &lt;&lt; y</td>
<td>#0-31  or Rs</td>
</tr>
<tr>
<td>x  LSR y</td>
<td>(unsigned)  x &gt;&gt; y</td>
<td>#1-32  or Rs</td>
</tr>
<tr>
<td>x  ASR y</td>
<td>(signed)  x &gt;&gt; y</td>
<td>#1-32  or Rs</td>
</tr>
<tr>
<td>x  ROR y</td>
<td>((unsigned)x  &gt;&gt;y)|(x&lt;&lt;(32-y))</td>
<td>#1-32  or Rx</td>
</tr>
<tr>
<td>x  RRX</td>
<td>(c  flag &lt;&lt;31)|((unsigned)x&gt;&gt;1)</td>
<td>none</td>
</tr>
</tbody></table>
<p><strong>移位对C标志的影响</strong></p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211028135953614.png" alt=""></p>
<blockquote>
<p>状态寄存器小写0，大写1</p>
</blockquote>
<h4 id="比较"><a href="#比较" class="headerlink" title="比较"></a>比较</h4><pre><code>比较判断    r6&lt; Imageheight? ;  r5&lt;Imagewidth ?
    cmp r6, #Imageheight
    cmp r5, #Imagewidth</code></pre><ul>
<li><p>语法</p>
<p> CMP{cond} Rn, Operand2</p>
</li>
<li><p>第二操作数（Operand2）</p>
</li>
</ul>
<pre><code>#&lt;immediate&gt;
&lt;Rm&gt; </code></pre><blockquote>
<p>ALU_out[31]àN; alu_out=0, Z=1 else Z=0;</p>
<p>Not borrow from “Rn-Operand2 “ : C=1 else C=0;</p>
<p>Overflow from “ Rn-Operand2”: V=1 else V=0;</p>
</blockquote>
<blockquote>
<p>自动改变状态寄存器</p>
</blockquote>
<ul>
<li><p>语法</p>
<p>Op{cond} Rn, Operand2</p>
</li>
<li><p>指令</p>
</li>
</ul>
<table>
<thead>
<tr>
<th><strong>指令</strong></th>
<th><strong>操作</strong></th>
</tr>
</thead>
<tbody><tr>
<td>CMN</td>
<td>flag of Rn + Operand2;&lt;Rm&gt;</td>
</tr>
<tr>
<td>CMP</td>
<td>flag of Rn - Operand2; &lt;Rm&gt;, <imm_8></imm_8></td>
</tr>
<tr>
<td>TEQ</td>
<td>flag of Rn ^ Operand2;&lt;shift_operand&gt;</td>
</tr>
<tr>
<td>TST</td>
<td>flag of Rn &amp; Operand2;&lt;Rm&gt;</td>
</tr>
</tbody></table>
<ul>
<li>例</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211028140522389.png" alt=""></p>
<blockquote>
<p>不改变通用寄存器数值，自动改变状态寄存器状态</p>
</blockquote>
<h4 id="跳转"><a href="#跳转" class="headerlink" title="跳转"></a>跳转</h4><pre><code>跳转     for (;;)  
行内循环              cmp     r5, #Imagewidth
        bmi     Linecircle
行间循环
                  cmp     r6, #Imageheight
                            bmi     Framecircle</code></pre><ul>
<li>语法</li>
</ul>
<pre><code> B{&lt;cond&gt;} label</code></pre><ul>
<li><p>如果Imagewidth 或 Imageheight 大于0xff，如何处理？</p>
</li>
<li><p>label ？ 有什么要求？</p>
</li>
<li><p>支持哪些 cond？ 如何表达？ </p>
</li>
<li><p>语法</p>
</li>
</ul>
<pre><code>B{&lt;cond&gt;} label
BL{&lt;cond&gt;} label
BX{&lt;cond&gt;} Rm
BLX{&lt;cond&gt;} label|Rm</code></pre><ul>
<li>指令</li>
</ul>
<table>
<thead>
<tr>
<th>指令</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>B(跳转)</td>
<td>pc=label</td>
</tr>
<tr>
<td>BL(带返回跳转)</td>
<td>pc=label,  lr=BL 后面第一条指令地址</td>
</tr>
<tr>
<td>BX(切换状态跳转)</td>
<td>pc=Rm  &amp; 0xfffffffe, T=Rm &amp; 1</td>
</tr>
<tr>
<td>BLX</td>
<td>pc=  label, T=1  pc=Rm  &amp; 0xfffffffe, T=Rm &amp; 1  lr=BLX 后面的第一条指令地址</td>
</tr>
</tbody></table>
<ul>
<li><strong>B</strong></li>
</ul>
<pre><code>B     forward
backward
    ADD     r1, r2, #4
    ADD    r0, r6, #2
    ADD     r3, r7, #5
forward
    SUB    r1, r2, #4
    ADD    r1, r2, #4
    SUB    r1, r2, #4
    ADD    r4, r6, r7
    B     backward</code></pre><p>B 可以在4G空间任意范围内跳转吗？</p>
<p>±32MB</p>
<ul>
<li><strong>BX</strong></li>
</ul>
<pre><code>CODE32 
header
    MOV r0, #0                         
      ADR     r0, start + 1               
        BX      r0  

    CODE16                  
start
            ADD r1, r2
    SUB r2, #0x55
            CMP r0, r1                  
       ……</code></pre><ul>
<li><p>如何添加指令，从CODE16段跳到header</p>
</li>
<li><p>Thumb指令特点：</p>
<ul>
<li>使用ARM的r0-r7 8个通用寄存器</li>
<li>Thumb指令没有条件执行</li>
<li>指令自动更新标志，不需加（s）</li>
<li>仅有LDMIA（STMIA）<ul>
<li>只有IA一种形式</li>
<li>必须加“！”</li>
</ul>
</li>
<li>在数据运算指令中，不支持第二操作数移位</li>
</ul>
<blockquote>
<p>Thumb指令是16位的Arm指令集，可以理解为Arm的阉割版</p>
<p><a href="https://blog.csdn.net/qq_20880415/article/details/101037010" target="_blank" rel="noopener">https://blog.csdn.net/qq_20880415/article/details/101037010</a></p>
<p>指令操作16位</p>
<p>操作依然是32位</p>
</blockquote>
</li>
<li><p><strong>BL</strong></p>
</li>
</ul>
<pre><code>BL     subroutine
    CMP     r1, #5
    MOV     r1, #0
    ADD     r1, r2, #4
    ……
subroutine 
    ADD    r1, r2, #4
    SUB    r1, r2, #4
    MOV    pc, lr</code></pre><p>函数的返回方式？</p>
<blockquote>
<p>Lr是跳转前下一条指令的地址</p>
</blockquote>
<ul>
<li>条件类型</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211028141148231.png" alt=""></p>
<ul>
<li>比较下列指令</li>
</ul>
<pre><code>ADD     r0, r1, r2    ; r0 = r1 + r2, don't update flags
ADDS    r0, r1, r2    ; r0 = r1 + r2, and update flags
ADDCSS  r0, r1, r2    ; If C flag set then r0 = r1 + r2,                 
                                   ;    and update flags
CMP     r0, r1        ; update flags based on r0-r1.</code></pre><ul>
<li><strong>下列程序中哪些指令不执行</strong></li>
</ul>
<pre><code>    MOV r0, #1
    MOV r1, #2
    CMP r0, r1    ;N=1
    SUBGT r0,r0,r1    ;不执行
    SUBLT r1,r1,r0    ;r1=1
    CMP r0,r1        ;z=1
    SUBGT r0,r0,r1    ;不执行
    SUBLT r1,r1,r0    ;不执行</code></pre><ul>
<li><p><strong>不同跳转方法的对比</strong></p>
<ul>
<li>实现方法</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211028141314709.png" alt=""></p>
<ul>
<li>执行时间分析（condition branch)</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211028141432965.png" alt=""></p>
<p>​        不执行的指令也占时间？</p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211028141503386.png" alt=""></p>
</li>
</ul>
<h2 id="小结-1"><a href="#小结-1" class="headerlink" title="小结"></a>小结</h2><pre><code>//c/c++    
for(i=0;i&lt;120;i++)
{ 
    for(j=0;j&lt;160;j++){……}
} </code></pre><pre><code>Imageheight    equ    120
Imagewidth    equ    160

         area    ImScale , code , readonly                               
         entry        
        mov    r6, #0
Framcircle 
    mov    r5, #0
Linecircle
    ……    
        add r5, r5,#1
        cmp r5, #Imagewidth
      bmi  Linecircle
        add r6, r6, #1
        cmp r6, #Imageheight
        bmi Framecircle
        end</code></pre><h1 id="ARM汇编-1"><a href="#ARM汇编-1" class="headerlink" title="ARM汇编"></a>ARM汇编</h1><p>把下列C程序改成汇编程序 ：</p>
<pre class="line-numbers language-c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>      <span class="token keyword">int</span> i<span class="token punctuation">,</span> j<span class="token punctuation">;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">char</span> Inimage<span class="token punctuation">[</span><span class="token number">480</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">640</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">char</span> Tmpimg<span class="token punctuation">[</span><span class="token number">120</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">160</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">120</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
         <span class="token keyword">for</span><span class="token punctuation">(</span>j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span><span class="token number">160</span><span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span>                
               Tmpimg<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">=</span>Inimage<span class="token punctuation">[</span>i<span class="token operator">*</span><span class="token number">4</span><span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token operator">*</span><span class="token number">4</span><span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  
    <span class="token function">memcpy</span><span class="token punctuation">(</span>Inimage<span class="token punctuation">,</span>Tmpimg<span class="token punctuation">,</span><span class="token number">160</span><span class="token operator">*</span><span class="token number">120</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="存储访问"><a href="#存储访问" class="headerlink" title="存储访问"></a><strong>存储访问</strong></h2><h3 id="内存分配"><a href="#内存分配" class="headerlink" title="内存分配"></a><strong>内存分配</strong></h3><p><img src="/images/loading.gif" data-original="../images/basic/image-20211028142708487.png" alt=""></p>
<pre><code>//c/c++    
Tmpimg[120][160]；
Inimage[480][640];

//分配
Tmpimg    space        160*120    ;单位字节
Inimage    space        640*480

//语法
[label]        SPACE        expression
可用 %代替 SPACE</code></pre><p>“160×120”和“640×480”中的“×”运算在程序运行时完成吗？</p>
<h4 id="内存区域分配"><a href="#内存区域分配" class="headerlink" title="内存区域分配"></a><strong>内存区域分配</strong></h4><ul>
<li><p>DCX{U-对齐选项}</p>
<ul>
<li><p>种类</p>
<ul>
<li>DCB-(1byte)</li>
<li>DCD and DCDU-(4 bytes)</li>
<li>DCFD and DCFDU-(double-precision float point)</li>
<li>DCFS and DCFSU-(single-precision float point)</li>
<li>DCI-(like DCD and DCDU)</li>
<li>DCQ and DCQU-(8 bytes)</li>
<li>DCW and DCWU-(2 bytes)</li>
</ul>
</li>
<li><p>用法</p>
<p><em>{label}</em>   DCX{U}  <em>expression，{expression,<strong>……</strong>}</em></p>
</li>
<li><p>Example</p>
</li>
</ul>
</li>
</ul>
<pre><code>data        DCW     -225,2*number
              DCWU    number+4    ;number must be     defined
    DCQ     -225, 2_101
DCFD    1E308, -4E-100
DCFDU   10000, -.1, 3.1E26 </code></pre><pre><code>加“U” 不需要对齐
不同命令对其格式不一样
DCD-4Bytes
DCW-2Bytes</code></pre><h4 id="分析内存中数据存储状况"><a href="#分析内存中数据存储状况" class="headerlink" title="分析内存中数据存储状况"></a>分析内存中数据存储状况</h4><pre><code>    DCB     1，2，3
    DCDU 0x11223344
    DCW     0x2233，0x4455
    DCWU 0x677
    DCD 0x06070809</code></pre><ul>
<li><p>Endian 模式对存储状况的影响？大端小端</p>
</li>
<li><p>SPACE与 DCX使用上的区别？ DCX分配空间与写入值</p>
</li>
<li><p>程序中如何找到分配区域的起始地址？自定义标签</p>
</li>
</ul>
<blockquote>
<p>练习，画出内存中存储位置</p>
</blockquote>
<h4 id="数据结构"><a href="#数据结构" class="headerlink" title="数据结构"></a><strong>数据结构</strong></h4><pre class="line-numbers language-c"><code class="language-c"><span class="token comment" spellcheck="true">//Declare </span>
<span class="token keyword">typedef</span> <span class="token keyword">struct</span> Point
<span class="token punctuation">{</span>
        <span class="token keyword">float</span> x<span class="token punctuation">;</span>
      <span class="token keyword">float</span> y<span class="token punctuation">;</span>
    <span class="token keyword">float</span> z<span class="token punctuation">;</span>
<span class="token punctuation">}</span> Point<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//Allocate space</span>
Point origin<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre><code>//Declare 
PointBase   RN      r11
                 MAP     0,PointBase    ;r11地址作为初始地址
Point_x     FIELD   4    
Point_y     FIELD   4
Point_z     FIELD   4

//Allocate space
origin      SPACE   12</code></pre><h3 id="内存访问"><a href="#内存访问" class="headerlink" title="内存访问"></a><strong>内存访问</strong></h3><pre class="line-numbers language-assembly"><code class="language-assembly">//c/c++    
    Tmpimg[i][j]; Inimage[i*4+2][j*4+2];

//i->r5; j->r6; Tmpimg-> r8; Inimage->r9;
    ldr    r8,    =Tmping
    ldr    r9,    =Inimage
//Tmpimg[i][j]->r10;
    mov    r0,    #Imagewidth
    mul    r10, r5, r0   ;i*Imagewidth
    add    r10, r10, r6   ;i*Imagewidth+j
//Inimage[i*4+2][j*4+2]-> r11
    mov    r1, r5, asl #2 ; i*4
    add    r1, r1, #2    ;i*4+2
    mul    r11, r1, r0    ;(i*4+2)*Imagewidth
    mov    r1, r6, asl #2 ;j*4
    add    r1, r1, #2    ;j*4+2
    add    r11, r11, r1; (i*4+2)*Imagewidth+4*j+2
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre><code>//c/c++    
    Tmpimg[i][j]=Inimage[i*4+2][j*4+2];

//实现    
    ldrb    r0, [r11]    读取方式
    strb    r0, [r10]    存储数据

//语法    
LDR {&lt;cond&gt;}{B} Rd, addressing1
STR{&lt;cond&gt;}{B}  Rd, addressing1</code></pre><h4 id="读（Memory-gt-Register）"><a href="#读（Memory-gt-Register）" class="headerlink" title="读（Memory->Register）"></a>读（Memory-&gt;Register）</h4><table>
<thead>
<tr>
<th>指令</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>LDR</td>
<td>Rd&lt;-mem32[add]</td>
</tr>
<tr>
<td>LDRB</td>
<td>Rd&lt;-mem8[add]</td>
</tr>
<tr>
<td>LDRH</td>
<td>Rd&lt;-mem16[add]</td>
</tr>
<tr>
<td>LDRSB</td>
<td>Rd&lt;-SignExtend(mem8[add])</td>
</tr>
<tr>
<td>LDRSH</td>
<td>Rd&lt;-SignExtend(mem16[add])</td>
</tr>
</tbody></table>
<ul>
<li><p>指令形式</p>
<pre><code>LDR {&lt;cond&gt;}{B} Rd, address1
LDR {&lt;cond&gt;}SB|H|SH Rd, address2</code></pre></li>
<li><p>address</p>
<ul>
<li>基于寄存器的寻址</li>
<li>地址对齐要求？</li>
</ul>
</li>
</ul>
<p>LDR 可能改变状态寄存器状态位？</p>
<ul>
<li><p>Address1</p>
<ul>
<li>[Rn]</li>
<li>前偏移，Rn不变<ul>
<li>[Rn, # +/- offset_12] </li>
<li>[Rn, +/-Rm]</li>
<li>[Rn,+/-Rm, shift_imm]</li>
</ul>
</li>
<li>前偏移，Rn更新<ul>
<li>[Rn,#+/-offset_12]!  </li>
<li>[Rn,+/-Rm]!</li>
<li>[Rn,+/-Rm, shift_imm]!</li>
</ul>
</li>
<li>后偏移，Rn更新<ul>
<li>[Rn], # +/- offset_12  </li>
<li>[Rn], +/-Rm</li>
<li>[Rn],+/-Rm, shift_imm</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>带“！”表示需要更新Rn内寄存器的值</strong></p>
</li>
</ul>
<p><strong>解释下列指令</strong></p>
<pre><code>ldr r0, [r1, #0x04]!
ldr r0, [r1, r2]!                ;R1+r2-&gt;r0，更新r1
ldr r2,[r1, -r0, LSR #0x04]!    ;R0&lt;&lt;4 +r1-&gt;r2, 更新r1
ldr r0, [r1], #0x04                ;r1-&gt;r0，r0-&gt;r0+4
ldr r0,[r1],r2
rdr r0,[r1], -r0, LSL #0x04   
ldr r0, [r1, #0x04]
ldr r0, [r1, r2]
ldr r2,[r1, -r0, LSR #0x04]
</code></pre><p><strong>比较五条指令的执行结果</strong></p>
<pre><code>LDR r0, [r1, #4]    r0=0x3030303,r1=0x104
LDR r0, [r1, #4]!    R0=0x3030303,r1=0x108
LDR r0, [r1], #4    r0=0x80808080,r1=0x108
LDRB r0, [r1]        r0=0x00000080
LDRSB r0, [r1]        r0=0xFFFFFF80</code></pre><p><img src="/images/loading.gif" data-original="../images/basic/image-20211104181456533.png" alt=""></p>
<ul>
<li>address2(针对LDR(S)B)<ul>
<li>[Rn, #+/-offset_8]</li>
<li>[Rn,+/-Rm]</li>
<li>[Rn, #+/-offset_8]!</li>
<li>[Rn,+/-Rm]!</li>
<li>[Rn], #+/-offset_8</li>
<li>[Rn],+/-Rm</li>
</ul>
</li>
</ul>
<p><strong>下列指令，哪些是正确的？</strong></p>
<pre><code>LDR r1, r2, r3            错，r2加[]
LDR r1,[r2, #0x111]        对，符合12位
LDR r1,[r2], +#0x11111    错，超出12位
LDRSB r1,[r2], -#0x111    错，SB只支持8位
LDRH [r1],r2            对
LDRSH r1,[r2,r3]        对
LDRB r1,[r2,-r3]        对
</code></pre><h4 id="写（Register-gt-Memory）"><a href="#写（Register-gt-Memory）" class="headerlink" title="写（Register->Memory）"></a>写（Register-&gt;Memory）</h4><table>
<thead>
<tr>
<th>指令</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>STR</td>
<td>Rd-&gt;mem32[add]</td>
</tr>
<tr>
<td>STRB</td>
<td>Rd-&gt;mem8[add]</td>
</tr>
<tr>
<td>STRH</td>
<td>Rd-&gt;mem16[add]</td>
</tr>
</tbody></table>
<pre><code>STR{&lt;cond&gt;}{B} rd, addressing1
STR{&lt;cond&gt;}{H} rd, addressing2</code></pre><blockquote>
<p><strong>ldr  vs  str ?</strong> </p>
<p><strong>为什么没有strsb和strsh?</strong></p>
</blockquote>
<p><strong>双字访问</strong></p>
<p>语法</p>
<pre><code>LDR|STR{cond}D Rd, [Rn]
LDR|STR{cond}D Rd, [Rn, Offset]{!}
LDR|STR{cond}D Rd, label
LDR|STR{cond}D Rd, [Rn], Offset</code></pre><p>例：</p>
<pre><code>LDRD    r6,[r11]        ;隐含r7,r7 = r11+4
STRD    r4,[r9,#24]
STRD    r0,abcd
LDRD    r1,[r6]        ; Rd 必须为偶数
STRD    r14,[r9,#36]   ; Rd 不能是R14.读可以写不可以
STRD    r2,[r3],r6     ; Rn 不能是 Rd 或 R(d+1).</code></pre><blockquote>
<p>D表示读两个32位，两个字，第一个寄存器是偶数，一个字32位，半字16位</p>
<p>注：32位CPU的话，一个字是32位，正常16位CPU一个字16位</p>
<p>两个数字同时读取到寄存器中嘛？为什么？</p>
<p>一般一条总线或同一区间时，分先后</p>
</blockquote>
<p><strong>交换数据</strong></p>
<p>指令</p>
<table>
<thead>
<tr>
<th>指令</th>
<th>Operation</th>
</tr>
</thead>
<tbody><tr>
<td>SWP</td>
<td>tmp=mem32[Rn]  Mem32[Rn]=Rm  Rd=tmp</td>
</tr>
<tr>
<td>SWPB</td>
<td>tmp=mem8[Rn]  Mem8[Rn]=Rm  Rd=tmp</td>
</tr>
</tbody></table>
<p>格式</p>
<pre><code>SWP {B} {&lt;cond&gt;} Rd, Rm, [Rn]</code></pre><p><strong>分析下列指令的执行结果</strong></p>
<pre><code>mem32[0x8000]=0x12345678
R0=0x00000000
R1=0x22223333
R2=0x8000

SWP r0, r1, [r2]

mem32[0x8000]=?    0x22223333
R0=?            0x12345678
R1=?            0x22223333
R2=?            0x8000</code></pre><p><strong>结构访问</strong></p>
<pre><code>//C
origin.x = 0;
origin.y = 2;
origin.z = 3;

//asm
        LDR     PointBase,=origin
        MOV    r0,#0
        STR     r0,Point_x
        MOV    r0,#2
        STR     r0,Point_y
        MOV    r0,#3
        STR     r0,Point_z</code></pre><p><strong>如何实现数据在内存中的移动？</strong></p>
<h3 id="批量读写"><a href="#批量读写" class="headerlink" title="批量读写"></a><strong>批量读写</strong></h3><pre><code>//c/c++    
    memcpy(Inimage,Tmpimg,160*120);

//asm    
    ldr     r10,     =160*120
memcpy    
    ldmia    r8! ,    {r0-r7}    ;r8!地址寄存器
    stmia    r9! ,    {r0-r7}
    subs    r10,r10, #8*4
    bgt    memcpy
</code></pre><h4 id="多存储器数据传送"><a href="#多存储器数据传送" class="headerlink" title="多存储器数据传送"></a><strong>多存储器数据传送</strong></h4><p>指令</p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211104193015915.png" alt=""></p>
<p>格式</p>
<ul>
<li>LDM|STM{cond}address-mode Rn{!},reg-list{^}<ul>
<li>Cond: condition code. </li>
<li>address-mode: the mode of change address.</li>
<li>Rn: base register for the load operation. </li>
<li>^ : includes lr and spsr ；注意，cpsr切换异常模式</li>
</ul>
</li>
</ul>
<p><strong>地址变化方式</strong></p>
<table>
<thead>
<tr>
<th><strong>符号</strong></th>
<th><strong>变化方式</strong></th>
<th><strong>数据起始地址</strong></th>
<th><strong>数据结束地址</strong></th>
<th><strong>Rn!</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>IA</strong></td>
<td><strong>后增加</strong></td>
<td><strong>Rn</strong></td>
<td><strong>Rn+4N-4</strong></td>
<td><strong>Rn+4N</strong></td>
</tr>
<tr>
<td><strong>IB</strong></td>
<td><strong>先增加</strong></td>
<td><strong>Rn+4</strong></td>
<td><strong>Rn+4N</strong></td>
<td><strong>Rn+4N</strong></td>
</tr>
<tr>
<td><strong>DA</strong></td>
<td><strong>后减少</strong></td>
<td><strong>Rn-4N+4</strong></td>
<td><strong>Rn</strong></td>
<td><strong>Rn-4N</strong></td>
</tr>
<tr>
<td><strong>DB</strong></td>
<td><strong>先减少</strong></td>
<td><strong>Rn-4N</strong></td>
<td><strong>Rn-4</strong></td>
<td><strong>Rn-4N</strong></td>
</tr>
</tbody></table>
<p><strong>解释下列指令</strong></p>
<pre><code>LDMIA r1, {r0, r2-r7}    ;共7个
STMIA r1!, {r2,r3}
LDMDA r3, {r4-r7}
STMDA r3!, {r4-r7}
LDMIB r1, {r2, r3}
STMIB r1!, {r2,r3,r7, r10}
LDMDB r3, {r4-r7}
STMDB r3!, {r4-r7}</code></pre><blockquote>
<p><strong>！表示寄存器读写完最后地址写入</strong></p>
</blockquote>
<p><strong>这两条指令的执行结果相同吗？</strong></p>
<pre><code>LDMIA r0, {r1, r2, r3, r4} 
LDMIA r0, {r4, r3, r1, r2}</code></pre><p>运行下列程序，看结果</p>
<pre><code>    area datarw , code , readonly, align=3
    entry    
    ldr r0,=dmem    
    LDMIA r0, {r1, r2, r3, r4}
    nop
    LDMIA r0, {r4, r3, r1, r2}
stop
        b stop
dmem     dcd 0x1234,0x2345,0x3456,0x5678
    end</code></pre><p><strong>内存中的地址顺序与寄存器序号对应，与列表中的次序无关！</strong></p>
<p><strong>根据图中内存和寄存器的初始值，分析下列指令的执行结果</strong></p>
<pre><code>R0=0x80020
R1=0x1111
R2=0x2222
R3=0x3333</code></pre><table>
<thead>
<tr>
<th><strong>Mem  add</strong></th>
<th><strong>data</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>0x80030</strong></td>
<td><strong>0x009</strong></td>
</tr>
<tr>
<td><strong>0x8002c</strong></td>
<td><strong>0x008</strong></td>
</tr>
<tr>
<td><strong>0x80028</strong></td>
<td><strong>0x007</strong></td>
</tr>
<tr>
<td><strong>0x80024</strong></td>
<td><strong>0x006</strong></td>
</tr>
<tr>
<td><strong>0x80020</strong></td>
<td><strong>0x005</strong></td>
</tr>
<tr>
<td><strong>0x8001c</strong></td>
<td><strong>0x004</strong></td>
</tr>
<tr>
<td><strong>0x80018</strong></td>
<td><strong>0x003</strong></td>
</tr>
<tr>
<td><strong>0x80014</strong></td>
<td><strong>0x002</strong></td>
</tr>
<tr>
<td><strong>0x8000c</strong></td>
<td><strong>0x001</strong></td>
</tr>
<tr>
<td><strong>0x80008</strong></td>
<td><strong>0x000</strong></td>
</tr>
</tbody></table>
<pre><code>LDMIA r0!,{r1-r3} r0=0x8002c,r1=0x005,r2=0x006
LDMDA r0, {r3,r2} 
LDMIB r0!,{r1-r3} r0=0x80030,r1=0x006,r2=0x007
LDMDB r0, {r3,r2}
STMIA r0!,{r1-r3}
STMDA r0, {r3,r2}
STMIB r0!,{r1-r3}
STMDB r0, {r3,r2}</code></pre><h4 id="堆栈操作"><a href="#堆栈操作" class="headerlink" title="堆栈操作"></a><strong>堆栈操作</strong></h4><ul>
<li><p>堆栈的物理位置？</p>
</li>
<li><p>sp?</p>
</li>
<li><p>属性 ：基址，指针和限制</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>符号</th>
<th>功能</th>
<th>pop</th>
<th>=LDM</th>
<th>push</th>
<th>=STM</th>
</tr>
</thead>
<tbody><tr>
<td>FA</td>
<td>Full  In</td>
<td>LDMFA</td>
<td>LDMDA</td>
<td>STMFA</td>
<td>STMIB</td>
</tr>
<tr>
<td>FD</td>
<td>Full de</td>
<td>LDMFD</td>
<td>LDMIA</td>
<td>STMFD</td>
<td>STMDB</td>
</tr>
<tr>
<td>EA</td>
<td>Empty  In</td>
<td>LDMEA</td>
<td>LDMDB</td>
<td>STMEA</td>
<td>STMIA</td>
</tr>
<tr>
<td>ED</td>
<td>Empty de</td>
<td>LDMED</td>
<td>LDMIB</td>
<td>STMED</td>
<td>STMDA</td>
</tr>
</tbody></table>
<pre><code>R1=0x005
R3=0x004
SP=0x80014

STMFD sp!,{r1, r3}</code></pre><p><img src="/images/loading.gif" data-original="../images/basic/image-20211104193640268.png" alt=""></p>
<p><strong>设定sp时如何确定初始值？</strong></p>
<p><strong>R13,必须有效内存空间</strong></p>
<h2 id="标签命名"><a href="#标签命名" class="headerlink" title="标签命名"></a>标签命名</h2><p>标签ARM 汇编程序中自定义符号（label, variables, constant等）有限制吗?</p>
<h3 id="规则"><a href="#规则" class="headerlink" title="规则"></a><strong>规则</strong></h3><ul>
<li>Can use uppercase letters, lowercase letters, numeric characters, or the underscore character in symbol names.</li>
<li>Do not use numeric characters for the first character of symbol names, except in local labels (see Local labels).</li>
<li>Symbol names are case-sensitive.</li>
<li>All characters in the symbol name are significant.</li>
<li>Symbol names must be unique within their scope.</li>
<li>Symbols must not use built-in variable names or predefined symbol names </li>
</ul>
<p><strong>保留的（predefined）字</strong></p>
<ul>
<li><p>register names</p>
</li>
<li><p>r0-r15 and R0-R15</p>
</li>
<li><p>a1-a4 (argument, result, or scratch registers, synonyms for r0 to r3)</p>
</li>
<li><p>v1-v8 (variable registers, r4 to r11)</p>
</li>
<li><p>sb and SB (static base, r9)</p>
</li>
<li><p>sl and SL (stack limit, r10)</p>
</li>
<li><p>fp and FP (frame pointer, r11)</p>
</li>
<li><p>ip and IP (intra-procedure-call scratch register, r12)</p>
</li>
<li><p>sp and SP (stack pointer, r13)</p>
</li>
<li><p>lr and LR (link register, r14)</p>
</li>
<li><p>pc and PC (program counter, r15).</p>
</li>
<li><p>program status register names</p>
<ul>
<li>cpsr and CPSR (current program status register)</li>
<li>spsr and SPSR (saved program status register).</li>
</ul>
</li>
<li><p>floating-point register names</p>
<ul>
<li>f0-f7 and F0-F7 (FPA registers)</li>
<li>s0-s31 and S0-S31 (VFP single-precision registers)</li>
<li>d0-d15 and D0-D15 (VFP double-precision registers).</li>
</ul>
</li>
<li><p>coprocessor names</p>
<ul>
<li>p0-p15 (coprocessors 0-15)</li>
<li>c0-c15 (coprocessor registers 0-15).</li>
</ul>
</li>
</ul>
<p><strong>下列自定义符号哪些是正确的？</strong></p>
<pre><code>SPSR        错
Cpsr        对    
MOV
Add
Codesize
moV
||ASSERT||    对    ?
8_123d        错
102srd        错
</code></pre><h2 id="预计算"><a href="#预计算" class="headerlink" title="预计算"></a>预计算</h2><p><strong>指令 “ subs  r10, r10, #8<em>4”中，“ 8</em>4” 在什么时候计算？</strong></p>
<p><strong>汇编器中计算，非处理器计算</strong></p>
<h3 id="双目计算"><a href="#双目计算" class="headerlink" title="双目计算"></a><strong>双目计算</strong></h3><ul>
<li><p>算术运算：+，-，*，/，MOD</p>
<p> MOV r0, #(5*4)</p>
<p> LDR R0, =start+3*n</p>
</li>
<li><p>移位运算：ROL, ROR, SHL, SHR</p>
<p> A:ROL:B </p>
<p> (3: ROR:4)</p>
</li>
<li><p>逻辑运算：AND, OR, EOR</p>
<p> A: AND:B</p>
<p> (0xcc55:OR:0x55cc)</p>
</li>
<li><p>关系运算：=，&lt;, &gt;, &gt;=, &lt;=, &lt;&gt;, /=</p>
<p> A&lt;&gt;B</p>
<p> (7&lt;&gt;7)</p>
</li>
</ul>
<h3 id="单目运算"><a href="#单目运算" class="headerlink" title="单目运算"></a><strong>单目运算</strong></h3><table>
<thead>
<tr>
<th>运算符</th>
<th>用法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>？</td>
<td>？A</td>
<td>A所在行的代码长度</td>
</tr>
<tr>
<td>BASE</td>
<td>:BASE:A</td>
<td>（寄存器或程序相对表示）A的基地址寄存器</td>
</tr>
<tr>
<td>INDEX</td>
<td>:INDEX:A</td>
<td>（寄存器相对表示）A的偏移地址</td>
</tr>
<tr>
<td>+/-</td>
<td>+A, -A</td>
<td>正负号</td>
</tr>
<tr>
<td>NOT</td>
<td>:NOT:A</td>
<td>按位取反</td>
</tr>
<tr>
<td>LNOT</td>
<td>:LNOT:A</td>
<td>逻辑取反</td>
</tr>
<tr>
<td>DEF</td>
<td>:DEF:A</td>
<td>A是否定义，{TRUE/FALSE}</td>
</tr>
<tr>
<td>SB_OFFSET_19_12</td>
<td>:SB_OFFSET_19_12:label</td>
<td>label-sb的bits[19:12]</td>
</tr>
<tr>
<td>SB_OFFSET_11_0</td>
<td>:SB_OFFSET_11_0: label</td>
<td>label-sb的bits[11:0]</td>
</tr>
</tbody></table>
<p>确定运行时寄存器中的数据（汇编后的结果）</p>
<p>Example1</p>
<pre><code>     LDR r0, =? Mydata         ;10*4=40；
     (LDR r0, =mydata)?         ;没有？则读取的是label地址
     LDR r1, =? Mydata1         ;1*4=4

 mydata    DCD 1,2,3,4,5,6,7,8,9,0
 Mydata1   DCB ‘a’, ‘b’, ‘c’, ‘d’</code></pre><p>Example 2</p>
<pre><code>datastruc         SPACE   280    
                MAP        0,r8 ; (MAP datastruc) ?
       consta               FIELD   4
       constb             FIELD   4
         x                        FIELD   8
         y              FIELD   8
      string                 FIELD   256
              ……
                            LDR r3,=:BASE:y
                              LDR r4,=:INDEX:y
</code></pre><h3 id="逻辑变量"><a href="#逻辑变量" class="headerlink" title="逻辑变量"></a><strong>逻辑变量</strong></h3><ul>
<li>LAND  (处理器指令？）</li>
<li>LOR</li>
<li>LEOR</li>
</ul>
<p><strong>字符串变量</strong></p>
<p><strong>双目运算运算符</strong></p>
<table>
<thead>
<tr>
<th>运算符</th>
<th>用法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>LEFT</td>
<td>A:LEFT:B</td>
<td>返回字符串A中左起的B个字符</td>
</tr>
<tr>
<td>RIGHT</td>
<td>A:RIGHT:B</td>
<td>返回字符串A中右起的B个字符</td>
</tr>
<tr>
<td>CC</td>
<td>A:CC:B</td>
<td>A和B字符串相连接，A在左边</td>
</tr>
</tbody></table>
<p><strong>单目运算运算符</strong></p>
<table>
<thead>
<tr>
<th>运算符</th>
<th>用法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>LEN</td>
<td>:LEN:A</td>
<td>返回字符串A的长度</td>
</tr>
<tr>
<td>CHR</td>
<td>:CHR:A</td>
<td>反回字符A的ASCII码值，A是单个字符</td>
</tr>
<tr>
<td>STR</td>
<td>:STR:A</td>
<td>返回数值或逻辑A的字符串</td>
</tr>
</tbody></table>
<p><strong>Example</strong></p>
<ul>
<li>：LEN：”I am an excellent student!”</li>
<li>: CHR: ‘A’</li>
<li>What is the returned result?</li>
</ul>
<h2 id="宏定义"><a href="#宏定义" class="headerlink" title="宏定义"></a><strong>宏定义</strong></h2><p><strong>封装汇编指令模块，作为用户定义的功能单元</strong></p>
<p>ARM格式</p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211104195426365.png" alt=""></p>
<p>GNU格式</p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211104195451041.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211104195635651.png" alt=""></p>
<blockquote>
<p><strong>不建议在宏内使用固定寄存器，例如v8。</strong></p>
<p><strong>一般定义变量使用</strong></p>
</blockquote>
<h2 id="数值计算"><a href="#数值计算" class="headerlink" title="数值计算"></a><strong>数值计算</strong></h2><h3 id="64位整数加（减）法"><a href="#64位整数加（减）法" class="headerlink" title="64位整数加（减）法"></a>64位整数加（减）法</h3><ul>
<li><p>实现64位数0x2200330044和0x9876543210的加（减）法，相加后的结果保存在起始地址为0x20000000的存储空间里。设数据存储采用小端格式。</p>
</li>
<li><p>如何用32位加法器实现64位加法运算？</p>
</li>
</ul>
<pre class="line-numbers language-assembly"><code class="language-assembly">LDR R0, =0x00000022 ；加载第一个数的高32位放到R0中
LDR R1, =0x00330044  ；加载第一个数的低32位放到R1中
LDR R2, =0x00000098 
LDR R3, =0x76543210 
LDR R6, =0x20000000  ；把存储结果的内存地址放到R6中
ADDS R4, R1, R3（ SUBS R4, R1, R3 ） ;低32位加（减），R4存储低32位
ADC R5, R0, R2 （ SUBC R5, R0, R2 ） ;高32位加（减），R5存储高32位
STMIA R6!,{R4,R5}  ；将R4，R5的数据存储到R6指向的地址上，
                   ；R6值更新<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>一般寄存器大的放高位，这里反了</li>
<li>两数相减大于0，借位为1</li>
<li>借位：A-B-！C</li>
</ul>
<h3 id="64位乘法"><a href="#64位乘法" class="headerlink" title="64位乘法"></a>64位乘法</h3><p><strong>2个无符号64位数a 和 b相乘，得到64位结果</strong></p>
<ul>
<li><p>函数参数的传递方式</p>
<ul>
<li>寄存器 r0-r3 （数目&lt;=4）</li>
<li>堆栈 （&gt;4）</li>
</ul>
</li>
<li><p>返回</p>
<p>​    r0, r1</p>
</li>
<li><p>算法:</p>
<p> <code>H1L1 *H2L2=L1*L2 +(L1*H2)&lt;&lt;32+ (H1*L2)&lt;&lt;32+(H1*H2)&lt;&lt;64</code></p>
</li>
</ul>
<pre class="line-numbers language-assembly"><code class="language-assembly">a_0     RN    0       ;a low
a_1    RN     1    ;a high
b_0     RN    2    ;b low
b_1    RN     3    ;b high
c_0     RN    4    ;c low low
c_1    RN     5    ;c low high
c_2     RN    12    ;c high low
c_3    RN     14    ;c high high
Mul_64 to 64
        stmfd    sp!, {r4,r5,lr}
        umull    c_0,c_1, a_0, b_0     ;low *low 
        mla    c_1, a_0,b_1,c_1    ;low *high
        mla     c_1, a_1, b_0, c_1    ;high* low

        mov     r0, c_0
        mov    r1, c_1            ;return<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>2个有符号64位数a 和 b相乘，得到128位结果</strong></p>
<ul>
<li>算法:</li>
</ul>
<p><code>(S)H1L1 *(S)H2L2=L1*L2 +(L1*(S)H2)&lt;&lt;32+((S)H1*L2)&lt;&lt;32+((S)H1*(S)H2)&lt;&lt;64</code></p>
<ul>
<li><p>无符号乘法: UMULL, UMLAL</p>
</li>
<li><p>有符号乘法: SMULL, SMLAL</p>
</li>
<li><p>有符号* 无符号？</p>
</li>
</ul>
<p><strong>64位乘法</strong></p>
<p>设 A为无符号数， B为有符号数，用SMULL或SMLAL计算，则结果如何？</p>
<p>（1）如果A[31]=0，则<code>(S)A * (S)B= A*(S)B</code></p>
<p>（2）如果A[31]=1, 则<code>(S)A * (S)B= (A-232)*(S)B</code></p>
<pre><code>                                  `A*(S)B = (S)A * (S)B+(1&lt;&lt;32) *(S)B`</code></pre><p>宏定义 USMLAL（无符号*有符号）</p>
<pre class="line-numbers language-assembly"><code class="language-assembly">MACRO
    USMLAL    $cl, $ch, $a, $b    
    ;signed $ch, $cl +=unsigned $a *signed $b
    SMULL        $cl, $ch, $a, $b
    ;c= (signed)a *(signed)b
    TST        $a, #1<<31
    ;if(signed)a<0
    ADDNE          $ch, $ch, $b
    ;c+=(b<<32)
    MEND    <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-assembly"><code class="language-assembly">    smul_64_to_128
    stmfd    sp!, {r4, r5, lr}
    umull     c_0, c_1, a_0, b_0     ;low*low
    mov     c_2, #0
    usmlal    c_1, c_2, a_0, b_1    ;low*high
    mov    c_3, #0
    usmlal    c_1, c_3, b_0, a_1    ;high*low
    mov    a_0, c_2, ASR #31
    adds     c_2, c_2, c_3
    adc    c_3, a_0, c_3, ASR #31
    smlal    c_2, c_3, a_1, b_1    ;high*high
    mov    r0, c_0
    mov    r1, c_1
    mov    r2, c_2
    mov    r3, c_3
    ldmfd    sp!,{r4, r5, pc}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>宏定义 USMLAL（无符号*有符号）</p>
<pre class="line-numbers language-assembly"><code class="language-assembly">    MACRO
    USMLAL    $cl, $ch, $a, $b    
    ;signed $ch, $cl +=unsigned $a *signed $b
    SMULL        $cl, $ch, $a, $b
    ;c= (signed)a *(signed)b
    TST        $a, #1<<31
    ;if(signed)a<0
    ADDNE          $ch, $ch, $b
    ;c+=(b<<32)
    MEND    <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="浮点计算"><a href="#浮点计算" class="headerlink" title="浮点计算"></a>浮点计算</h3><ul>
<li>IEEE754浮点格式</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211104201237806.png" alt=""></p>
<ul>
<li>浮点数与实数的转换<ul>
<li>单精度转换公式</li>
<li><code>V=(-1)^S*2^(E（值）-127)*(1+M)  (指数位!=0)</code></li>
<li><code>V=(-1)^S*2^(1-127)*M (指数位=0)</code></li>
</ul>
</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211104201344272.png" alt=""></p>
<h3 id="浮点加法"><a href="#浮点加法" class="headerlink" title="浮点加法"></a><strong>浮点加法</strong></h3><p><img src="/images/loading.gif" data-original="../images/basic/image-20211104201406193.png" alt=""></p>
<h2 id="小结-2"><a href="#小结-2" class="headerlink" title="小结"></a><strong>小结</strong></h2><p><img src="/images/loading.gif" data-original="../images/basic/image-20211104201417404.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211104201426223.png" alt=""></p>
<p><strong>分析下列程序的功能</strong></p>
<pre class="line-numbers language-assembly"><code class="language-assembly">    AREA    Block, CODE, READONLY    ; name this block of code
num       EQU     20                       ; set number of words to be copied
    ENTRY                            ; mark the first instruction to call
start
    LDR     r0, =src                 ; r0 = pointer to source block
    LDR     r1, =dst                 ; r1 = pointer to destination block
    MOV     r2, #num                 ; r2 = number of words to copy
    MOV     sp, #0x400               ; Set up stack pointer (r13)
blockcopy   
    MOVS    r3,r2, LSR #3     ; Number of eight word multiples
    BEQ     copywords                ; Less than eight words to move?
    STMFD   sp!, {r4-r11}            ; Save some working registers

octcopy  LDMIA   r0!, {r4-r11}            ; Load 8 words from the source
     STMIA   r1!, {r4-r11}            ; and put them at the destination
     SUBS    r3, r3, #1               ; Decrement the counter
     BNE     octcopy                  ; ... copy more
     LDMFD   sp!, {r4-r11}      ; Don't need these now - restore
                                                     ; originals
copywords   
    ANDS    r2, r2, #7               ; Number of odd words to copy
     BEQ     stop                     ; No words left to copy?

wordcopy    LDR     r3, [r0], #4     ; Load a word from the source  and
       STR     r3, [r1], #4             ; store it to the destination
       SUBS    r2, r2, #1               ; Decrement the counter
       BNE     wordcopy                 ; ... copy more
stop             MOV     r0, #0x18                ; 
       LDR     r1, =0x20026          ; ADP_Stopped_ApplicationExit
       SWI     0x123456                 ; ARM semihosting SWI

      AREA    BlockData, DATA, READWRITE
src               DCD     1,2,3,4,5,6,7,8,1,2,3,4,5,6,7,8,1,2,3,4
dst               DCD     0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
                END<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>C程序</p>
<pre class="line-numbers language-c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>      <span class="token keyword">int</span> i<span class="token punctuation">,</span> j<span class="token punctuation">;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">char</span> Inimage<span class="token punctuation">[</span><span class="token number">480</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">640</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">char</span> Tmpimg<span class="token punctuation">[</span><span class="token number">120</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">160</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">120</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
         <span class="token keyword">for</span><span class="token punctuation">(</span>j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span><span class="token number">160</span><span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span>                
               Tmpimg<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">=</span>Inimage<span class="token punctuation">[</span>i<span class="token operator">*</span><span class="token number">4</span><span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token operator">*</span><span class="token number">4</span><span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  
    <span class="token function">memcpy</span><span class="token punctuation">(</span>Inimage<span class="token punctuation">,</span>Tmpimg<span class="token punctuation">,</span><span class="token number">160</span><span class="token operator">*</span><span class="token number">120</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>汇编</p>
<pre class="line-numbers language-assembly"><code class="language-assembly">Imageheight    equ    120
Imagewidth    equ    160
InImagewidth     equ        640
         area    reset , code , readonly                               
         entry        
        mov    r6, #0
Framecircle 
    mov    r5, #0
Linecircle
;i->r5; j->r6; Tmpimg-> r8; Inimage->r9;
    ldr    r8,    =Tmpimg
    ldr    r9,    =Inimage
;Tmpimg[i][j]->r10;
    mov    r0,    #Imagewidth
    mul    r10, r6, r0   ;i*Imagewidth
    add    r10, r10, r5   ;i*Imagewidth+j
    add    r10,r8

;Inimage[i*4+2][j*4+2]-> r11
    mov r0, #InImagewidth
    mov    r1, r6, lsl #2 ; i*4
    add    r1, r1, #2    ;i*4+2
    mul    r11, r1, r0    ;(i*4+2)*InImagewidth
    mov    r1, r5, lsl #2 ;j*4
    add    r1, r1, #2    ;j*4+2
    add    r11, r11, r1; (i*4+2)*InImagewidth+4*j+2
    add    r11, r9
    ldrb    r0, [r11] ;read Inimage
    strb    r0, [r10] ;write Tmpimg
;circle control
        add r5, r5,#1
        cmp r5, #Imagewidth
      bmi  Linecircle
        add r6, r6, #1
        cmp r6, #Imageheight
        bmi Framecircle

; memcpy    
    ldr     r10,     =160*120
memcpy    
    ldmia    r8! ,    {r0-r7}
    stmia    r9! ,    {r0-r7}
    subs    r10,r10, #8*4
    bgt    memcpy
    ;end

    area  imscale，data, readwrite

Tmpimg    space        160*120
Inimage    space        640*480

    end<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="ARM程序基础"><a href="#ARM程序基础" class="headerlink" title="ARM程序基础"></a>ARM程序基础</h1><p>参考内容：</p>
<ul>
<li><p>ARM Architecture Reference Manual（V5）, Second Edition</p>
</li>
<li><p>Andrew N. Sloss 等，沈建华译，ARM嵌入式系统开发-软件设计与优化，北京航空航天大学出版社，2005年5月</p>
</li>
</ul>
<h2 id="函数调用"><a href="#函数调用" class="headerlink" title="函数调用"></a><strong>函数调用</strong></h2><h3 id="源文件内"><a href="#源文件内" class="headerlink" title="源文件内"></a><strong>源文件内</strong></h3><pre><code>    AREA  function, CODE, READONLY
    ENTRY
start
           MOV     r0, #10
        MOV     r1, #3         ;参数
        BL      doadd            ; call

    ……

doadd                               ;函数
        ADD     r0, r0, r1          ;结果
        MOV     pc, lr                ;返回

        END</code></pre><h3 id="不同源文件"><a href="#不同源文件" class="headerlink" title="不同源文件"></a><strong>不同源文件</strong></h3><ul>
<li>File1</li>
</ul>
<pre><code>AREA Main, CODE, READONLY
    IMPORT   Testprg
    ENTRY     
main        ……
        BL Testprg
        ……
        END</code></pre><ul>
<li>File2</li>
</ul>
<pre><code>    AREA  Test, CODE, READONLY
    EXPORT   Testprg
   Testprg
        ADD  r0, r1, r0
        MOV pc,lr
        END</code></pre><blockquote>
<p>汇编import的函数文件需要加export</p>
</blockquote>
<h3 id="ATPCS（ARM-Thumb-Procedure-Call-Standard）"><a href="#ATPCS（ARM-Thumb-Procedure-Call-Standard）" class="headerlink" title="ATPCS（ARM-Thumb Procedure Call Standard）"></a>ATPCS（ARM-Thumb Procedure Call Standard）</h3><ul>
<li><p>寄存器约定</p>
<ul>
<li><p>R0-r3 (a1-a4) 传递参数</p>
</li>
<li><p>R4-r11 (v1-v8)保存局部变量 （r4-r7 for Thumb)</p>
</li>
<li><p>R12 (ip) 过程间自定义数据交换</p>
</li>
<li><p>R13 (sp) 数据堆栈指针</p>
</li>
<li><p>R14 (lr) 保存子程序的返回地址</p>
</li>
<li><p>R15（pc）</p>
</li>
</ul>
</li>
<li><p>ATPCS规定数据栈为FD（满递减）类型，并且对数据栈的操作是8字节对齐。</p>
</li>
</ul>
<blockquote>
<p>向堆栈写数据，指针减小；数据栈8字节对齐</p>
</blockquote>
<ul>
<li>参数传输规则<ul>
<li>〈 =4， r0-r3,依次</li>
<li>大于4，存入数据栈，最后一个数据先入栈</li>
</ul>
</li>
</ul>
<p><code>function( char a, int *b, int c, short d, long f)</code></p>
<blockquote>
<ul>
<li>参数次序与所使用的寄存器？</li>
</ul>
</blockquote>
<blockquote>
<ul>
<li>寄存器的分配与类型（浮点除外）有关？</li>
</ul>
</blockquote>
<ul>
<li>浮点参数传递(顺序传递)<ul>
<li>FPA (Floating Point Arithmetic)：f0-f7 (s0-s7, d0-d7,e0-e7)</li>
<li>VFP (d0-d15, s0-s31)</li>
</ul>
</li>
</ul>
<p><code>float function(int v1, float v2, char *v3, int v4, float v5, double v6, short v7) ；</code></p>
<ul>
<li><p>v1, v3, v4, v7  =&gt; r0, r1, r2, r3</p>
</li>
<li><p>v2, v5 =&gt; s0, s1</p>
</li>
<li><p>v6 =&gt; d0</p>
</li>
</ul>
<blockquote>
<p>继承协处理器</p>
<p>注意参数传递：整形（字符），float，double</p>
</blockquote>
<ul>
<li><p>参数返回规则</p>
<ul>
<li><p>结果为32bit整数时，通过r0传递</p>
</li>
<li><p>结果为64bit整数时，通过r0和R1传递</p>
</li>
<li><p>结果为浮点数时，通过浮点寄存器返回(f0,d0)</p>
</li>
<li><p>更多的数据通过内存返回</p>
</li>
</ul>
</li>
</ul>
<h3 id="C调用汇编"><a href="#C调用汇编" class="headerlink" title="C调用汇编"></a>C调用汇编</h3><pre class="line-numbers language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token keyword">extern</span> <span class="token keyword">void</span> <span class="token function">strcopy</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>d<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//ASM</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>       <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>srcstr <span class="token operator">=</span> <span class="token string">"First string - source "</span><span class="token punctuation">;</span>
        <span class="token keyword">char</span> dststr<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"Second string - destination "</span><span class="token punctuation">;</span>
        <span class="token function">strcopy</span><span class="token punctuation">(</span>dststr<span class="token punctuation">,</span>srcstr<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"After copying:\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"  %s\n  %s\n"</span><span class="token punctuation">,</span>srcstr<span class="token punctuation">,</span>dststr<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-assembly"><code class="language-assembly">        AREA    SCopy, CODE, READONLY
            EXPORT strcopy
strcopy 
        LDRB r2, [r1],#1  ; Load byte and update address.
           STRB r2, [r0],#1  ; 
        CMP r2, #0        ; Check for zero terminator.
            BNE strcopy       ; Keep going if not.
            MOV pc,lr         ; Return.
            END<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>参数传递过程？</strong></p>
<h3 id="汇编调用C"><a href="#汇编调用C" class="headerlink" title="汇编调用C"></a>汇编调用C</h3><pre class="line-numbers language-assembly"><code class="language-assembly">    AREA f, CODE, READONLY
        IMPORT  g
    ENTRY           
        LDR r4, =data
        LDR  r0, [r4], #4
    LDR  r1, [r4], #4
    LDR  r2, [r4], #4
    LDR  r3, [r4], #4
    LDR  r5, [r4]
    STR r5, [sp, #-4]! 
    BL  g               
       ADD sp, sp, #4     
       END<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">g</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">,</span> <span class="token keyword">int</span> c<span class="token punctuation">,</span> <span class="token keyword">int</span> d<span class="token punctuation">,</span> <span class="token keyword">int</span> e<span class="token punctuation">)</span> 
    <span class="token punctuation">{</span>  <span class="token keyword">return</span> a <span class="token operator">+</span> b <span class="token operator">+</span> c <span class="token operator">+</span> d <span class="token operator">+</span> e<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<blockquote>
<p>STR r5, [sp, #-4]!     //栈初始满的，需要减去4字节腾出空间</p>
</blockquote>
<h3 id="C-调用汇编"><a href="#C-调用汇编" class="headerlink" title="C++调用汇编"></a>C++调用汇编</h3><pre class="line-numbers language-c++"><code class="language-c++">struct S { 
        S(int s) {i=s; }
        int i;
    }

extern "C" void asmfunc(S *);                                                     
int f() 
{
        S s(2);                 
        asmfunc(&s); 
    return s.i * 3;
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-assembly"><code class="language-assembly">AREA   Asm, CODE
        EXPORT asmfunc
asmfunc            ; the definition of the Asm function
        LDR r1, [r0] 
    ADD r1, r1, #5
        STR r1, [r0]
        MOV pc, lr
        END<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="汇编调用C-1"><a href="#汇编调用C-1" class="headerlink" title="汇编调用C++"></a>汇编调用C++</h3><pre class="line-numbers language-assembly"><code class="language-assembly">    AREA  Asm, CODE，READONLY
        IMPORT cppfunc
    ENTRY
    MOV    r0,#2
        STR    r0,[sp,#-4]! 
        MOV    r0,sp        
        BL     cppfunc 
    LDR    r0, [sp], #4
        ADD    r0, r0, r0,LSL #1
    END
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-c++"><code class="language-c++">extern "C" void cppfunc(S * p) {
 // Definition of the C++ function to be called from ASM.
    p->i += 5;}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h3 id="嵌入汇编"><a href="#嵌入汇编" class="headerlink" title="嵌入汇编"></a><strong>嵌入汇编</strong></h3><pre class="line-numbers language-c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">my_strcpy</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>src<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>dst<span class="token punctuation">)</span>
<span class="token punctuation">{</span>    <span class="token keyword">int</span> ch<span class="token punctuation">;</span>
        __asm<span class="token punctuation">{</span>
            loop<span class="token punctuation">:</span>
               LDRB    ch<span class="token punctuation">,</span> <span class="token punctuation">[</span>src<span class="token punctuation">]</span><span class="token punctuation">,</span> #<span class="token number">1</span>
                      STRB    ch<span class="token punctuation">,</span> <span class="token punctuation">[</span>dst<span class="token punctuation">]</span><span class="token punctuation">,</span> #<span class="token number">1</span>
              CMP     ch<span class="token punctuation">,</span> #<span class="token number">0</span>
                     BNE     loop
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>嵌入 vs 汇编程序<ul>
<li>不支持 LDR Rn,= XXX 和 ADR, ADRL 伪指令</li>
<li>不支持 BX</li>
<li>用”&amp;”替代 “0x” 表示16位数据</li>
</ul>
</li>
</ul>
<blockquote>
<p>[src], [dst]  ？</p>
<p>ch ？</p>
<p>循环结束条件？</p>
<p>c中的变量？</p>
</blockquote>
<ul>
<li>小心使用寄存器，尽量不用 R0-R3，lr，ip 和CPSR 中的NZCV 标志位；不用r0-r3，用v1-v8</li>
</ul>
<pre class="line-numbers language-c"><code class="language-c">__asm
<span class="token punctuation">{</span>
    MOV R0<span class="token punctuation">,</span> x
    ADD y<span class="token punctuation">,</span> R0<span class="token punctuation">,</span>  y
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>不要使用寄存器替代变量</li>
</ul>
<pre class="line-numbers language-c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">bad_f</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// x in R0</span>
<span class="token punctuation">{</span>          ……
            __asm <span class="token punctuation">{</span> 
               ADD R0<span class="token punctuation">,</span> R0<span class="token punctuation">,</span> #<span class="token number">1</span> ；wrongly asserts that x is still in R0    
           <span class="token punctuation">}</span>    
          <span class="token keyword">return</span> x<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// x in R0</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>无需保存和恢复寄存器</li>
</ul>
<pre class="line-numbers language-c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">)</span><span class="token punctuation">{</span>
           __asm<span class="token punctuation">{</span>
                STMFD sp<span class="token operator">!</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>R0<span class="token punctuation">}</span> ；save R0 <span class="token operator">-</span> illegal<span class="token punctuation">:</span> read before write
                ADD R0<span class="token punctuation">,</span> x<span class="token punctuation">,</span> <span class="token number">1</span>
                EOR x<span class="token punctuation">,</span> R0<span class="token punctuation">,</span> x
                LDMFD sp<span class="token operator">!</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>R0<span class="token punctuation">}</span> ； restore R0 <span class="token operator">-</span> not needed<span class="token punctuation">.</span>    
         <span class="token punctuation">}</span>
         <span class="token keyword">return</span> x<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>汇编语言用“,”作为操作数分隔符。如果有C 或C++表达式作为操作数，必须用“( )”将其归约为一个汇编操作数。</li>
</ul>
<pre><code> __asm {ADD x, y, (f()+z)}</code></pre><h2 id="异常处理"><a href="#异常处理" class="headerlink" title="异常处理"></a><strong>异常处理</strong></h2><h3 id="异常向量表"><a href="#异常向量表" class="headerlink" title="异常向量表"></a><strong>异常向量表</strong></h3><table>
<thead>
<tr>
<th>向量地址</th>
<th>异常中断类型</th>
<th>异常中断模式</th>
<th>优先级</th>
</tr>
</thead>
<tbody><tr>
<td>0x0</td>
<td>Reset</td>
<td>特权（SVC)</td>
<td>1</td>
</tr>
<tr>
<td>0x4</td>
<td>Undefined  Instruction</td>
<td>未定义指令中止模式</td>
<td>6</td>
</tr>
<tr>
<td>0x08</td>
<td>SWI</td>
<td>特权模式</td>
<td>6</td>
</tr>
<tr>
<td>0x0c</td>
<td>Prefetch  Abort</td>
<td>中止模式</td>
<td>5</td>
</tr>
<tr>
<td>0x10</td>
<td>Data  Abort</td>
<td>中止模式</td>
<td>2</td>
</tr>
<tr>
<td>0x14</td>
<td>Reserved</td>
<td>未使用</td>
<td>未使用</td>
</tr>
<tr>
<td>0x18</td>
<td>IRQ中断</td>
<td>IRQ模式</td>
<td>4</td>
</tr>
<tr>
<td>0x1c</td>
<td>FIQ快速中断</td>
<td>FIQ模式</td>
<td>3</td>
</tr>
</tbody></table>
<p>确定优先级的作用？</p>
<ul>
<li><p>异常向量表特点</p>
<ul>
<li>异常事件与异常处理程序之间的对应关系；</li>
<li>向量表大小32个字节，每个异常向量占据4个字节；</li>
<li>每个字存放PC赋值的语句，或跳转指令；</li>
<li>通常存放在存储器地址的低端（或利用寄存器设置）</li>
</ul>
</li>
<li><p>向量表-LDR间接寻址</p>
</li>
</ul>
<pre class="line-numbers language-assembly"><code class="language-assembly">Vectors          LDR     PC, Reset_Addr           ；0x00  
                  LDR     PC, Undef_Addr
                   LDR     PC, SWI_Addr
                   LDR     PC, PAbt_Addr
                   LDR     PC, DAbt_Addr
                   NOP                                    ; Reserved Vector 
                   LDR     PC, IRQ_Addr
                   LDR     PC, FIQ_Addr
        ……                                 ; IRQ_Entry, 9条指令
        Reset_Addr          DCD     Reset_Handler
        Undef_Addr          DCD     Undef_Handler
        SWI_Addr            DCD     SWI_Handler
        PAbt_Addr           DCD     PAbt_Handler
        DAbt_Addr           DCD     DAbt_Handler
                    DCD     0                              ; Reserved Address 
        IRQ_Addr            DCD     IRQ_Handler
        FIQ_Addr            DCD     FIQ_Handler
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>LDR   PC, Reset_Addr 会相对寻址 Ldr [pc, #Reset_Addr to pc]</p>
<p>偏移不能超过4k</p>
</blockquote>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211110203411716.png" alt=""></p>
<ul>
<li>向量表-B跳转</li>
</ul>
<pre class="line-numbers language-assembly"><code class="language-assembly">Vectors          
             B     Reset_Handler  ;0x00
              B     Undef_Handler
            B     SWI_Handler
               B     PAbt_Handler
               B     DAbt_Handler
            NOP                          ; Reserved Address 
            B     IRQ_Handler
            B     FIQ_Handler<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><p>B</p>
<ul>
<li><p>简单</p>
</li>
<li><p>跳转范围受限 （±32MB)</p>
</li>
</ul>
</li>
<li><p>使用LDR指令</p>
<ul>
<li><p>跳转范围不受限</p>
</li>
<li><p>额外空间存地址</p>
</li>
<li><p>地址存放在4KB范围以内</p>
</li>
</ul>
</li>
</ul>
<p>在这里， ”B” 能否改成”BL” ? </p>
<ul>
<li>向量表-伪指令LDR</li>
</ul>
<pre class="line-numbers language-assembly"><code class="language-assembly">Vectors          
              LDR PC, = Reset_Handler  ;0x00
               LDR PC, = Undef_Handler
            LDR PC, = SWI_Handler
                LDR PC, = PAbt_Handler
                LDR PC, = DAbt_Handler
            NOP                              ; Reserved Address 
             LDR PC, = IRQ_Handler
            LDR PC, = FIQ_Handler
                    ……                                 ; IRQ_Entry, 9条指令
        ltorg
        ;Reset_Addr          DCD     Reset_Handler
        ;Undef_Addr          DCD     Undef_Handler
        ;SWI_Addr            DCD     SWI_Handler
        ;PAbt_Addr           DCD     PAbt_Handler
        ;DAbt_Addr           DCD     DAbt_Handler<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>向量表/异常服务程序</li>
</ul>
<pre class="line-numbers language-assembly"><code class="language-assembly">        import  ISR_IRQ_Handler
Vectors          
             B     Reset_Handler  
              B     Undef_Handler
            B     SWI_Handler
               B     PAbt_Handler
               B     DAbt_Handler
            NOP    
            B     ISR_IRQ_Handler
            B     FIQ_Handler<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>中断服务程序一般没有参数不需要传回值，或通过内存传递</p>
</blockquote>
<p>能否在程序运行时注册（安装）异常服务程序？  </p>
<h3 id="注册异常服务程序"><a href="#注册异常服务程序" class="headerlink" title="注册异常服务程序"></a>注册异常服务程序</h3><p><strong>能直接写入文本格式程序源码？</strong></p>
<p>程序运行时，将指令 “B ISR_IRQ_Handler ”写入向量表中？ </p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211110203822211.png" alt=""></p>
<blockquote>
<p>构建二进制指令，取高26位，偏移地址：中断向量-中断服务程序入口地址</p>
</blockquote>
<ul>
<li>步骤</li>
</ul>
<p>​    （1）读取中断处理程序的地址addr1</p>
<p>​    （2）将addr1减去该中断对应的中断向量的地址vector1</p>
<p>​    （3）addr=Addr1-vector1-8 (允许指令预取）</p>
<p>​    （4）addr LSR #2</p>
<p>​    （5）if(addr and 0xff000000 ==0)</p>
<p>​    （6）addr or 0xea00 0000</p>
<p>​    （7）结果写回中断向量表 </p>
<ul>
<li>安装函数</li>
</ul>
<pre class="line-numbers language-c"><code class="language-c"><span class="token keyword">unsigned</span> <span class="token function">Install_Handler</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token operator">*</span>handlerloc<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token operator">*</span>vector<span class="token punctuation">)</span>
<span class="token punctuation">{</span>  
    <span class="token keyword">unsigned</span> vec<span class="token punctuation">,</span> oldvec<span class="token punctuation">;</span>
    vec <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span><span class="token punctuation">)</span>handlerloc <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span><span class="token punctuation">)</span>vector <span class="token operator">-</span> <span class="token number">0x8</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>vec <span class="token operator">&amp;</span> <span class="token number">0xFF000000</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
    vec <span class="token operator">=</span> <span class="token number">0xEa000000</span> <span class="token operator">|</span> vec<span class="token punctuation">;</span>
    oldvec <span class="token operator">=</span> <span class="token operator">*</span>vector<span class="token punctuation">;</span>
    <span class="token operator">*</span>vector <span class="token operator">=</span> vec<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>oldvec<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-c"><code class="language-c"><span class="token keyword">unsigned</span> <span class="token operator">*</span>irqvec <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token number">0x18</span><span class="token punctuation">;</span>    
<span class="token keyword">static</span> <span class="token keyword">unsigned</span> pIRQ_Handler <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span><span class="token punctuation">)</span>ISR_IRQ_handler    
<span class="token function">Install_Handler</span> <span class="token punctuation">(</span><span class="token operator">&amp;</span>pIRQ_Handler<span class="token punctuation">,</span> irqvec<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><strong>中断向量表的基地址？</strong></p>
<p><strong>上述例程适用条件？跳转地址和向量表偏移地址不能超过正负32M</strong></p>
<p><strong>如果不能确定异常服务程序的地址范围，如何处理？</strong></p>
<p><strong>如果向量表采用”LDR”语句，需要修改”DCD” 后的地址, 如何做？</strong></p>
<ul>
<li>获取服务程序的入口地址；</li>
<li>确定异常向量对应的”DCD” 分配的存储地址；</li>
<li>将服务程序入口地址写入对应的存储单元；</li>
</ul>
<h3 id="中断向量扩展"><a href="#中断向量扩展" class="headerlink" title="中断向量扩展"></a><strong>中断向量扩展</strong></h3><p>实际处理器通常有多个外部中断 (IRQ, 外设， IO)，这些中断与其对应的服务程序如何关联？</p>
<pre class="line-numbers language-assembly"><code class="language-assembly">INTOFFSET           EQU    0X4A000014  ;Address of Interrupt 
                            ;offset Register
IntVTAddress           EQU     0x33FFFF20

;Interrupt Vector Table Address                
HandleEINT0            EQU    IntVTAddress           
HandleEINT1            EQU    IntVTAddress +4
……
HandleTIMER0           EQU    IntVTAddress +4*10
HandleTIMER1           EQU    IntVTAddress +4*11
……
HandleUART1            EQU    IntVTAddress +4*23
……
HandleUART0           EQU    IntVTAddress +4*28
HandleADC             EQU    IntVTAddress +4*31<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-c"><code class="language-c">IRQ_Entry
                          sub    sp<span class="token punctuation">,</span>sp<span class="token punctuation">,</span>#<span class="token number">4</span>       <span class="token punctuation">;</span>reserved <span class="token keyword">for</span> PC
                    stmfd    sp<span class="token operator">!</span><span class="token punctuation">,</span><span class="token punctuation">{</span>r8<span class="token operator">-</span>r9<span class="token punctuation">}</span>                
                    ldr    r9<span class="token punctuation">,</span><span class="token operator">=</span>INTOFFSET  <span class="token punctuation">;</span>中断序号
                    ldr    r9<span class="token punctuation">,</span><span class="token punctuation">[</span>r9<span class="token punctuation">]</span>
                    ldr    r8<span class="token punctuation">,</span><span class="token operator">=</span>HandleEINT0 <span class="token punctuation">;</span>中断扩展表首地址
                    add    r8<span class="token punctuation">,</span>r8<span class="token punctuation">,</span>r9<span class="token punctuation">,</span>lsl #<span class="token number">2</span> <span class="token punctuation">;</span> <span class="token operator">?</span>
                    ldr    r8<span class="token punctuation">,</span><span class="token punctuation">[</span>r8<span class="token punctuation">]</span>   <span class="token punctuation">;</span>Eintx_ Entry Add <span class="token operator">-></span>r8
                    str    r8<span class="token punctuation">,</span><span class="token punctuation">[</span>sp<span class="token punctuation">,</span>#<span class="token number">8</span><span class="token punctuation">]</span> <span class="token punctuation">;</span>r8<span class="token operator">-></span><span class="token function">SP</span><span class="token punctuation">(</span><span class="token operator">-</span>#<span class="token number">4</span><span class="token punctuation">)</span>

                    ldmfd    sp<span class="token operator">!</span><span class="token punctuation">,</span><span class="token punctuation">{</span>r8<span class="token operator">-</span>r9<span class="token punctuation">,</span>pc<span class="token punctuation">}</span><span class="token punctuation">;</span>Eintx_ Entry Add <span class="token operator">-></span>pc<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="非嵌套中断"><a href="#非嵌套中断" class="headerlink" title="非嵌套中断"></a><strong>非嵌套中断</strong></h3><p><img src="/images/loading.gif" data-original="../images/basic/image-20211110204320420.png" alt=""></p>
<pre class="line-numbers language-assembly"><code class="language-assembly">interrupt_handler
    sub    r14, r14, #4 ; ?
    stmfd    sp!, {r0-r3, r12, r14}
    ldr    r1, =IRQStatus
    ldr    r0,[r1]
    tst    r0, #0x0080  ;测试中断源
    blne    my_isr1
    tst    r0, #0x0001 ；测试中断源
    blne    my_isr2
    ldmfd    sp!, {r0-r3, r12, r14}^
    ldr pc, lr<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="嵌套中断"><a href="#嵌套中断" class="headerlink" title="嵌套中断"></a><strong>嵌套中断</strong></h3><p><img src="/images/loading.gif" data-original="../images/basic/image-20211110204357478.png" alt=""></p>
<h2 id="外设访问"><a href="#外设访问" class="headerlink" title="外设访问"></a><strong>外设访问</strong></h2><p>如何控制实验板上LED显示？</p>
<h3 id="LED连接"><a href="#LED连接" class="headerlink" title="LED连接"></a>LED连接</h3><p><strong>Mainboard</strong></p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211110204509420.png" alt=""></p>
<ul>
<li><p>LED连接</p>
<ul>
<li><p>LED1  -&gt; GPF4</p>
</li>
<li><p>LED2  -&gt; GPF5</p>
</li>
<li><p>LED3  -&gt; GPF6</p>
</li>
<li><p>LED4  -&gt; GPF7</p>
</li>
</ul>
</li>
<li><p>LED 控制</p>
<ul>
<li><p>n0  -&gt; on</p>
</li>
<li><p>n1  -&gt; off</p>
</li>
</ul>
</li>
<li><p>GPF控制</p>
<ul>
<li><strong>Registers</strong></li>
</ul>
</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211110204651064.png" alt=""></p>
<ul>
<li><p>The value of Registers</p>
<ul>
<li><p>GPFCON (4-7 Output)：0b 0101 0101 XXXX XXXX</p>
</li>
<li><p>GPFUP ( 4-7 No concern): 0b XXXX XXXX</p>
</li>
<li><p>GPFDAT (4-7 on): 0b 0000 XXXX</p>
</li>
<li><p>GPFDAT (4-7 off): 0b 1111 XXXX</p>
</li>
</ul>
</li>
</ul>
<h3 id="C-Code"><a href="#C-Code" class="headerlink" title="C Code"></a><strong>C Code</strong></h3><pre class="line-numbers language-c"><code class="language-c"><span class="token keyword">int</span> <span class="token operator">*</span>rGPFCON <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span><span class="token punctuation">)</span> <span class="token number">0x56000050</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token operator">*</span>rGPFDAT <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span><span class="token punctuation">)</span> <span class="token number">0x56000054</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span> <span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token operator">*</span>rGPFCON<span class="token operator">=</span><span class="token number">0x5500</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token operator">*</span>rGPFDAT <span class="token operator">=</span> <span class="token number">0x00</span><span class="token punctuation">;</span>
        <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token operator">*</span>rGPFDAT <span class="token operator">=</span> <span class="token number">0xf0</span><span class="token punctuation">;</span>
        <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>    <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>如何连接到目标板？</strong></p>
<h3 id="Emulator"><a href="#Emulator" class="headerlink" title="Emulator"></a><strong>Emulator</strong></h3><p><img src="/images/loading.gif" data-original="../images/basic/image-20211110204849739.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211110204856786.png" alt=""></p>
<p>如何在目板RAM中运行程序？</p>
<h3 id="Run-in-RAM"><a href="#Run-in-RAM" class="headerlink" title="Run in RAM"></a>Run in RAM</h3><ul>
<li><p>Linker Configure</p>
<ul>
<li><p>RO Base=0x30000000</p>
</li>
<li><p>RW Base=0x30100000</p>
</li>
</ul>
</li>
<li><p>DRAM 初始化</p>
<ul>
<li>Debug Init</li>
</ul>
</li>
</ul>
<pre><code>//MEMMAP=0x01; 
map 0x48000000, 0x60000000 read write ;
_WDWORD(0x53000000,0x00000000);          //watchdog Timer Control register
_WDWORD(0x4a000008,0xffffffff);                 //Interrupt Mask Control
_WDWORD(0x4a00001c,0x000007ff);            //Interrupt sub mask
_WDWORD(0x4c000014,0x03);                       //Clock Divider Control Register
_WDWORD(0x4c000004,0x5c042);                 //MPLL Configuration Register
_WDWORD(0x48000000,0x22111110);          //Bus Width and Wait Status Ctrl
_WDWORD(0x48000004,0x00000700);          //Bank 0 Control Register
_WDWORD(0x48000008,0x00000700);          //Bank 1 Control Register
_WDWORD(0x4800000c,0x00000700);          //Bank 2 Control Register
_WDWORD(0x48000010,0x00000700);          //Bank 3 Control Register
_WDWORD(0x48000014,0x00000700);          //Bank 4 Control Register
_WDWORD(0x48000018,0x00000700);          //Bank 5 Control Register
_WDWORD(0x4800001c,0x00018005);          //Bank 6 Control Register
_WDWORD(0x48000020,0x00000700);          //Bank 7 Control Register
_WDWORD(0x48000024,0x008e0459);          //SDRAM Refresh Control Register 
_WDWORD(0x48000028,0x000000b2);          //Flexible Bank Size Register 
_WDWORD(0x4800002c,0x00000030);          //Bank 6 Mode Register
_WDWORD(0x48000030,0x00000030);          //Bank 7 Mode Register
_WDWORD(0x56000014,0x01);                      //Port B Data
_WDWORD(0x56000020,0xaaaa55aa);           //Port C Control
_WDWORD(0x56000028,0x0ffff);                      //Pull-up Control C
_WDWORD(0x56000024,0x00000000);          //Port C Data
_WDWORD(0x56000070,0x00280000);          //Port H Control
_WDWORD(0x56000078,0x00000000);          //Pull-up Control H
//pc=0x30000000</code></pre><p>需要在代码中加入初始化，上电后才能正常访问RAM</p>
<ul>
<li>下载到RAM </li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211110205053747.png" alt=""></p>
<p>如何实现上电启动？</p>
<h3 id="Run-in-FLASH"><a href="#Run-in-FLASH" class="headerlink" title="Run in FLASH"></a>Run in FLASH</h3><ul>
<li>Linker Configure<ul>
<li>RO Base=0x00000000</li>
<li>RW Base=0x30000000</li>
</ul>
</li>
<li>Output Configure<ul>
<li>Create HEX file</li>
</ul>
</li>
<li>DRAM 初始化<ul>
<li>Initialization by code</li>
</ul>
</li>
</ul>
<p>Nor Flash</p>
<ul>
<li><p>Set Jumper    ( boot from Nor Flash )(16bit)</p>
<ul>
<li><p>SW104: OM0 (Open)</p>
</li>
<li><p>SW105: OM1 (Close)</p>
</li>
</ul>
</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211110205239787.png" alt=""></p>
<h3 id="Linker-CMD"><a href="#Linker-CMD" class="headerlink" title="Linker CMD"></a>Linker CMD</h3><pre class="line-numbers language-assembly"><code class="language-assembly">LR_ROM1 0x00000000 
{    ; load region
     ER_ROM1 0x00000000 0x0200000  
    {  ; load address = execution address
       *.o (RESET, +First)
       *(InRoot$$Sections)
       .ANY (+RO)
   }
  RW_RAM1 0x30000000 0x4000000  
  {  ; RW data
       .ANY (+RW +ZI)
   }
   RW_IRAM1 0x40000000 0x00001000  
   {
       .ANY (+RW +ZI)
   }
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211110205321127.png" alt=""></p>
<h2 id="小结-3"><a href="#小结-3" class="headerlink" title="小结"></a><strong>小结</strong></h2><ul>
<li>函数调用</li>
<li>异常向量表</li>
<li>异常服务程序注册</li>
<li>外设访问</li>
</ul>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://jackhcc.github.io" rel="external nofollow noreferrer">杰克成</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://jackhcc.github.io/posts/Embedded-Microprocessor-System.html">https://jackhcc.github.io/posts/Embedded-Microprocessor-System.html</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="https://jackhcc.github.io" target="_blank">杰克成</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/Microprocessor/">
                                    <span class="chip bg-color">Microprocessor</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/share/css/share.min.css">

<div id="article-share">
    
    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/images/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/medias/reward/aliqr.png" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/images/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/medias/reward/wxqr.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>
            
        </div>
    </div>

    
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/gitalk/gitalk.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/css/my-gitalk.css">

<div class="card gitalk-card" data-aos="fade-up">
    <div class="comment_headling" style="font-size: 20px; font-weight: 700; position: relative; left: 20px; top: 15px; padding-bottom: 5px;">
        <i class="fas fa-comments fa-fw" aria-hidden="true"></i>
        <span>评论</span>
    </div>
    <div id="gitalk-container" class="card-content"></div>
</div>

<script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/gitalk/gitalk.min.js"></script>
<script>
    let gitalk = new Gitalk({
        clientID: '3821a0bbb773038a51fc',
        clientSecret: '4b30b507d67ec5497ec0e77f43f80cb3e0d7dd3a',
        repo: 'JackHCC.github.io',
        owner: 'JackHCC',
        admin: "JackHCC",
        id: '2021-09-26T18-38-19',
        distractionFreeMode: false  // Facebook-like distraction free mode
    });

    gitalk.render('gitalk-container');
</script>
    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/posts/blog-python20.html">
                    <div class="card-image">
                        
                        
                        <img src="/images/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/medias/featureimages/17.jpg" class="responsive-img" alt="Python Key Knowledge Summary">
                        
                        <span class="card-title">Python Key Knowledge Summary</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            Python重点知识总结
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2021-09-27
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Python/" class="post-category">
                                    Python
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Python/">
                        <span class="chip bg-color">Python</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/posts/Multimodal-Machine-Learning.html">
                    <div class="card-image">
                        
                        
                        <img src="/images/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/medias/featureimages/9.jpg" class="responsive-img" alt="Multimodal Machine Learning多模态学习">
                        
                        <span class="card-title">Multimodal Machine Learning多模态学习</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            Multimodal Machine Learning多模态学习详解
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2021-09-25
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Deep-Learning/" class="post-category">
                                    Deep Learning
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Multimodal-Machine-Learning/">
                        <span class="chip bg-color">Multimodal Machine Learning</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/codeBlock/codeShrink.js"></script>


<!-- 代码块折行 -->

<style type="text/css">
code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }
</style>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('4'),
            headingSelector: 'h1, h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h1, h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>



    <footer class="page-footer bg-color">
    <div class="container row center-align" style="margin-bottom: 15px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            <span id="year">2020</span>
            <a href="https://jackhcc.github.io" target="_blank">杰克成</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                class="white-color">2549.9k</span>&nbsp;字
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;次
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;人
            </span>
            
            <br>
            
            <span id="sitetime">载入运行时间...</span>
            <script>
                function siteTime() {
                    var seconds = 1000;
                    var minutes = seconds * 60;
                    var hours = minutes * 60;
                    var days = hours * 24;
                    var years = days * 365;
                    var today = new Date();
                    var startYear = "2020";
                    var startMonth = "2";
                    var startDate = "27";
                    var startHour = "6";
                    var startMinute = "30";
                    var startSecond = "0";
                    var todayYear = today.getFullYear();
                    var todayMonth = today.getMonth() + 1;
                    var todayDate = today.getDate();
                    var todayHour = today.getHours();
                    var todayMinute = today.getMinutes();
                    var todaySecond = today.getSeconds();
                    var t1 = Date.UTC(startYear, startMonth, startDate, startHour, startMinute, startSecond);
                    var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
                    var diff = t2 - t1;
                    var diffYears = Math.floor(diff / years);
                    var diffDays = Math.floor((diff / days) - diffYears * 365);
                    var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
                    var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) /
                        minutes);
                    var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours -
                        diffMinutes * minutes) / seconds);
                    if (startYear == todayYear) {
                        document.getElementById("year").innerHTML = todayYear;
                        document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffDays + " 天 " + diffHours +
                            " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    } else {
                        document.getElementById("year").innerHTML = startYear + " - " + todayYear;
                        document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffYears + " 年 " + diffDays +
                            " 天 " + diffHours + " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    }
                }
                setInterval(siteTime, 1000);
            </script>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/JackHCC" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:jackcc0701@163.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>



    <a href="https://www.facebook.com/profile.php?id=100046343443643" class="tooltipped" target="_blank" data-tooltip="关注我的Facebook: https://www.facebook.com/profile.php?id=100046343443643" data-position="top" data-delay="50">
        <i class="fab fa-facebook-f"></i>
    </a>



    <a href="https://twitter.com/JackChe66021834" class="tooltipped" target="_blank" data-tooltip="关注我的Twitter: https://twitter.com/JackChe66021834" data-position="top" data-delay="50">
        <i class="fab fa-twitter"></i>
    </a>



    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=2508074836" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 2508074836" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>



    <a href="https://weibo.com/u/6885584679" class="tooltipped" target="_blank" data-tooltip="关注我的微博: https://weibo.com/u/6885584679" data-position="top" data-delay="50">
        <i class="fab fa-weibo"></i>
    </a>



    <a href="https://www.zhihu.com/people/8f8482f01f0d6a04e844efe32e0f0710" class="tooltipped" target="_blank" data-tooltip="关注我的知乎: https://www.zhihu.com/people/8f8482f01f0d6a04e844efe32e0f0710" data-position="top" data-delay="50">
        <i class="fab fa-zhihu1">知</i>
    </a>



</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/js/search.js"></script>
<script type="text/javascript">
$(function () {
    searchFunc("https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/" + "search.xml", 'searchInput', 'searchResult');
});
</script>
    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/materialize/materialize.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/aos/aos.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/js/matery.js"></script>

    <canvas class="fireworks" style="position: fixed;left: 0;top: 0;z-index: 1; pointer-events: none;" ></canvas>
    <script type="text/javascript" src="//cdn.bootcss.com/animejs/2.2.0/anime.min.js"></script>
    <script type="text/javascript" src="/js/fireworks.js"></script>

    <script type="text/javascript">
        //只在桌面版网页启用特效
        var windowWidth = $(window).width();
        if (windowWidth > 768) {
            document.write('<script type="text/javascript" src="/js/sakura.js"><\/script>'); }
    </script>

    <!-- weather -->
	<script type="text/javascript">
	WIDGET = {FID: 'TToslpmkVO'}
	</script>
	<script type="text/javascript" src="https://apip.weatherdt.com/float/static/js/r.js?v=1111"></script>


    <!-- Global site tag (gtag.js) - Google Analytics -->


    <!-- Baidu Analytics -->

<script>
    var _hmt = _hmt || [];
    (function () {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>

    <!-- Baidu Push -->

    
    
    <script async src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/others/busuanzi.pure.mini.js"></script>
    

    
        <script src="//code.tidio.co/kqhlkxviiccyoa0czpfpu4ijuey9hfre.js"></script>
        <script> 
            $(document).ready(function () {
                setInterval(change_Tidio, 50);  
                function change_Tidio() { 
                    var tidio=$("#tidio-chat iframe");
                    if(tidio.css("display")=="block"&& $(window).width()>977 ){
                        document.getElementById("tidio-chat-iframe").style.bottom= ($("div#backTop.top-scroll").css("display")=="none" &&$(window).width()>977)>0? "-40px" : ($("div.toc-title").length&&$(window).width()>977)>0?"85px":"20px";   
                        document.getElementById("tidio-chat-iframe").style.right="-15px";   
                        document.getElementById("tidio-chat-iframe").style.height=parseInt(tidio.css("height"))>=520?"520px":tidio.css("height");
                        document.getElementById("tidio-chat-iframe").style.zIndex="997";
                    } 
                    else if(tidio.css("display")=="block"&&$(window).width()>601 &&$(window).width()<992 ){
                        document.getElementById("tidio-chat-iframe").style.bottom= ($("div#backTop.top-scroll").css("display")=="none" && 601< $(window).width()<992)>0? "-40px":"20px" ;   
                        document.getElementById("tidio-chat-iframe").style.right="-15px"; 
                        document.getElementById("tidio-chat-iframe").style.zIndex="997";
                    }
                    else if(tidio.css("display")=="block"&&$(window).width()<601 && parseInt(tidio.css("height"))<230){
                        document.getElementById("tidio-chat-iframe").style.bottom= ($("div#backTop.top-scroll").css("display")=="none" && $(window).width()<601)>0? "-10px":"45px" ;   
                        document.getElementById("tidio-chat-iframe").style.zIndex="997";
                    }
                    if( tidio.css("display")=="block"&&$(window).width()<601 && parseInt(tidio.css("height"))>=230){
                        document.getElementById("tidio-chat-iframe").style.zIndex="998";
                    }
                } 
            }); 
        </script>
    

    

    
    <script type="text/javascript" color="0,0,255"
        pointColor="0,0,255" opacity='0.7'
        zIndex="-1" count="99"
        src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/background/canvas-nest.js"></script>
    

    

    
    <script type="text/javascript" src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/background/ribbon-dynamic.js" async="async"></script>
    
    
    
    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/instantpage/instantpage.js" type="module"></script>
    
<script>!function(e){var c=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));function i(){for(var r=0;r<c.length;r++)t=c[r],0<=(n=t.getBoundingClientRect()).bottom&&0<=n.left&&n.top<=(e.innerHeight||document.documentElement.clientHeight)&&function(){var t,n,e,i,o=c[r];t=o,n=function(){c=c.filter(function(t){return o!==t})},e=new Image,i=t.getAttribute("data-original"),e.onload=function(){t.src=i,n&&n()},e.src=i}();var t,n}i(),e.addEventListener("scroll",function(){var t,n;t=i,n=e,clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(n)},500)})}(this);</script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})});</script>
        <script src="//cdn.jsdelivr.net/npm/js-base64/base64.min.js"></script>
        <script>
        $('a').each(function() {
          const $this = $(this);
          const href = $this.attr('href');
          if (href && href.match('^((http|https|thunder|qqdl|ed2k|Flashget|qbrowser|ftp|rtsp|mms)://)')) {
            const strs = href.split('/');
            if (strs.length >= 3) {
                const host = strs[2];
                if (host !== 'your_domain' || window.location.host) {
                    $this.attr('href', '/go.html?u='+Base64.encode(href)+'').attr('rel', 'external nofollow noopener noreferrer');
                    if (true) {
                        $this.attr('target', '_blank');
                    }
                }
            }
          }
        });
        </script></body>

</html>

